# æµ‹è¯•å¿«é€Ÿå¼€å§‹

> 5åˆ†é’Ÿå¼€å§‹è¿è¡Œæµ‹è¯•

## ğŸš€ å¿«é€Ÿè¿è¡Œæµ‹è¯•

### æ–¹å¼ä¸€ï¼šä½¿ç”¨Makefileï¼ˆæ¨èï¼‰

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test

# è¿è¡Œå•å…ƒæµ‹è¯•
make test-unit

# è¿è¡Œé›†æˆæµ‹è¯•  
make test-integration

# æŸ¥çœ‹è¦†ç›–ç‡
make test-cov
```

### æ–¹å¼äºŒï¼šä½¿ç”¨pytest

```bash
# 1. å®‰è£…æµ‹è¯•ä¾èµ–
uv sync --extra test

# 2. è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# 3. è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/unit -v
```

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•æµç¨‹
./run_tests.sh
```

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

å½“å‰æµ‹è¯•è¦†ç›–ï¼š

```
æµ‹è¯•æ–‡ä»¶ï¼š    8ä¸ª
æµ‹è¯•å‡½æ•°ï¼š    88ä¸ª
æµ‹è¯•æ•°æ®ï¼š    2ä¸ªç¤ºä¾‹æ–‡æ¡£

åˆ†å¸ƒï¼š
â”œâ”€â”€ å•å…ƒæµ‹è¯•ï¼š   5ä¸ªæ–‡ä»¶ï¼Œçº¦60ä¸ªæµ‹è¯•
â”œâ”€â”€ é›†æˆæµ‹è¯•ï¼š   2ä¸ªæ–‡ä»¶ï¼Œçº¦15ä¸ªæµ‹è¯•
â””â”€â”€ æ€§èƒ½æµ‹è¯•ï¼š   1ä¸ªæ–‡ä»¶ï¼Œçº¦13ä¸ªæµ‹è¯•
```

## âœ… æµ‹è¯•æ¸…å•

### å•å…ƒæµ‹è¯•ï¼ˆtests/unit/ï¼‰

- [x] **test_config.py** (çº¦15ä¸ªæµ‹è¯•)
  - é…ç½®åˆå§‹åŒ–
  - é…ç½®éªŒè¯
  - è·¯å¾„è§£æ
  - å‚æ•°åŒ–æµ‹è¯•

- [x] **test_data_loader.py** (çº¦20ä¸ªæµ‹è¯•)
  - MarkdownLoaderåŠŸèƒ½
  - WebLoaderåŠŸèƒ½
  - DocumentProcessoråŠŸèƒ½
  - ä¾¿æ·å‡½æ•°æµ‹è¯•
  - å‚æ•°åŒ–æ–‡ä»¶æ‰©å±•åæµ‹è¯•

- [x] **test_indexer.py** (çº¦15ä¸ªæµ‹è¯•)
  - ç´¢å¼•æ„å»º
  - ç´¢å¼•æ£€ç´¢
  - å¢é‡ç´¢å¼•
  - ç´¢å¼•æ¸…ç©º
  - å‚æ•°åŒ–åˆ†å—æµ‹è¯•

- [x] **test_query_engine.py** (çº¦8ä¸ªæµ‹è¯•)
  - QueryEngineåŸºç¡€åŠŸèƒ½
  - SimpleQueryEngineåŠŸèƒ½
  - å¼•ç”¨æ¥æºæ ¼å¼åŒ–
  - Mock LLMæµ‹è¯•

- [x] **test_chat_manager.py** (çº¦15ä¸ªæµ‹è¯•)
  - ChatTurnæ•°æ®ç±»
  - ChatSessionä¼šè¯ç®¡ç†
  - ChatManagerå¯¹è¯ç®¡ç†
  - ä¼šè¯æŒä¹…åŒ–

### é›†æˆæµ‹è¯•ï¼ˆtests/integration/ï¼‰

- [x] **test_data_pipeline.py** (çº¦8ä¸ªæµ‹è¯•)
  - åŠ è½½â†’ç´¢å¼•æµç¨‹
  - å¢é‡åŠ è½½
  - é‡å»ºç´¢å¼•
  - å…ƒæ•°æ®ä¸€è‡´æ€§

- [x] **test_query_pipeline.py** (çº¦7ä¸ªæµ‹è¯•)
  - ç´¢å¼•â†’æ£€ç´¢æµç¨‹
  - å®Œæ•´æŸ¥è¯¢æµç¨‹
  - å¤šæ¬¡æŸ¥è¯¢
  - æ£€ç´¢ç›¸å…³æ€§

### æ€§èƒ½æµ‹è¯•ï¼ˆtests/performance/ï¼‰

- [x] **test_performance.py** (çº¦6ä¸ªæµ‹è¯•)
  - ç´¢å¼•æ€§èƒ½
  - æœç´¢å»¶è¿Ÿ
  - æ‰©å±•æ€§æµ‹è¯•
  - å†…å­˜ä½¿ç”¨

## ğŸ¯ æµ‹è¯•ç¤ºä¾‹

### è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶

```bash
pytest tests/unit/test_config.py -v
```

### è¿è¡Œå•ä¸ªæµ‹è¯•å‡½æ•°

```bash
pytest tests/unit/test_config.py::TestConfig::test_config_initialization -v
```

### è¿è¡Œå¸¦æ ‡è®°çš„æµ‹è¯•

```bash
# è·³è¿‡æ…¢é€Ÿæµ‹è¯•
pytest -m "not slow" -v

# åªè¿è¡Œå•å…ƒæµ‹è¯•
pytest -m unit -v

# è¿è¡Œæ€§èƒ½æµ‹è¯•
pytest -m performance -v
```

### æŸ¥çœ‹è¯¦ç»†è¾“å‡º

```bash
pytest -vv --tb=long
```

### åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•

```bash
pytest --lf
```

## ğŸ“ˆ è¦†ç›–ç‡æŠ¥å‘Š

è¿è¡Œæµ‹è¯•å¹¶æŸ¥çœ‹è¦†ç›–ç‡ï¼š

```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=src --cov-report=html

# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
open htmlcov/index.html  # macOS
xdg-open htmlcov/index.html  # Linux
```

## ğŸ” æµ‹è¯•è¾“å‡ºè¯´æ˜

### æˆåŠŸçš„æµ‹è¯•

```
tests/unit/test_config.py::TestConfig::test_config_initialization PASSED [100%]
```

- `PASSED` - æµ‹è¯•é€šè¿‡ âœ…
- `[100%]` - æµ‹è¯•è¿›åº¦

### å¤±è´¥çš„æµ‹è¯•

```
tests/unit/test_config.py::TestConfig::test_example FAILED

AssertionError: assert False
```

- `FAILED` - æµ‹è¯•å¤±è´¥ âŒ
- ä¼šæ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

### è·³è¿‡çš„æµ‹è¯•

```
tests/unit/test_query_engine.py::TestQueryEngine::test_real_api SKIPPED
```

- `SKIPPED` - æµ‹è¯•è¢«è·³è¿‡ â­ï¸
- é€šå¸¸æ˜¯å› ä¸ºç¼ºå°‘APIå¯†é’¥æˆ–æ ‡è®°ä¸ºslow

## âš¡ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

| éœ€æ±‚ | å‘½ä»¤ |
|------|------|
| è¿è¡Œæ‰€æœ‰æµ‹è¯• | `make test` æˆ– `pytest` |
| åªè¿è¡Œå•å…ƒæµ‹è¯• | `make test-unit` |
| åªè¿è¡Œé›†æˆæµ‹è¯• | `make test-integration` |
| æŸ¥çœ‹è¦†ç›–ç‡ | `make test-cov` |
| è·³è¿‡æ…¢é€Ÿæµ‹è¯• | `make test-fast` |
| è¿è¡Œç‰¹å®šæ–‡ä»¶ | `pytest tests/unit/test_config.py` |
| é‡æ–°è¿è¡Œå¤±è´¥çš„ | `pytest --lf` |
| æŸ¥çœ‹è¯¦ç»†è¾“å‡º | `pytest -vv` |

## ğŸ’¡ å¼€å‘å·¥ä½œæµ

### 1. å¼€å‘å‰

```bash
# ç¡®ä¿æµ‹è¯•é€šè¿‡
make test-fast
```

### 2. å¼€å‘ä¸­

```bash
# åªè¿è¡Œç›¸å…³çš„æµ‹è¯•
pytest tests/unit/test_your_module.py -v
```

### 3. æäº¤å‰

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆåŒ…æ‹¬æ…¢é€Ÿæµ‹è¯•ï¼‰
make test

# æ£€æŸ¥è¦†ç›–ç‡
make test-cov
```

## ğŸ› è°ƒè¯•å¤±è´¥çš„æµ‹è¯•

### 1. æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

```bash
pytest tests/unit/test_config.py -vv --tb=long
```

### 2. è¿›å…¥Pythonè°ƒè¯•å™¨

```bash
pytest --pdb
```

æµ‹è¯•å¤±è´¥æ—¶ä¼šè‡ªåŠ¨è¿›å…¥pdbè°ƒè¯•å™¨ã€‚

### 3. åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•

```bash
pytest --lf -v
```

### 4. æ‰“å°æµ‹è¯•è¾“å‡º

```python
def test_example():
    print("è°ƒè¯•ä¿¡æ¯")  # ä½¿ç”¨ pytest -s æŸ¥çœ‹
    assert True
```

```bash
pytest -s  # æ˜¾ç¤ºprintè¾“å‡º
```

## â“ å¸¸è§é—®é¢˜

### Q: æµ‹è¯•è¿è¡Œå¾ˆæ…¢ï¼Ÿ

A: ä½¿ç”¨ `make test-fast` è·³è¿‡æ…¢é€Ÿæµ‹è¯•ï¼ˆéœ€è¦APIçš„æµ‹è¯•ï¼‰ã€‚

### Q: å¦‚ä½•åªè¿è¡Œä¿®æ”¹çš„æµ‹è¯•ï¼Ÿ

A: ä½¿ç”¨ `pytest --lf` åªè¿è¡Œä¸Šæ¬¡å¤±è´¥çš„æµ‹è¯•ã€‚

### Q: è¦†ç›–ç‡å¦‚ä½•æé«˜ï¼Ÿ

A: 
1. æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Šæ‰¾åˆ°æœªè¦†ç›–çš„ä»£ç 
2. ä¸ºæœªè¦†ç›–çš„å‡½æ•°æ·»åŠ æµ‹è¯•
3. è¿è¡Œ `make test-cov` éªŒè¯

### Q: æµ‹è¯•éœ€è¦APIå¯†é’¥å—ï¼Ÿ

A: å¤§éƒ¨åˆ†æµ‹è¯•ä½¿ç”¨Mockï¼Œä¸éœ€è¦çœŸå®APIã€‚åªæœ‰æ ‡è®°ä¸º `@pytest.mark.slow` çš„æµ‹è¯•éœ€è¦çœŸå®APIå¯†é’¥ã€‚

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•æŒ‡å—](TESTING_GUIDE.md) - å®Œæ•´çš„æµ‹è¯•ä½“ç³»è¯´æ˜
- [å¼€å‘è€…æŒ‡å—](DEVELOPER_GUIDE.md) - å¼€å‘è¯´æ˜
- [é¡¹ç›®ç»“æ„](PROJECT_STRUCTURE.md) - ç›®å½•ç»„ç»‡

---

**æç¤º**: å»ºè®®æ¯æ¬¡æäº¤ä»£ç å‰è¿è¡Œ `make test` ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼

