---
name: testing-and-diagnostics
description: 测试与诊断工作流，包含单元测试和浏览器测试，测试失败时自动诊断。适用于代码变更后的测试执行与排障。
---

# 测试与诊断规范

> 适用于代码变更后的测试执行与排障，确保结果可靠、补救完整。

---

## ⚠️ 核心强制要求

### 测试选择

- **后端变更**（`backend/**`）→ 单元测试
- **前端变更**（`frontend/**`）→ 浏览器测试
- **全栈变更** → 先单元测试，再浏览器测试

### 基线约束

- 测试完成前不得提交交付结果
- 失败时必须先修复再继续
- 无法执行测试时需说明原因和补测计划

---

## AI Agent 行为要求

### 代码变更后

1. 根据变更类型选择测试
2. 执行测试并记录结果
3. 失败时触发诊断流程（最多三轮）

### 诊断流程

每轮：观察 → 推断 → 操作 → 结果

**升级条件**：
- 三轮排查无果
- 高风险或涉及架构/安全决策

---

## 禁止事项

- ❌ 跳过或延迟测试
- ❌ 未记录结果就报告完成
- ❌ 失败后继续提交

---

## 工具脚本

- `scripts/run_test_workflow.py` - 单元测试工作流
- `scripts/run_browser_tests.py` - 浏览器测试工作流
- `scripts/auto_diagnose.py` - 自动诊断

---

## 参考资料

- `references/testing-workflow.md` - 测试工作流详细说明
- `references/browser-testing.md` - 浏览器测试详细说明
- `references/diagnosis-workflow.md` - 诊断流程详细说明
