# 代码错误处理与自纠错指南

> **文档类型**: AGENTS 规则扩展文档  
> **版本**: 1.0  
> **更新日期**: 2025-11-03  
> **关联文档**: [AGENTS.md](../../AGENTS.md) 第234-243行

---

## 📖 文档说明

本文档是 **AGENTS.md 的扩展文档**，专门针对**代码层面的错误处理与自纠错机制**。

由于内容较多，本文档已拆分为多个详细指南。本文档作为**主索引和检查清单**。

### 适用范围

- ✅ **代码层面的错误**：语法错误、逻辑错误、运行时错误
- ✅ **测试用例整合**：智能选择、自动执行、缺失检测与生成
- ✅ **项目运行验证**：启动验证、核心功能验证
- ❌ **文档更新错误**：不在本文档范围（属于文档更新工作流）

### 核心原则

1. **聚焦代码层面**：专注于代码实现、测试、运行的错误处理
2. **整合测试驱动**：将测试用例自动执行与生成纳入错误处理流程
3. **渐进式修复**：采用分级修复策略，最大3次尝试
4. **自动验证**：修复后必须通过测试和项目运行验证

---

## 📚 详细指南索引

本文档内容已拆分为以下详细指南：

### 1. Bug 修复策略

**文档**: [AGENTS-EXPANSION-ERROR_HANDLING-BUG_FIX.md](./AGENTS-EXPANSION-ERROR_HANDLING-BUG_FIX.md)

**内容**：
- 错误记录与分类
- 修复流程（第一次尝试 → 第二次分析 → 超过2次增强诊断）
- 修复验证（强制要求）

### 2. 测试整合指南

**文档**: [AGENTS-EXPANSION-ERROR_HANDLING-TESTING.md](./AGENTS-EXPANSION-ERROR_HANDLING-TESTING.md)

**内容**：
- 测试用例智能选择与执行（方案C：混合策略）
- 测试用例缺失检测与自动生成（方案A：完整模板）
- 项目整体运行验证（方案B：启动+核心功能）

### 3. Agent 自纠错机制

**文档**: [AGENTS-EXPANSION-ERROR_HANDLING-SELF_CORRECTION.md](./AGENTS-EXPANSION-ERROR_HANDLING-SELF_CORRECTION.md)

**内容**：
- 错误检测机制（语法/逻辑/运行时/结果验证）
- 错误分类标准（低级/中级/高级/环境级）
- 纠正策略（重试、参数调整、算法替换、回滚）
- 错误恢复后的验证流程
- 测试驱动的自纠错流程

---

## 📋 检查清单

### Bug修复检查清单

- [ ] 错误信息已完整记录（类型、堆栈、位置、上下文）
- [ ] 错误已分类（语法/逻辑/运行时/环境）
- [ ] 已执行修复流程（最多3次）
- [ ] 修复后运行了相关测试用例
- [ ] 修复后运行了项目验证
- [ ] 测试全部通过
- [ ] 调试日志已清除
- [ ] 错误记录已保存到任务日志

### 测试整合检查清单

- [ ] 已识别修改的文件范围
- [ ] 已智能选择相关测试用例（文件名匹配 → 导入关系 → 依赖关系）
- [ ] 测试用例已执行
- [ ] 测试结果已分析（区分修改导致的失败 vs 原本失败）
- [ ] 新功能是否缺少测试用例已检查
- [ ] 缺失的测试用例已生成（如需要）
- [ ] 项目可以正常启动
- [ ] 核心功能已验证
- [ ] 没有新增错误日志
- [ ] 集成功能正常

### 自纠错检查清单

- [ ] 错误已正确分类（低级/中级/高级/环境级）
- [ ] 已执行相应的纠正策略（重试/调整/替换/回滚）
- [ ] 重试次数未超过限制（最大3次）
- [ ] 错误恢复后已完成验证（代码层面 + 功能层面 + 日志检查）
- [ ] 错误统计已记录（用于学习机制）

---

## 🔗 与 AGENTS.md 的关联

### 关联章节

- **AGENTS.md 第8条**：Bug修复策略 → [Bug修复详细指南](./AGENTS-EXPANSION-ERROR_HANDLING-BUG_FIX.md)
- **AGENTS.md 第9条**：Agent自纠错机制 → [自纠错详细指南](./AGENTS-EXPANSION-ERROR_HANDLING-SELF_CORRECTION.md)
- **AGENTS.md 第11条**：协作要点（错误处理中的用户介入时机）

### 使用方式

1. **快速参考**：查看 AGENTS.md 中的简要说明
2. **详细指南**：查看本文档索引，按需阅读对应的详细指南
3. **问题解决**：遇到复杂错误处理场景时参考详细指南

---

## 🎯 快速导航

根据您的需求，快速定位到相应指南：

| 场景 | 查看文档 |
|------|---------|
| 修复Bug时 | [Bug修复策略](./AGENTS-EXPANSION-ERROR_HANDLING-BUG_FIX.md) |
| 运行测试时 | [测试整合指南](./AGENTS-EXPANSION-ERROR_HANDLING-TESTING.md) |
| 生成测试用例时 | [测试整合指南 - 测试用例生成](./AGENTS-EXPANSION-ERROR_HANDLING-TESTING.md) |
| 验证项目运行时 | [测试整合指南 - 项目验证](./AGENTS-EXPANSION-ERROR_HANDLING-TESTING.md) |
| Agent自动纠错时 | [自纠错机制](./AGENTS-EXPANSION-ERROR_HANDLING-SELF_CORRECTION.md) |
| 需要完整检查清单时 | 本文档的"检查清单"部分 |

---

**最后更新**: 2025-11-03  
**维护者**: 当代码错误处理机制更新时，同步更新相关详细指南
