# 任务收尾规范
---
description: 任务收尾规范 - 日志、优化分析与规则校验的一体化收尾流程
alwaysApply: true
---

# 任务收尾规范

> 适用于主要交付完成后的收尾阶段，确保日志、优化分析与规则执行校验完整落地。

---

## 1. 触发条件
- 主要功能或文档交付已经完成，准备进入收尾阶段。
- 用户明确指示“进入收尾/后置流程/收尾阶段”等。
- Agent 在交付总结后询问是否进入收尾流程并获得同意。

---

## 2. 必须执行的命令链
1. `/generate-task-log`：生成符合规范的任务日志。
2. `/run-optimization-review`：撰写六维度复盘与优先级建议。
3. `/run-rule-check`：统计规则执行情况与健康度。
- 可选聚合命令：`/execute-post-hooks`（顺序执行以上命令）。

---

## 3. 基线约束

### 3.1 日志输出
- 日志存放于 `agent-task-log/`，命名遵循 `YYYY-MM-DD-N_【task_type】任务名称-文档类型.md`。
- 标题格式 `# YYYY-MM-DD 【task_type】任务名称-文档类型`，`task_type` 取自 `TASK_TYPES.md`。
- 内容需覆盖：元信息、关键步骤、实施说明、测试结果（嵌入 `/summarize-test-results` 输出）、交付结论、遗留问题或后续计划。
- 若因故延迟执行，必须记录原因与计划时间并提醒补齐。

### 3.2 优化分析
- 分析范围覆盖本次任务涉及的模块、文件或接口。
- 六大维度（代码质量 / 架构设计 / 性能 / 测试 / 可维护性 / 技术债务）逐项评估；不适用时注明原因。
- 每个维度至少包含一项亮点（✅）与一项改进建议（⚠️，含影响、建议、优先级 🔴/🟡/🟢）。
- 汇总优先级列表（立即处理 / 近期处理 / 长期规划），并标注分析日期（`YYYY-MM-DD`）。

### 3.3 规则校验
- 校验输入包括任务类型、涉及规则列表（按 Always / Auto / Agent Requested / Manual 分类）及执行结果。
- 检查关键要求：日志是否入库、测试命令是否执行并记录、优化分析是否输出。
- 统计执行率与补救率；对未执行项记录补救措施与负责人/时间节点（如适用）。
- 若无规则匹配，需在命令输出与日志中说明原因。

---

## 4. 协作说明
- Agent 完成主要交付后，主动询问是否进入收尾流程；用户同意后执行命令链。
- 用户若主动声明“收尾/后置流程”，Agent 立即执行命令链并在日志中记录触发方式。
- 收尾完成后在对话中汇报日志位置、分析要点与规则校验结论。

---

## 5. 禁止事项
- ❌ 跳过收尾命令或伪造执行结果。
- ❌ 漏写日志核心字段、六维分析或规则执行指标。
- ❌ 未说明未执行/补救项的原因与计划。

---

## 6. 关联命令与资料
- 命令：`/generate-task-log`、`/run-optimization-review`、`/run-rule-check`、`/execute-post-hooks`
- 命令目录：`.cursor/commands/task_closure/`
- 参考：`agent-task-log/TASK_TYPES.md`、`RULES_COMMANDS_STRUCTURE.md`
