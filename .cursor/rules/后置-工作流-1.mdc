---
description: 执行任务完成后工作流 - 任务完成后必须执行的工作流 - 任务日志记录和优化分析 - 所有Agent任务完成后必须执行这两个步骤
alwaysApply: true
---
# 任务完成后工作流

> **强制要求**：每个 Agent 任务完成后必须执行以下两个步骤：任务日志记录和优化分析

**⚠️ 重要**: 这是任务完成后的必需流程，两个步骤缺一不可。

**注意**：规则执行校验请参考 `后置-规则校验-2.mdc`。

---

## ✅ 任务完成后必须执行（核心要求，前 50 行）

### 完整工作流检查清单

**⚠️ 全局任务（必须执行）**：每个 Agent 任务完成后必须执行以下两个步骤。

#### 步骤1: 任务日志记录（必须）

- [ ] **确定日志文件位置** - 保存到 `agent-task-log/` 目录（禁止其他目录）
- [ ] **生成文件名称** - 格式：`YYYY-MM-DD-N_任务名称_文档类型.md`
- [ ] **选择文档类型** - 快速摘要/详细过程/实施总结/完成总结/实施方案
- [ ] **记录完整内容** - 任务概述、关键步骤、实施方法、测试情况、执行结果

#### 步骤2: 优化分析（必须）

- [ ] **代码质量分析** - 类型提示、docstring、文件行数、命名规范
- [ ] **架构设计分析** - 三层架构、模块职责、依赖注入
- [ ] **性能分析**（如适用） - 性能瓶颈、内存使用、并发支持
- [ ] **测试分析** - 测试覆盖、测试独立性
- [ ] **可维护性分析** - 文档完整性、日志记录、错误追踪
- [ ] **技术债务识别** - 临时方案、代码异味、重构计划
- [ ] **输出优化建议** - 至少识别2-3个优化点，优先级排序

---

## 📋 详细要求

### 1. 任务日志记录

#### 文件命名规范

格式：`YYYY-MM-DD-N_任务名称_文档类型.md`

- ✅ `agent-task-log/2025-01-27-1_规则合并_完成总结.md`
- ❌ 项目根目录（禁止）
- ❌ 其他目录（禁止）
- ❌ 不符合命名格式（禁止）

#### 文档类型选择

| 文档类型 | 使用场景 | 内容要求 |
|---------|---------|---------|
| **快速摘要** | 任务简要总结 | 1-2段，核心要点 |
| **详细过程** | 完整实施记录 | 时间线、思考过程、修改记录 |
| **实施总结** / **完成总结** | 任务完成后 | 成果、经验教训、后续计划，**必须包含优化分析** |
| **实施方案** | 任务实施前 | 方案设计、技术选型、实施步骤 |

#### 日志内容要求（完成总结类型）

必须包含：
- [ ] 任务概述（任务名称、目标、范围）
- [ ] 关键步骤（按顺序列出）
- [ ] 实施方法（主要技术方案）
- [ ] 测试情况（测试类型、范围、结果）
- [ ] 执行结果（完成状态、核心成果、遗留问题）
- [ ] **优化分析**（必需，见下方）

**注意**：规则执行校验结果请参考 `后置-规则校验-2.mdc`，可在任务日志中单独记录或包含在完成总结中。

---

### 2. 优化分析

#### 分析维度（6个维度）

**代码质量分析**: 类型提示、docstring、文件行数（<300行）、命名规范、导入顺序

**架构设计分析**: 三层架构原则、模块职责单一、依赖注入、接口定义清晰

**性能分析**（如适用）: 性能瓶颈、大数据量测试、内存使用、并发支持

**测试分析**: 单元测试覆盖、集成测试、测试覆盖率≥目标值、测试独立性

**可维护性分析**: 文档完整性、日志记录、错误追踪

**技术债务识别**: 临时方案、代码异味、重构计划

#### 优化分析输出要求

- [ ] **识别优化点** - 至少识别2-3个可优化点
- [ ] **优先级排序** - 高/中/低优先级
- [ ] **输出优化建议** - 具体建议，不只是问题描述
- [ ] **记录到任务日志** - 作为完成总结的一部分

#### 优化分析输出模板

```markdown
## 🔍 任务优化分析

**任务名称**: [任务名称]  
**分析日期**: YYYY-MM-DD  
**分析范围**: [本次任务修改的文件/模块]

### 1. 代码质量分析
#### ✅ 做得好的地方
- [优点1]
- [优点2]

#### ⚠️ 可优化的地方
- **问题1**: [问题描述]
  - **影响**: [影响范围]
  - **优化建议**: [具体建议]
  - **优先级**: 🔴高 / 🟡中 / 🟢低

### 2-6. 架构/性能/测试/可维护性/技术债务分析
[类似格式...]

## 🎯 优化优先级排序
### 高优先级（立即处理）🔴
1. [优化项1]
2. [优化项2]

### 中优先级（近期处理）🟡
1. [优化项1]

### 低优先级（长期规划）🟢
1. [优化项1]
```

---

## 🎯 执行顺序说明

**⚠️ 两个步骤必须顺序执行**：

1. **第一步：任务执行汇报**（见 AGENTS.md）
   - 在对话框中即时汇报，用于用户快速了解进度
   - **不保存文件**，仅在对话中显示
   - 完成后**必须继续执行第二步**

2. **第二步：保存任务日志**（包含优化分析）
   - 保存到 `agent-task-log/` 目录的详细文档
   - **必须保存文件**，提供完整记录和存档
   - 包含：任务概述、实施过程、优化分析

**注意**：规则执行校验请参考 `后置-规则校验-2.mdc`，可在任务日志中单独记录或包含在完成总结中。

**三者关系**：
- 汇报提供快速概览（即时反馈）
- 日志提供详细记录（永久存档，包含优化分析）
- 规则校验确保规则正确执行（参考 `后置-规则校验-2.mdc`）
- **三者缺一不可，顺序执行**

---

## ⚠️ 禁止行为

- ❌ 禁止在项目根目录创建任务总结文档
- ❌ 禁止在其他目录创建任务日志
- ❌ 禁止使用其他文件命名格式
- ❌ 禁止跳过优化分析（完成总结类型必须包含）

**注意**：规则执行校验请参考 `后置-规则校验-2.mdc`。

---
---

**最后更新**: 2025-01-27  
**版本**: v5.0（拆分规则执行校验部分到 `后置-规则校验-2.mdc`）  
**目的**: 专注于任务日志记录和优化分析，规则执行校验由 `后置-规则校验-2.mdc` 负责
