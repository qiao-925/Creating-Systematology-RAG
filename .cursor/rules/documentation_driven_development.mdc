---
description: "文档驱动开发规范 - 结合官方文档生成代码和修复bug的最佳实践"
alwaysApply: false
priority: 2
---

# 文档驱动开发规范

> 在生成代码或修复 bug 时，优先查阅官方文档和示例，提升实现准确率。

---

## 1. 核心原则

**在实现功能或修复 bug 前，优先查阅相关库/框架的官方文档，确保使用正确的 API 和方法。**

---

## 2. 适用场景

### 2.1 应该查阅文档的情况

- ✅ 使用第三方库/框架的新 API
- ✅ 遇到 API 调用错误（如 `AttributeError`、`TypeError`）
- ✅ 不确定正确的调用方式或参数
- ✅ 需要了解版本差异和兼容性
- ✅ 实现复杂功能需要参考官方示例

### 2.2 可以跳过文档的情况

- ⚠️ 使用项目内部已封装的 API
- ⚠️ 简单的语法错误或拼写错误
- ⚠️ 明确的逻辑错误（不涉及外部 API）

---

## 3. 执行流程

### 3.1 问题识别阶段

1. **识别问题类型**：
   - API 调用错误（方法不存在、参数错误等）
   - 行为不符合预期（可能是 API 使用方式错误）
   - 版本兼容性问题

2. **收集错误信息**：
   - 完整的错误堆栈
   - 相关代码片段
   - 使用的库/框架版本

### 3.2 文档查阅阶段

1. **查找官方文档**：
   - 优先使用官方文档网站
   - 搜索相关 API 参考文档
   - 查找使用示例和教程

2. **验证 API 用法**：
   - 确认正确的方法名和调用方式
   - 检查必需的参数和可选参数
   - 了解版本差异和兼容性

3. **查找类似问题**：
   - 搜索 GitHub Issues
   - 查找 Stack Overflow 相关问题
   - 参考社区讨论和最佳实践

### 3.3 实施修复阶段

1. **基于文档实现**：
   - 使用文档中的正确 API
   - 参考官方示例代码
   - 遵循推荐的最佳实践

2. **添加兼容性处理**：
   - 检测 API 可用性
   - 提供降级方案
   - 记录版本差异

3. **验证修复效果**：
   - 运行测试确认修复
   - 检查是否引入新问题
   - 验证在不同场景下的表现

---

## 4. AI Agent 行为要求

### 4.1 遇到 API 错误时

**必须执行以下步骤**：

1. **立即停止猜测**：
   - ❌ 不要基于错误信息猜测正确的 API
   - ❌ 不要尝试多种可能的调用方式
   - ✅ 先查阅官方文档

2. **使用 web_search 工具**：
   - 搜索官方文档和 API 参考
   - 查找使用示例
   - 了解版本差异

3. **基于文档实现**：
   - 使用文档中的正确 API
   - 参考官方示例
   - 添加必要的错误处理

### 4.2 实现新功能时

**应该执行以下步骤**：

1. **查阅相关文档**：
   - 了解 API 的正确用法
   - 查找最佳实践示例
   - 确认版本兼容性

2. **创建文档摘要**：
   - 记录关键 API 和用法
   - 保存官方文档链接
   - 记录版本差异和注意事项

3. **基于文档实现**：
   - 使用正确的 API
   - 遵循推荐模式
   - 添加必要的兼容性处理

### 4.3 代码审查时

**应该检查**：

1. **API 使用是否正确**：
   - 是否使用了正确的 API
   - 参数是否正确
   - 是否有版本兼容性问题

2. **是否有文档参考**：
   - 是否查阅了官方文档
   - 是否有文档链接或引用
   - 是否记录了关键信息

---

## 5. 最佳实践示例

### 示例 1：修复 API 调用错误

**问题**：`AttributeError: 'ReActAgent' object has no attribute 'chat'`

**错误做法**：
```python
# ❌ 直接猜测其他方法名
response = agent.query(question)  # 可能也不存在
```

**正确做法**：
```python
# ✅ 1. 查阅官方文档
# ✅ 2. 发现 run() 方法需要 Context 参数
from llama_index.core.workflow import Context

# ✅ 3. 基于文档实现
ctx = Context(agent)
response = await agent.run(question, context=ctx)
```

### 示例 2：实现新功能

**需求**：使用 LlamaIndex ReActAgent 实现 Agentic RAG

**正确流程**：
1. 查阅 [LlamaIndex Agentic RAG 文档](https://docs.llamaindex.ai/en/stable/module_guides/deploying/agent/agentic_rag/)
2. 查找 ReActAgent 使用示例
3. 了解版本差异和兼容性
4. 基于文档实现代码
5. 创建文档摘要供后续参考

---

## 6. 文档管理

### 6.1 文档位置

- **项目文档**：`docs/` 目录
- **任务日志**：`agent-task-log/` 目录
- **规则文件**：`.cursor/rules/` 目录

### 6.2 文档格式

- **API 使用说明**：Markdown 格式，包含：
  - 官方文档链接
  - 基本使用方式
  - 关键问题和解决方案
  - 版本差异说明
  - 调试建议

- **任务日志**：记录：
  - 查阅的文档和链接
  - 发现的关键信息
  - 基于文档的修复方案
  - 验证结果

---

## 7. 验收标准

- [ ] 遇到 API 错误时，已查阅官方文档
- [ ] 实现基于官方文档和示例
- [ ] 添加了必要的兼容性处理
- [ ] 创建了文档摘要或使用说明
- [ ] 代码通过测试验证

---

## 8. 相关规则

- `task_closure_guidelines.mdc` - 任务收尾规范
- `workflow_requirements_and_decisions.mdc` - 需求与方案决策规范
- `testing_and_diagnostics_guidelines.mdc` - 测试与诊断规范

---

## 9. 版本信息

- **最后更新**：2026-01-14
- **版本**：v1.0
- **创建原因**：ReActAgent 修复过程中发现，查阅文档能显著提升修复准确率
