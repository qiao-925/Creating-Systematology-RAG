---
description: "浏览器可视化编辑器集成规范 - 将 Cursor 浏览器可视化编辑器功能集成到前端开发和测试工作流"
globs:
  - "frontend/**/*.py"
  - "tests/ui/**/*.py"
  - "tests/e2e/**/*.py"
alwaysApply: false
priority: 2
---

# 浏览器可视化编辑器集成规范

> 将 Cursor 浏览器可视化编辑器功能集成到前端开发和测试工作流，实现可视化 UI 测试、实时编辑和自动化验证。

---

## ⚠️ 核心价值

**Cursor 浏览器可视化编辑器（v2.2+）提供了革命性的前端开发体验：**
- **可视化编辑**：拖拽操作、视觉属性调整、实时预览
- **自动化测试**：截图、控制台监控、网络流量追踪
- **无障碍审计**：自动检查 WCAG 标准合规性
- **设计到代码**：从设计稿直接生成代码

---

## 1. 快速开始（命令式自动化）

### 1.1 一键启动并打开浏览器

**使用命令**：
```
/browser-start
```

**功能**：
- 自动检查应用是否运行
- 如未运行，自动启动 Streamlit 应用
- 自动在浏览器中打开应用
- 截图记录初始状态

### 1.2 可视化编辑 UI

**使用命令**：
```
/browser-edit <编辑描述>
```

**示例**：
```
/browser-edit 调整聊天输入框圆角为 20px，边框颜色改为 #6366f1
```

**功能**：
- 自动打开浏览器
- 定位目标元素
- 使用可视化编辑器调整
- 自动应用更改到代码
- 验证效果

### 1.3 自动化测试

**使用命令**：
```
/browser-test <测试类型>
```

**示例**：
```
/browser-test 功能测试 - 测试聊天输入和查询响应
/browser-test 视觉回归 - 对比主页和聊天界面
/browser-test 响应式 - 测试不同屏幕尺寸
```

**功能**：
- 自动执行测试场景
- 截图记录关键状态
- 检查控制台错误
- 生成测试报告

### 1.4 无障碍审计

**使用命令**：
```
/browser-a11y
```

**功能**：
- 自动检查颜色对比度
- 验证键盘导航
- 检查 ARIA 标签
- 生成改进建议

### 1.5 视觉回归测试

**使用命令**：
```
/browser-visual-regression
```

**功能**：
- 截图记录当前状态
- 与基准截图对比
- 识别视觉差异
- 生成对比报告

---

## 2. 应用启动配置（手动方式）

### 2.1 启动命令

**标准启动方式**：
```bash
# 方式1：使用 Makefile（推荐）
make run

# 方式2：直接启动
uv run --no-sync python -m streamlit run app.py
```

**默认访问地址**：
- `http://localhost:8501`（Streamlit 默认端口）

### 1.2 开发模式启动

**热重载模式**（适合浏览器可视化编辑）：
```bash
# Streamlit 默认支持热重载，修改代码后自动刷新
uv run --no-sync python -m streamlit run app.py --server.headless true
```

**自定义端口**（避免端口冲突）：
```bash
uv run --no-sync python -m streamlit run app.py --server.port 8502
```

### 1.3 浏览器上下文配置

**在 Cursor 中配置浏览器模式**：
1. 打开 `Cursor Settings`（`Cmd/Ctrl + ,`）
2. 前往 **Tools & MCP** → **Browser Automation**
3. 选择浏览器上下文：
   - **Chrome**：独立 Chrome 进程（全屏浏览）
   - **Browser Tab**：Cursor 内部面板（推荐，便于可视化编辑）

---

## 3. 工作流集成场景

### 3.1 UI 开发工作流（命令式）

**场景：开发新的前端组件**

**方式1：使用命令（推荐）**
```
/browser-start
/browser-edit 调整聊天输入框的圆角为 16px，侧边栏背景色改为 #f0f4f8，增加按钮的 hover 阴影效果
```

**方式2：传统方式**
```
1. 启动应用
   ↓
2. 在 Cursor 中使用 @browser 打开 http://localhost:8501
   ↓
3. 使用可视化编辑器调整 UI
   - 拖拽元素调整位置
   - 调整颜色、间距、字体
   - 实时预览效果
   ↓
4. 点击"应用"按钮
   ↓
5. Agent 自动更新代码
   ↓
6. 热重载自动刷新，验证更改
```

### 3.2 UI 测试工作流（命令式）

**场景：自动化 UI 测试**

**方式1：使用命令（推荐）**
```
/browser-test 功能测试 - 测试聊天输入和查询响应
```

**方式2：传统方式**
```
1. 启动应用（后台运行）
   ↓
2. 在 Cursor 中使用 @browser 执行测试
   ↓
3. 自动化测试流程：
   - 截图记录初始状态
   - 填写表单、点击按钮
   - 验证响应式设计
   - 监控控制台错误
   - 检查网络请求
   ↓
4. 生成测试报告（截图 + 日志）
```

### 3.3 无障碍审计工作流（命令式）

**场景：检查并改进无障碍访问性**

**方式1：使用命令（推荐）**
```
/browser-a11y 检查主页和聊天界面的无障碍性
```

**方式2：传统方式**
```
1. 启动应用
   ↓
2. 使用 @browser 执行无障碍审计
   ↓
3. 自动检查：
   - 颜色对比度
   - 语义化 HTML
   - ARIA 标签
   - 键盘导航
   - Alt 文本
   ↓
4. 生成改进建议
   ↓
5. 使用可视化编辑器修复问题
```

### 3.4 视觉回归测试工作流（命令式）

**场景：验证 UI 更改未破坏现有界面**

**方式1：使用命令（推荐）**
```
/browser-visual-regression 对比主页和聊天界面
```

**方式2：传统方式**
```
1. 启动应用
   ↓
2. 使用 @browser 截图记录基准状态
   ↓
3. 修改代码
   ↓
4. 重新截图并对比
   ↓
5. 识别视觉差异
   ↓
6. 验证差异是否预期
```

---

## 4. 与现有测试体系集成

### 4.1 测试金字塔扩展

**原有测试结构**：
```
        /\
       /  \     E2E Tests (端到端测试)
      /____\    
     /      \   Integration Tests (集成测试)
    /________\  
   /          \ Unit Tests (单元测试)
  /____________\
```

**扩展后的测试结构**：
```
        /\
       /  \     Browser E2E Tests (浏览器端到端测试)
      /____\    - 可视化测试
     /      \   - 视觉回归测试
    /________\  - 无障碍审计
   /          \ Unit Tests (单元测试)
  /____________\
```

### 4.2 测试文件组织

**建议目录结构**：
```
tests/
├── ui/                          # 原有 UI 单元测试
│   └── test_app.py
├── e2e/                          # 原有 E2E 测试
│   └── test_core_workflows.py
└── browser/                     # 新增：浏览器测试
    ├── test_ui_automation.py    # UI 自动化测试
    ├── test_visual_regression.py # 视觉回归测试
    ├── test_accessibility.py    # 无障碍审计
    └── README.md                # 浏览器测试说明
```

### 4.3 测试执行流程

**集成到现有测试命令**：
```bash
# 原有测试命令
make test              # 运行所有测试
make test-unit        # 单元测试
make test-integration # 集成测试

# 新增浏览器测试命令（建议）
make test-browser     # 浏览器自动化测试
make test-visual      # 视觉回归测试
make test-a11y        # 无障碍审计
```

---

## 5. AI Agent 行为要求

### 5.1 前端开发时

**优先使用命令式工作流**：

1. **创建新组件时**：
   - [ ] 使用 `/browser-start` 启动应用
   - [ ] 使用 `/browser-edit` 进行可视化编辑
   - [ ] 验证效果

2. **修改现有组件时**：
   - [ ] 使用 `/browser-edit` 描述修改需求
   - [ ] Agent 自动定位并调整
   - [ ] 应用更改并验证

3. **优化 UI 时**：
   - [ ] 使用 `/browser-edit` 快速迭代
   - [ ] 实时预览效果
   - [ ] 应用更改后更新代码

### 5.2 前端开发时（传统方式）

**必须主动使用浏览器可视化编辑器**：

1. **创建新组件时**：
   - [ ] 启动应用后，使用 `@browser` 打开页面
   - [ ] 使用可视化编辑器调整样式
   - [ ] 应用更改后验证效果

2. **修改现有组件时**：
   - [ ] 使用 `@browser` 查看当前状态
   - [ ] 使用可视化编辑器调整
   - [ ] 应用更改并验证

3. **优化 UI 时**：
   - [ ] 使用可视化编辑器快速迭代
   - [ ] 实时预览效果
   - [ ] 应用更改后更新代码

### 5.3 UI 测试时

**优先使用命令式工作流**：

1. **功能测试**：
   - [ ] 使用 `/browser-test 功能测试` 执行测试
   - [ ] 自动截图和生成报告

2. **视觉测试**：
   - [ ] 使用 `/browser-visual-regression` 执行回归测试
   - [ ] 自动对比和生成报告

3. **无障碍测试**：
   - [ ] 使用 `/browser-a11y` 执行审计
   - [ ] 自动生成改进建议

### 5.4 UI 测试时（传统方式）

**必须使用浏览器自动化功能**：

1. **功能测试**：
   - [ ] 使用 `@browser` 执行交互测试
   - [ ] 截图记录关键状态
   - [ ] 监控控制台错误
   - [ ] 验证网络请求

2. **视觉测试**：
   - [ ] 截图记录基准状态
   - [ ] 修改后重新截图
   - [ ] 对比差异

3. **无障碍测试**：
   - [ ] 执行无障碍审计
   - [ ] 生成改进建议
   - [ ] 修复问题

### 5.5 代码审查时

**必须检查浏览器测试覆盖**：

1. **新功能审查**：
   - [ ] 是否有浏览器测试覆盖？
   - [ ] 是否有视觉回归测试？
   - [ ] 是否通过无障碍审计？

2. **UI 更改审查**：
   - [ ] 是否有前后对比截图？
   - [ ] 是否验证了响应式设计？
   - [ ] 是否检查了控制台错误？

---

## 6. 最佳实践

### 6.1 可视化编辑工作流（命令式优先）

**推荐流程**：
1. **先设计后编码**：使用可视化编辑器快速原型
2. **实时迭代**：边调整边预览，快速验证想法
3. **应用更改**：确认效果后应用，Agent 自动更新代码
4. **验证测试**：应用更改后运行浏览器测试

### 6.2 测试策略（命令式优先）

**测试优先级**：
1. **核心功能**：聊天输入、查询响应、配置面板
2. **关键交互**：按钮点击、表单提交、弹窗操作
3. **视觉一致性**：主题切换、响应式布局
4. **无障碍性**：键盘导航、屏幕阅读器支持

### 6.3 截图管理

**截图命名规范**：
```
screenshots/
├── baseline/              # 基准截图
│   ├── home_page.png
│   ├── chat_interface.png
│   └── settings_panel.png
├── current/              # 当前截图
│   └── ...
└── diff/                 # 差异截图
    └── ...
```

**截图时机**：
- 新功能开发前：记录基准状态
- 功能开发后：记录新状态
- 代码修改后：对比差异

---

## 7. 常见场景示例（命令式）

### 7.1 场景：调整聊天输入框样式

**命令式（推荐）**：
```
/browser-edit 调整聊天输入框圆角为 20px，边框颜色为 #6366f1，内边距为 16px
```

**传统方式**：
```
@browser 打开 http://localhost:8501，使用可视化编辑器：
1. 选中聊天输入框
2. 调整圆角为 20px
3. 调整边框颜色为 #6366f1
4. 增加内边距为 16px
5. 应用更改并验证效果
```

**预期结果**：
- Agent 自动更新 `frontend/main.py` 中的 CSS
- 热重载自动刷新，显示新样式
- 验证样式是否正确应用

### 7.2 场景：测试响应式设计

**命令式（推荐）**：
```
/browser-test 响应式 - 测试不同屏幕尺寸
```

**传统方式**：
```
@browser 打开 http://localhost:8501，测试响应式设计：
1. 截图记录桌面视图（1920x1080）
2. 调整窗口大小为平板视图（768x1024），截图
3. 调整窗口大小为手机视图（375x667），截图
4. 验证布局是否适配
5. 检查是否有元素溢出或重叠
```

**预期结果**：
- 生成三个不同尺寸的截图
- 识别响应式问题
- 提供改进建议

### 7.3 场景：无障碍审计

**命令式（推荐）**：
```
/browser-a11y 检查主页和聊天界面的无障碍性
```

**传统方式**：
```
@browser 打开 http://localhost:8501，执行无障碍审计：
1. 检查颜色对比度（WCAG AA 标准）
2. 验证键盘导航（Tab 键顺序）
3. 检查 ARIA 标签
4. 验证语义化 HTML
5. 生成改进建议报告
```

**预期结果**：
- 识别无障碍问题
- 生成改进建议
- 提供修复方案

---

## 8. 限制与注意事项

### 8.1 技术限制

**Streamlit 限制**：
- Streamlit 使用 iframe 渲染，某些浏览器功能可能受限
- 热重载可能导致浏览器状态丢失
- 某些自定义 CSS 可能无法通过可视化编辑器直接编辑

**解决方案**：
- 优先使用 Streamlit 原生组件
- 复杂样式通过代码直接修改
- 使用浏览器测试验证效果

### 8.2 测试稳定性

**注意事项**：
- 浏览器测试可能受网络延迟影响
- 截图对比可能因字体渲染差异而失败
- 控制台错误可能来自第三方库

**解决方案**：
- 使用稳定的测试数据
- 设置合理的超时时间
- 过滤第三方库错误

### 8.3 性能考虑

**注意事项**：
- 浏览器测试比单元测试慢
- 截图和网络监控会增加测试时间
- 视觉回归测试需要存储大量截图

**解决方案**：
- 浏览器测试作为 CI/CD 的补充，不替代单元测试
- 使用增量截图策略
- 定期清理旧截图

---

## 9. 集成检查清单

### 9.1 初始设置

- [ ] 配置浏览器上下文（Chrome 或 Browser Tab）
- [ ] 验证应用可以正常启动（`make run`）
- [ ] 测试浏览器可以访问 `http://localhost:8501`
- [ ] 验证可视化编辑器可以正常使用

### 9.2 开发工作流

- [ ] 创建浏览器测试目录结构
- [ ] 编写核心功能的浏览器测试
- [ ] 建立截图管理流程
- [ ] 集成到现有测试命令

### 9.3 持续改进

- [ ] 定期执行无障碍审计
- [ ] 维护视觉回归测试基准
- [ ] 优化浏览器测试性能
- [ ] 更新测试文档

---

## 10. 相关资源

### 10.1 Cursor 文档

- [Browser 功能文档](https://cursor.com/cn/docs/agent/browser)
- [Web Development Cookbook](https://cursor.com/cn/docs/cookbook/web-development)

### 10.2 项目文档

- `README.md`：项目启动说明
- `tests/README.md`：测试体系说明
- `frontend/main.py`：前端入口

### 10.3 工具参考

- Streamlit 文档：https://docs.streamlit.io/
- WCAG 标准：https://www.w3.org/WAI/WCAG21/quickref/

---

## 11. 可用命令列表

### 11.1 命令总览

| 命令 | 功能 | 使用场景 |
|------|------|----------|
| `/browser-start` | 启动应用并打开浏览器 | 开始浏览器操作前 |
| `/browser-edit <描述>` | 可视化编辑 UI | 调整样式、布局 |
| `/browser-test <类型>` | 自动化测试 | 功能测试、响应式测试 |
| `/browser-a11y` | 无障碍审计 | 检查无障碍性 |
| `/browser-visual-regression` | 视觉回归测试 | 验证 UI 未破坏 |
| `/browser-restart-and-test` | **重启并测试（自动上下文分析）** | **修复后验证（推荐，无需提供测试内容）** |

### 11.2 命令组合使用

**修复后验证流程（最常用）**：
```
/browser-restart-and-test
```
- **自动分析上下文**：从对话历史、代码变更中提取测试内容
- **自动生成测试场景**：根据修复内容智能生成验证点
- 一键完成：重启 → 测试 → 验证 → 报告
- 自动过滤已知警告
- **无需用户提供测试内容**：完全自动化

**示例**：
```
用户：修复完成，主题配置修复，CSS样式增强
用户：/browser-restart-and-test

Agent 自动：
1. 分析修复内容（主题、CSS）
2. 生成验证点（主题配置、样式应用、控制台错误）
3. 执行测试
4. 生成报告
```

**完整 UI 开发流程**：
```
/browser-start
/browser-edit 调整聊天输入框样式
/browser-test 功能测试
/browser-visual-regression
```

**无障碍改进流程**：
```
/browser-start
/browser-a11y
/browser-edit 修复颜色对比度问题
/browser-a11y  # 再次验证
```

**修复后完整验证流程**：
```
/browser-restart-and-test 全部 - 验证所有修复点
```

---

## 12. 版本信息

- **创建日期**：2026-01-23
- **版本**：v1.0
- **目标**：将 Cursor 浏览器可视化编辑器集成到前端开发和测试工作流
