---
description: 执行规则设计 - 规则设计或优化任务时必须遵循的设计原则 - 创建新规则、优化现有规则、评估规则系统时使用
alwaysApply: false
---
# 规则设计原则与最佳实践

> **核心目的**：定义规则系统设计时必须遵循的原则，确保规则简洁、清晰、可执行

**⚠️ 重要**：这是规则系统的元规则，用于指导所有规则的设计和优化。

---

## ✅ 1. 规则简洁性原则（最重要）

### 1.1 行数限制

- ✅ **单条规则不超过 300 行**（与代码文件限制一致）
- ✅ **核心要求在前 50 行**（最重要的内容放在前面）
- ✅ **使用检查清单**而非长篇描述（便于AI快速扫描）
- ✅ **关键规则强制校验**（通过规则执行校验机制确保执行）

### 1.2 内容组织

- ✅ **核心要求优先**：最重要的规则和要求放在文档前50行
- ✅ **检查清单格式**：使用 `- [ ]` 格式而非段落描述
- ✅ **避免冗余**：删除重复描述，保持内容精简
- ✅ **分层结构**：使用清晰的标题层级（H2/H3/H4）

---

## ✅ 2. 规则清晰性原则

### 2.1 描述清晰

- ✅ **description 字段必须清晰**：Agent Requested 规则的 description 必须明确说明使用场景
- ✅ **使用场景明确**：规则应该明确说明何时、何处、如何使用
- ✅ **避免模糊表述**：使用具体、可操作的描述

### 2.2 格式规范

- ✅ **统一的表格格式**：规则清单使用统一的表格格式
- ✅ **一致的命名规范**：规则文件名使用 `kebab-case.mdc` 格式
- ✅ **完整的元数据**：所有规则必须包含 description 字段

---

## ✅ 3. 规则分层架构原则

### 3.1 分层设计

- ✅ **Always 规则**（5个核心）：最小化，只包含最核心的规则
- ✅ **Auto Attached 规则**（2个）：按文件路径自动附加，减少默认负担
- ✅ **Agent Requested 规则**（7个）：AI自己决定是否包含（基于description）
- ✅ **Manual 规则**（1个）：需要明确@引用

### 3.2 数量控制

- ✅ **Always 规则数量控制在 5 个以内**（核心规则）
- ✅ **每个 Always 规则控制在 300 行以内**
- ✅ **Always 规则总行数控制在 800-1000 行以内**

---

## ✅ 4. 规则可执行性原则

### 4.1 检查清单格式

- ✅ **使用检查清单**：`- [ ]` 格式，便于AI快速扫描和执行
- ✅ **明确的步骤**：每个步骤应该清晰、可执行
- ✅ **避免抽象描述**：使用具体的操作指引

### 4.2 强制校验机制

- ✅ **规则执行校验**：通过规则执行校验机制确保规则被执行
- ✅ **规则执行日志**：生成规则执行日志，检测规则系统健康度
- ✅ **未执行规则补救**：发现未执行规则后立即补救

---

## ✅ 5. 规则类型选择指南

### 5.1 选择原则

- ✅ **Always**: 最核心、最通用、所有任务都需要（5个核心）
- ✅ **Auto Attached**: 根据文件路径自动附加（特定目录）
- ✅ **Agent Requested**: AI可以自己决定是否包含（场景特定，需要清晰description）
- ✅ **Manual**: 需要明确@引用（特殊场景）

### 5.2 类型判断检查清单

选择规则类型时，检查以下问题：

- [ ] 这个规则是否所有任务都需要？（是 → Always）
- [ ] 这个规则是否只在特定文件路径下需要？（是 → Auto Attached）
- [ ] 这个规则是否只在特定场景下需要？（是 → Agent Requested）
- [ ] 这个规则是否只在明确引用时使用？（是 → Manual）

---

## ✅ 6. 规则文档规范

### 6.1 文档结构

- ✅ **标题带序号**：所有文档标题（H2/H3/H4）必须带序号
- ✅ **文档长度限制**：单个文档 ≤ 300 行
- ✅ **章节层次清晰**：使用合理的标题层级（H2 → H3 → H4）

### 6.2 元数据规范

- ✅ **description 字段**：必须清晰说明规则用途和使用场景
- ✅ **alwaysApply 字段**：Always 规则设为 `true`，其他设为 `false`
- ✅ **globs 字段**：Auto Attached 规则必须包含 globs 配置

---

## ✅ 7. 规则优化原则

### 7.1 优化时机

- ✅ **规则超限时**：超过 300 行时考虑拆分
- ✅ **规则失效时**：发现规则被忽略时优化描述
- ✅ **规则冲突时**：发现规则冲突时重新设计

### 7.2 优化方法

- ✅ **拆分策略**：按功能、模块、职责拆分
- ✅ **精简策略**：删除冗余描述，保留核心要求
- ✅ **合并策略**：合并相关规则，减少规则数量

---

## 📋 规则设计检查清单

创建或修改规则时，检查以下项目：

- [ ] **行数检查**：规则文件 ≤ 300 行
- [ ] **核心要求在前**：最重要的内容在前 50 行
- [ ] **检查清单格式**：使用 `- [ ]` 格式而非段落描述
- [ ] **description 清晰**：Agent Requested 规则的 description 明确说明使用场景
- [ ] **规则类型正确**：根据使用场景选择正确的规则类型
- [ ] **标题带序号**：所有标题（H2/H3/H4）带序号
- [ ] **元数据完整**：包含 description、alwaysApply、globs（如需要）

---

## 🎯 规则设计最佳实践

### 实践1：核心要求前置

```markdown
## ✅ 核心要求（前 50 行，最重要）

- [ ] 要求1
- [ ] 要求2
- [ ] 要求3

---

## 📋 详细说明（后续内容）

详细说明...
```

### 实践2：使用检查清单

```markdown
❌ 不好的格式：
规则要求开发者必须使用日志记录，而不是print语句。

✅ 好的格式：
- [ ] **使用日志代替 print** - 所有业务代码必须使用 logging 模块记录日志，禁止使用 print 语句
```

### 实践3：清晰的 description

```markdown
❌ 不好的 description：
测试规则

✅ 好的 description：
代码修改任务后必须运行单元测试验证 - 简化版测试规则，适用于代码修改场景
```

---

## 📚 参考文档

- 规则系统架构：`.cursor/rules/README.md`
- 规则执行监控：`后置-规则监控-3.mdc`
- 规则文件组织：`任务中-文档规范-2.mdc`

---

**最后更新**: 2025-11-05  
**版本**: v1.0  
**目的**: 确保规则系统设计的一致性和可执行性
