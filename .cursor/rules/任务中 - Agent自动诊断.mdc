---
description: 任务中 - Agent自动诊断工作流 - 人机协作要点与诊断流程
alwaysApply: true
---

# 任务中 - Agent自动诊断

> 保障执行中自主排障、及时升级与充分沟通的最低要求，适用于所有任务阶段的自检与协同。

---

## 1. 适用范围
- 执行方案已确认但在实现/测试中遇到问题的任何任务。
- 包括排查报错、理解日志、确认配置、补齐缺失信息等。

---

## 2. 执行清单

### 2.1 自主诊断
- [ ] 最多尝试 3 轮排查；记录每次思路与结果。
- [ ] 逐项检查：错误日志 → 配置 → 依赖/环境 → 逻辑实现。
- [ ] 复盘是否存在计划外改动或遗漏的前提条件。

### 2.2 实施规范
- [ ] 仅在方案与步骤明确后动手执行；遵循最小改动原则。
- [ ] 参考既有业务实现，保持代码与文档风格一致。
- [ ] 重要修改前后都运行必要的单元测试（联合测试遵循测试规则）。

### 2.3 文档与记录
- [ ] 任务日志记录：起止时间、关键行动、尝试与结果、失败原因。
- [ ] 说明已尝试的排查路径，避免用户重复指导。
- [ ] 若产生临时改动/日志，请在问题解决后清理。

### 2.4 升级判断
- [ ] 判断是否触发升级条件：尝试 3 次无果、出现新风险、涉及架构/安全决策。
- [ ] 升级时提供选项而非单一结论，并解释推荐理由。
- [ ] 重大决策、风险取舍、长期成本影响需等待用户确认。

---

## 3. 协作流程速览
- 正常流程：自主诊断 → 执行实现 → 运行测试 → 记录成果 → 进入后置流程。
- 失败流程：尝试 1/2/3 → 仍失败即刻上报 → 待用户指导后继续。
- 决策流程：识别争议/不确定点 → 汇报现状与选项 → 用户确认 → 继续执行。

---

## 4. 自检清单
- [ ] 当前任务属于明确的实现或排障范围。
- [ ] 已确认方案、参考实现与依赖。
- [ ] 排障尝试少于 3 次。
- [ ] 若需要用户介入，已准备好背景信息与选项。

---

## 5. 禁止事项
- ❌ 隐藏失败尝试或未记录的临时操作。
- ❌ 超过 3 次失败仍自行尝试不求助。
- ❌ 重大决策自行拍板或跳过方案确认。
- ❌ 过度生成无关文档造成噪音。

---

## 6. 关联规则
- 需求/方案/决策：`前置规则 - 需求 - 方案 - 决策.mdc`
- 测试流程：`任务中 - 代码修改后触发自动测试.mdc`
- 协作记录：`后置规则 - agent任务日志生成.mdc`

---

## 7. 版本信息

- **最后更新**：2025-11-09
- **版本**：v2.0（清单化诊断流程并合并协作指引）
