---
description: 需求与方案决策规范 - 方案讨论任务必须遵循的完整流程
alwaysApply: true
---
# 需求与方案决策规范

> 适用于所有需要明确需求、设计方案或进行结构性决策的任务，禁止在方案未确认前直接执行实现。

---

## 1. 适用范围与触发条件
- 任务目标尚未成文、存在多种实现路径或需要权衡时，必须加载本规则。
- 若任务中出现新的争议或风险点，也需回到本规则重新确认后续动作。

---

## 2. 执行清单

### 2.1 需求理解
- [ ] 阅读并复述用户目标，明确核心功能点与优先级。
- [ ] 标记功能、技术、时间三类边界；列出关键约束（性能、资源、兼容性等）。
- [ ] 识别潜在风险：技术难点、外部依赖、时间瓶颈、兼容问题。
- [ ] 补齐背景：查找现有实现或模式，必要时向用户索取示例或代码参考。

### 2.2 方案设计
- [ ] 至少提出 2-3 个候选方案，并说明适用场景。
- [ ] 对每个方案补充：实现思路、优劣势、风险点、需要的输入或前置条件。
- [ ] 拆解实施依赖：按顺序列出模块与步骤（A → B → C）。
- [ ] 明确影响范围：列出需修改/新增的文件或接口，说明职责变化。
- [ ] 总结测试要点：单元/集成/边界/异常检查项，标记必须新增的测试。

### 2.3 决策确认
- [ ] 与用户同步所有方案要点，停止自行选择单一方案。
- [ ] 针对下列情形必须等待用户决策：架构/技术选型、性能与维护性取舍、技术债务或临时方案。
- [ ] 争议或不确定时立即升级：说明原因、给出可行选项、记录推荐理由。
- [ ] 用户确认后，再次核对依赖、文件路径、测试要点与交付节奏。

---

## 3. 输出要求
- [ ] 以 Markdown 形式整理“需求概述 + 方案对比 + 推荐建议”。
- [ ] 方案文档中包含依赖顺序、文件列表、测试要点与风险提示。
- [ ] 引用 `agent-task-log/` 中的相关日志或案例为参考（如有）。
- [ ] 方案确认结果需要在对话中明确记录，确保双方无歧义。

---

## 4. 决策升级与沟通模板
- 高优先级事项（架构、长周期成本、关键风险）必须等待用户确认后执行。
- 中优先级事项（实现方式、文件组织、命名争议）建议同步后再行动。
- 低优先级事项（局部风格、变量命名）可自行处理，但需保持一致性。
- 需要决策时使用以下模板（可引用本规则）：
  - “问题描述 / 背景 / 方案 A vs B / 推荐理由 / 等待选择”

---

## 5. 禁止事项
- ❌ 方案未确认前直接改代码或文档。
- ❌ 对重大决策单方面定案，不向用户汇报。
- ❌ 隐藏风险、争议点或技术债务。
- ❌ 提供单一方案或缺少风险评估。

---

## 6. 版本信息

- **最后更新**：2025-11-09
- **版本**：v3.0（重构为清单化执行，明确输出与升级流程）
