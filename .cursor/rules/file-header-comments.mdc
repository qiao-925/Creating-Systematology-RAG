---
description: "代码文件顶部注释规范"
globs:
  - "**/*.sh"
  - "**/*.js"
  - "**/*.ts"
  - "**/*.py"
  - "**/*.java"
  - "**/*.go"
alwaysApply: true
priority: 1
---

# 代码文件顶部注释规范

## 核心规则

**所有代码文件（.sh, .js, .ts, .py, .java, .go 等）必须在文件顶部包含功能描述注释。**

## 强制要求

### 1. 注释位置

- **必须位置**：文件的第一行或第二行（shebang 之后）开始
- **格式要求**：使用注释符号（`#`、`//`、`/* */` 等，根据语言而定）

### 2. 注释内容要求

每个文件的顶部注释**必须**包含以下内容（按优先级排序）：

1. **核心功能概述**（必需，最重要）
   - 第一句话直接说明文件是干什么的
   - 1-2句话概括，让人立即理解

2. **主要接口/功能**（必需）
   - 列出主要函数/类/方法
   - **重点说明功能，而非实现细节**
   - 使用简洁列表，避免展开每个方法的详细说明

3. **快速开始示例**（推荐，特别是包/模块级别）
   - 提供最简单的使用示例
   - 帮助用户快速上手

4. **模块结构**（可选，仅包/模块级别）
   - 简要说明文件组织，**不要详细展开每一层**
   - 一句话带过即可

5. **设计说明**（可选，仅复杂模块）
   - 一句话说明设计理念
   - **避免长篇大论**

**禁止事项**：
- ❌ 详细描述架构分层（如"服务层、数据源层、解析层"的详细展开）
- ❌ 重复代码中已明确的信息
- ❌ 冗长的执行流程描述（除非是脚本文件）
- ❌ 过多的特性列表（只保留关键特性）

### 3. 注释风格要求

- **简洁精准**：避免冗长描述，控制在30行以内（包级别可适当放宽）
- **功能优先**：突出"做什么"，而非"怎么组织"
- **快速理解**：让人读后能立即明白文件的核心作用
- **避免冗余**：不重复代码中已明确的信息
- **架构简化**：模块结构简要说明即可，不要详细展开每一层

### 4. 注释模板

#### Shell 脚本模板

```bash
#!/bin/bash
# [模块名称]：简要功能描述
#
# 主要功能：
#   - function1()：功能说明
#   - function2()：功能说明
#   - function3()：功能说明
#
# 执行流程：
#   1. 步骤1
#   2. 步骤2
#   3. 步骤3
#
# 特性：
#   - 特性1
#   - 特性2
```

#### 其他语言模板

根据语言使用相应的注释格式，但内容结构相同。

## AI Agent 行为要求

1. **创建新文件时**：
   - 必须自动添加符合规范的文件顶部注释
   - **优先描述功能，少描述架构**
   - 控制篇幅，避免冗长

2. **修改现有文件时**：
   - 如果文件缺少顶部注释，必须添加
   - 如果文件顶部注释不完整，必须补充
   - **如果文件顶部注释过于复杂或冗长，必须精简**
   - 检查是否包含过多架构描述，如有则简化

3. **注释优化原则**：
   - **功能优先**：更多说"做什么"，少说"怎么组织"
   - **精准简洁**：删除冗余信息，保留核心要点
   - **快速理解**：让人读后能立即心领神会
   - **控制篇幅**：单个文件注释不超过30行（包级别可适当放宽）

4. **注释检查**：
   - 在代码审查时检查文件顶部注释
   - 确保注释与实际代码功能一致
   - **确保注释简洁精准，避免冗余和架构细节的过度展开**

## 示例

### 示例 1：Shell 脚本

```bash
#!/bin/bash
# GitHub 仓库批量克隆脚本：极简设计，专注于核心功能
#
# 主要功能：
#   - parse_args()：解析命令行参数（-t 并行任务数，-c 并行传输数）
#   - parse_repo_groups()：读取并解析 REPO-GROUPS.md 配置文件
#   - execute_parallel_clone()：并行批量克隆所有仓库
#   - print_summary()：输出最终统计报告
#
# 执行流程：
#   1. 解析命令行参数
#   2. 加载配置文件
#   3. 构建克隆任务列表
#   4. 并行执行克隆
#   5. 输出统计报告
#
# 特性：
#   - 双重并行：应用层并行（-t） + Git 层并行传输（-c）
#   - 直接覆盖：不检查仓库是否存在，直接克隆
#   - 完整克隆：全部使用完整克隆，不使用浅克隆
```

### 示例 2：Python 包（__init__.py）

```python
"""
数据加载器模块 - 统一的数据导入服务

核心功能：从本地目录或GitHub仓库导入文档，解析为LlamaIndex文档对象。

快速开始：
    >>> from src.data_loader import DataImportService
    >>> service = DataImportService()
    >>> result = service.import_from_directory("./data")
    >>> docs = result.documents

主要接口：
- DataImportService: 统一导入服务（推荐）
  - import_from_directory(): 本地目录导入
  - import_from_github(): GitHub仓库导入
- 便捷函数: load_documents_from_directory(), load_documents_from_github()
- 底层组件: DataSource, DocumentParser（高级用法）

模块结构：
- service.py: 服务层，统一导入接口和流程编排
- source/: 数据源层（GitHub、本地文件）
- parser.py + utils/: 解析层（文档解析、缓存、文件处理）

设计说明：
本包整合了数据导入的完整流程，采用服务层统一接口。
"""
```

### 示例 3：JavaScript 模块

```javascript
// 工具函数模块：提供常用的工具函数
//
// 主要功能：
//   - formatDate()：格式化日期
//   - debounce()：防抖函数
//   - throttle()：节流函数
//
// 使用方式：
//   import { formatDate, debounce } from './utils.js'
```

### 反例：过于冗长的注释（应避免）

```python
"""
数据加载器模块 - 统一的数据导入服务包

本包整合了数据导入的完整流程，包括数据源获取、文档解析、错误处理和进度反馈。
采用服务层架构，将原本分散的 data_parser 和 data_source 模块统一整合，简化了项目结构。

架构设计
--------
本包采用分层设计，将复杂的数据加载功能组织为统一的服务包：

服务层（Service Layer）：
- service.py: DataImportService 类，提供统一的导入接口，协调整个导入流程
  - import_from_directory(): 从本地目录导入
  - import_from_github(): 从GitHub仓库导入
  - sync_github_repository(): 增量同步GitHub仓库
  - ImportResult: 导入结果数据类
  - ProgressReporter: 进度反馈器

数据源层（Source Layer）：
- source/base.py: DataSource 抽象基类和 SourceFile 数据类
- source/local.py: LocalFileSource，处理本地文件和目录
- source/github.py: GitHubSource，处理GitHub仓库同步

...（继续展开每一层的详细说明）
"""
```

**问题分析**：
- ❌ 详细展开每一层的架构描述（服务层、数据源层、解析层、工具层）
- ❌ 重复说明每个方法的作用
- ❌ 篇幅过长（100+行），难以快速理解核心功能
- ❌ 重点不突出，让人看了很多但无法立即心领神会
- ❌ 过多描述"怎么组织"，而非"做什么"

## 例外情况

以下文件可以适当简化注释：

1. **配置文件**（如 JSON、YAML、XML 等）：可以只有简单说明
2. **测试文件**：可以只说明测试目标
3. **非常简单的工具文件**（少于 50 行）：可以只包含功能概述

## 维护建议

- 在代码审查时检查文件顶部注释
- 当文件功能发生变化时，及时更新注释
- 保持注释与实际代码的一致性
