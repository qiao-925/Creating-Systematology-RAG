---
description: AGENTS.md与规则文件全量同步工作流
alwaysApply: true
---

# 规则文件全量同步工作流

> 从 `AGENTS.md` 第 335-394 行转换的结构化工作流

---

## 🎯 工作流概述

**触发条件**: 当 AGENTS.md 更新时

**核心原则**: **⚠️ 全量同步机制** - 不是部分更新，而是确保 AGENTS.md 的所有章节都有对应的规则文件

---

## 📋 同步原则

- ✅ **全量同步**：不是部分更新，而是确保 AGENTS.md 的所有章节都有对应的规则文件
- ✅ **全覆盖**：检查映射表中的所有章节，确保都已转换为规则文件
- ✅ **一致性验证**：同步后进行全量验证，确保内容语义一致

---

## 🔄 同步流程

### 步骤 1: 全量检查映射关系

- 对照 `.cursor/rules/AGENTS-MAPPING.md` 中的映射表
- **检查 AGENTS.md 的所有章节**是否都有对应的规则文件
- 识别缺失的规则文件
- 识别需要更新的规则文件

**检查清单**:
- [ ] 列出 AGENTS.md 的所有主要章节
- [ ] 对照映射表检查每个章节
- [ ] 标记缺失的规则文件
- [ ] 标记需要更新的规则文件

---

### 步骤 2: 全量更新规则文件

#### 2.1 更新已有规则文件

- **全量更新对应规则文件内容**，确保与 AGENTS.md 完全一致
- 保持规则文件的 MDC 格式规范
- 确保规则类型选择正确（Always/Auto Attached/Manual）

#### 2.2 创建缺失的规则文件

- **缺失的规则文件**：为未映射的章节创建新的 `.mdc` 规则文件
- **新建章节**：创建新的 `.mdc` 规则文件
- 遵循 MDC 格式：
  ```markdown
  ---
  description: [规则描述]
  alwaysApply: true/false
  ---
  
  # [规则标题]
  
  > 从 `AGENTS.md` 第 [行号] 行转换
  ```

#### 2.3 更新映射文档

- 在 `AGENTS-MAPPING.md` 中更新或添加所有映射关系
- 更新章节行号（如变化）
- 更新规则文件状态

**检查清单**:
- [ ] 更新所有已有规则文件
- [ ] 创建所有缺失的规则文件
- [ ] 更新映射文档

---

### 步骤 3: 全量验证一致性

#### 3.1 内容一致性验证

逐一验证每个规则文件与对应 AGENTS.md 章节：

- ✅ 确保内容语义一致
- ✅ 确保没有遗漏关键信息
- ✅ 确保没有添加额外内容

#### 3.2 格式规范验证

- ✅ 确保所有规则文件符合 MDC 格式
- ✅ 确保元数据头部正确（description, alwaysApply）
- ✅ 确保引用了原始 AGENTS.md 位置

#### 3.3 规则类型验证

- ✅ 确保所有规则类型选择正确
  - **Always**: 始终生效的规则
  - **Auto Attached**: 按路径自动附加
  - **Manual**: 手动引用

#### 3.4 更新规则索引

- ✅ 更新 `.cursor/rules/README.md` 规则清单，确保完整
- ✅ 添加新规则的说明
- ✅ 更新规则类型分类

**检查清单**:
- [ ] 逐一验证内容一致性
- [ ] 验证格式规范
- [ ] 验证规则类型
- [ ] 更新规则索引

---

### 步骤 4: 转换原则

在执行同步时必须遵循以下原则：

1. **保持语义一致**: 结构化规则必须准确反映 AGENTS.md 的意图
2. **增强可执行性**: 将自然语言描述转换为可执行的步骤和检查清单
3. **保留原则说明**: 在规则文件中引用原始 AGENTS.md 位置，保留上下文
4. **互补而非替代**: 结构化规则是对 AGENTS.md 的补充，不是替代

---

## ⏰ 同步时机

- ✅ **立即全量同步**：修改 AGENTS.md 后立即进行全量同步更新所有对应规则文件
- ✅ **验证步骤**：作为代码提交前的必检项，进行全量一致性检查
- ✅ **定期维护**：定期（如每周）进行全量检查，确保两者完全一致

---

## ✅ 全量同步检查清单

执行同步时必须完成以下检查：

- [ ] **检查映射表**：确认 AGENTS.md 的所有主要章节都已映射
- [ ] **检查规则文件**：确认所有映射的章节都有对应的规则文件
- [ ] **检查内容一致性**：逐一验证规则文件与 AGENTS.md 内容一致
- [ ] **检查格式规范**：所有规则文件符合 MDC 格式
- [ ] **检查规则类型**：所有规则的类型选择正确
- [ ] **更新映射文档**：映射关系完整且准确
- [ ] **更新规则索引**：README.md 中的规则清单完整

---

## 📚 参考文档

- **映射文档**：`.cursor/rules/AGENTS-MAPPING.md` - 详细的章节映射关系
- **规则索引**：`.cursor/rules/README.md` - 规则文件清单和说明
- **工作流定义**：`.cursor/rules/workflow-definitions.mdc` - 工作流定义指南
- **原始文档**：`AGENTS.md` 第 335-394 行

---

## 🎯 执行示例

### 示例：AGENTS.md 更新后的同步流程

```markdown
1. 检查映射关系
   - AGENTS.md 有新的"需求理解与边界分析"章节
   - 映射表中没有对应规则文件
   - 标记为"需要创建"

2. 创建规则文件
   - 创建 `.cursor/rules/requirement-analysis.mdc`
   - 遵循 MDC 格式
   - 引用原始位置：AGENTS.md 第 69-77 行

3. 更新映射文档
   - 在 AGENTS-MAPPING.md 中添加映射关系
   - 更新行号

4. 验证一致性
   - 检查内容语义一致
   - 验证格式规范
   - 更新 README.md
```

---

## 🔗 与其他规则的整合

- **文档更新**：规则文件同步是文档更新的一部分
- **任务日志**：同步过程需要记录到任务日志
- **开发工作流**：同步遵循开发工作流的原则

---

**最后更新**: 2025-11-03  
**维护者**: 当 AGENTS.md 更新时，执行全量同步
