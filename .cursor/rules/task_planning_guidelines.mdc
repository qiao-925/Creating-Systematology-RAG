---
description: "任务规划规范 - 长程任务的 Plan + Checkpoint 工作流"
alwaysApply: true
priority: 1
---

# 任务规划规范

> 适用于长程任务的事前规划，通过 Plan + Checkpoint 机制确保执行可控、进度可追踪。

---

## 1. 触发条件

- 用户明确要求"规划"、"计划"、"设计方案"等
- Agent 评估任务需要 >= 3 个明确步骤
- 涉及多文件改动或架构变更
- 预估执行时间较长，需要分阶段交付

---

## 2. 核心流程

```
任务启动 → 评估复杂度 → 创建计划书 → 按 CP 执行 → 更新状态 → 归档
```

### 2.1 复杂度评估

| 复杂度 | 特征 | 处理方式 |
|--------|------|----------|
| 简单 | 1-2 步，单文件 | 直接执行，完成后 `/generate-task-log` |
| 中等 | 3-5 步，2-3 文件 | 建议创建计划书 |
| 复杂 | >5 步，多文件/架构变更 | **必须**创建计划书 |

### 2.2 计划书创建

执行 `/generate-task-plan` 或手动创建，包含：
- Checkpoint 状态表（核心）
- 背景与目标
- 技术方案
- 实施步骤（含验收标准）
- 风险与注意事项
- 文件改动清单

### 2.3 Checkpoint 执行

- 每个 CP 应是 1-2 小时可完成的独立单元
- 完成后立即更新状态表
- 遇到阻塞或变更，在计划书中记录

---

## 3. Agent 行为要求

### 3.1 主动提议

对于复杂任务，Agent **必须主动提议**先创建计划书：

```
检测到任务涉及 [N] 个步骤，建议先创建计划书：
- 明确 Checkpoint 划分
- 定义验收标准
- 便于中断恢复

是否执行 /generate-task-plan？
```

### 3.2 状态更新提醒

每完成一个 CP 后，Agent 应提醒更新状态：

```
CP1 已完成，建议更新计划书状态表：
- CP1: ⬜ → ✅ 已完成 | 2026-01-22
```

### 3.3 中途创建支持

允许探索性任务中途转为正式计划：
- 当任务变复杂时，主动建议创建计划书
- 将已完成的步骤作为已完成的 CP 记录

---

## 4. 计划书规范

### 4.1 存放位置

- 进行中：`agent-task-log/ongoing/`
- 完成后：移动到 `agent-task-log/archive/YYYY-MM/`

### 4.2 命名格式

```
YYYY-MM-DD-N_【plan】任务名称-实施计划.md
```

### 4.3 必需章节

- [ ] Checkpoint 状态表
- [ ] 背景与目标
- [ ] 实施步骤（含验收标准）
- [ ] 文件改动清单

### 4.4 状态标记

| 标记 | 含义 |
|------|------|
| ⬜ | 待开始 |
| 🔄 | 进行中 |
| ✅ | 已完成 |
| ⏸️ | 暂停 |
| ❌ | 取消 |

---

## 5. 与任务收尾的衔接

### 5.1 完整流程

```
Plan 阶段                    Closure 阶段
/generate-task-plan    →    /generate-task-log
ongoing/xxx.md         →    archive/YYYY-MM/xxx.md
```

### 5.2 归档方式

两种选择：
1. **追加模式**：在计划书末尾追加"实施总结"章节，然后归档
2. **分离模式**：保留计划书，另外生成完成总结文档

---

## 6. 禁止事项

- ❌ 复杂任务未经规划直接执行
- ❌ 执行过程中不更新 CP 状态
- ❌ 计划书缺少验收标准
- ❌ 任务完成后不归档

---

## 7. 关联命令与资料

- 命令：`/generate-task-plan`
- 模板：`agent-task-log/PLAN_TEMPLATE.md`
- 参考：`task_closure_guidelines.mdc`、`TASK_TYPES.md`

---

## 8. 版本信息

- **创建日期**：2026-01-22
- **版本**：v1.0
