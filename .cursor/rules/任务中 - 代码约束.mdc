---
description: 任务中 - 代码约束规范 - Python代码风格与最佳实践
alwaysApply: true
---

# 任务中 - 代码约束

> Python 代码实现阶段的统一基线，覆盖类型、结构、日志、异常、命名与注释要求。

---

## 1. 适用范围
- 所有位于 `src/` 与 `tests/` 的 Python 代码编写与修改任务。
- 遇到框架特性或第三方限制时，如需例外必须提前在讨论中说明并获批。

---

## 2. 执行清单

### 2.1 基线设置
- [ ] 所有函数、方法、类声明补全类型提示，缺值返回使用 `-> None`。
- [ ] 公共 API（类、函数、模块）提供完整 docstring（参数、返回值、异常）。
- [ ] 单个代码文件 ≤ 300 行；超过需拆分并说明职责划分。

### 2.2 结构与命名
- [ ] 模块文件名使用 `snake_case.py`，测试文件遵循 `test_*.py`。
- [ ] 代码结构顺序：模块 docstring → 导入（标准库/第三方/本地）→ 常量 → 类 → 函数。
- [ ] 导入按分组+字母序排列，避免 `from module import *`，跨包引用使用绝对导入。
- [ ] 命名约束：类用 `PascalCase`，函数/变量用 `snake_case`，常量全大写，私有成员前缀 `_`。
- [ ] 固定枚举值使用 `Enum`，禁止散落字符串常量。

### 2.3 日志与异常
- [ ] 业务代码统一通过 `src.logger.setup_logger` 获取 logger，禁止 `print`（测试示例除外）。
- [ ] 根据语义选择日志级别（info/warning/error/debug），确保错误路径使用 `logger.error` 或 `logger.exception`。
- [ ] 捕获具体异常类型，记录日志后合理抛出；严禁裸 `except`。
- [ ] 关键路径提供降级或恢复策略说明。

### 2.4 注释与可读性
- [ ] 在复杂逻辑处注明“为什么这样做”，避免描述“做了什么”。
- [ ] 对性能优化、兼容性处理、架构选择附带理由，便于后续维护。
- [ ] 避免无意义或过时注释，修改代码时同步更新。

---

## 3. 验收标准
- [ ] 通过 `pylint`/`mypy`/`pytest` 等工具检查无基础问题。
- [ ] 关键模块的日志覆盖正常运行与异常分支。
- [ ] 重大结构调整在提交说明或文档中补充背景。

---

## 4. 参考资料
- `src/business/protocols.py`（枚举定义示例）
- `src/business/strategy_manager.py`（策略管理结构）
- `src/query/modular/retriever_factory.py`（导入与工厂模式组织）
- `src/embeddings/base.py`（抽象类+类型提示）
- `src/config.py`（配置模块、日志初始化）

---

## 5. 版本信息

- **最后更新**：2025-11-09
- **版本**：v2.5（转为清单化执行并补充验收标准）