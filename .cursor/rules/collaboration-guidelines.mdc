---
description: 人机协作要点 - 基于AGENTS.md
alwaysApply: true
---

# 人机协作要点

> 从 `AGENTS.md` 第 73-96 行转换的结构化规则

---

## 🎯 协作原则

明确区分 **Human 应该介入的时刻** 和 **Agent 应该自主完成的时刻**

---

## 👤 Human 应该介入的时刻

### 1. 方案选择
**场景**: 多个可行方案，需要权衡

**Agent 应做**:
- 列出所有可行方案（2-3个）
- 说明各方案优劣
- **等待用户选择**

### 2. 架构决策
**场景**: 影响长期维护的架构选择

**Agent 应做**:
- 分析架构影响范围
- 说明长期维护成本
- **等待用户确认**

### 3. 取舍判断
**场景**: 需要在不同维度间权衡

**示例**:
- 性能 vs 可维护性
- 开发速度 vs 代码质量
- 临时方案 vs 长期方案

**Agent 应做**:
- 明确冲突维度
- 分析权衡点
- **等待用户决策**

### 4. 风险评估
**场景**: 涉及技术债务或临时方案

**Agent 应做**:
- 识别技术债务风险
- 说明临时方案影响
- **等待用户确认是否接受风险**

### 5. 超过 3 次失败
**场景**: Agent 尝试多次仍未解决

**Agent 应做**:
- **暂停并主动报告用户**
- 说明已尝试的方法
- 提供问题分析
- **请求指导**

---

## 🤖 Agent 应该自主完成

### 1. 问题诊断
**范围**: 自动尝试多种诊断方法

**限制**: 
- 最多尝试 **3 次**
- 失败 3 次后暂停并报告用户

**方法**:
- 查看错误日志
- 检查配置文件
- 运行诊断工具
- 分析代码逻辑

### 2. 代码实现
**范围**: 按既定方案执行

**前提**:
- 方案已确认
- 步骤已明确

**要求**:
- 遵循最小改动原则
- 参考现有业务实现
- 保持代码风格一致

### 3. 测试运行
**范围**: 持续验证

**包括**:
- 运行单元测试
- 运行集成测试
- 验证核心功能
- 检查错误

### 4. 文档记录
**范围**: 记录过程到 agent-task-log/

**包括**:
- 任务开始和结束时间
- 实施的步骤和关键决策
- 遇到的问题和解决方案
- 失败的尝试和原因

---

## ✅ Agent 工作原则

### 应该做的
- ✅ **主动尝试多种方案**（2-3次）
- ✅ **记录所有尝试过程**（包括失败的）
- ✅ **提供选项而非单一方案**
- ✅ **解释思考过程**

### 不应该做的
- ❌ **超过 3 次失败应暂停并请求指导**
- ❌ **不要过度生成文档**
- ❌ **不要隐藏失败的尝试**
- ❌ **重大决策不要独断专行**

---

## 🔄 协作流程

### 流程 1: 正常开发流程

```
Agent 自主完成:
  问题诊断 → 代码实现 → 测试运行 → 文档记录
     ↓
Human 介入:
  方案选择、架构决策、取舍判断
```

### 流程 2: 遇到问题流程

```
Agent 尝试解决 (最多3次):
  尝试1 → 失败 → 尝试2 → 失败 → 尝试3
     ↓ (如果仍失败)
Human 介入:
  暂停并报告 → 请求指导 → 获得指导 → 继续执行
```

### 流程 3: 需要决策流程

```
Agent 识别决策点:
  遇到争议/不确定 → 主动告知用户 → 提供选项
     ↓
Human 决策:
  选择方案 → 确认决策
     ↓
Agent 执行:
  按用户决策执行
```

---

## 📋 协作检查清单

### Agent 自主判断
- [ ] 是否属于明确的技术实现任务？
- [ ] 方案是否已确认？
- [ ] 是否已有参考实现？
- [ ] 失败次数是否 < 3？

### 需要 Human 介入
- [ ] 是否需要方案选择？
- [ ] 是否涉及架构决策？
- [ ] 是否需要取舍判断？
- [ ] 是否涉及风险评估？
- [ ] 是否已失败 3 次？

---

## 🎯 协作最佳实践

### Agent 侧
1. **主动识别决策点**：不要等到问题严重才报告
2. **提供足够信息**：让用户能够做出明智决策
3. **尊重用户决策**：即使有自己的推荐，也要执行用户选择
4. **及时报告**：遇到问题第一时间报告，不要隐藏

### Human 侧
1. **明确指令**：给出清晰的需求和目标
2. **及时反馈**：对 Agent 的汇报及时确认或指导
3. **信任自主**：在 Agent 自主范围内，给予信任
4. **关键决策**：在关键决策点及时介入

---

## 📚 相关规则

- 决策原则：`decision-making-principles.mdc`
- 开发工作流：`development-workflow.mdc`
- 方案讨论工作流：`proposal-discussion-workflow.mdc`
- AGENTS.md 原始规则：第 73-96 行
