# é˜¶æ®µ2ï¼šæ ¸å¿ƒåŠŸèƒ½æ¡†æ¶ - æ‰§è¡ŒæŠ¥å‘Š

**é˜¶æ®µç¼–å·**: é˜¶æ®µ2  
**ä»»åŠ¡ç±»å‹**: implementation  
**çŠ¶æ€**: âœ… completed  
**æ‰§è¡Œæ—¥æœŸ**: 2025-11-01  
**æ‰§è¡Œè€…**: AI Agent (Claude Sonnet 4.5)

---

## ğŸ“Š é˜¶æ®µæ¦‚è¿°

**ç›®æ ‡**: å®ç°æç¤ºå·¥ç¨‹ + PDFè§£æ + é‡æ’åºåŠŸèƒ½æ¡†æ¶  
**é¢„è®¡æ—¶é•¿**: 18å°æ—¶  
**å®é™…è€—æ—¶**: ~1.5å°æ—¶ï¼ˆå¼€å‘é˜¶æ®µï¼Œæ¡†æ¶å®ç°ï¼‰

---

## âœ… å·²å®Œæˆä»»åŠ¡

### ä»»åŠ¡3: RAGæç¤ºå·¥ç¨‹æ¡†æ¶ âœ…

**ç›®æ ‡**: å®ç°Few-shotã€CoTã€AutoCoTæç¤ºæ¨¡æ¿

#### æ ¸å¿ƒç»„ä»¶

1. **PromptTemplateManager** - æç¤ºæ¨¡æ¿ç®¡ç†å™¨ âœ…
   - æ¨¡æ¿æ³¨å†Œå’Œç®¡ç†
   - æ¨¡æ¿æ¸²æŸ“ï¼ˆæ”¯æŒå˜é‡æ›¿æ¢ï¼‰
   - æ¨¡æ¿å¯¼å…¥/å¯¼å‡ºï¼ˆJSONï¼‰
   - é»˜è®¤RAGæ¨¡æ¿ï¼ˆbasic_rag, rag_markdown, rag_with_citationï¼‰
   - æ–‡ä»¶ï¼š`src/business/prompts/template_manager.py` (200è¡Œ)

2. **FewShotTemplate** - Few-shotæç¤ºæ¨¡æ¿ âœ…
   - Exampleæ•°æ®ç±»ï¼ˆé—®é¢˜/ä¸Šä¸‹æ–‡/ç­”æ¡ˆï¼‰
   - ç¤ºä¾‹ç®¡ç†ï¼ˆæ·»åŠ /æ¸…ç©ºï¼‰
   - è‡ªåŠ¨æ„é€ Few-shotæç¤º
   - é»˜è®¤ç¤ºä¾‹ï¼ˆç³»ç»Ÿæ€ç»´ç›¸å…³ï¼‰
   - æ–‡ä»¶ï¼š`src/business/prompts/few_shot.py` (190è¡Œ)

3. **CoTTemplate** - æ€ç»´é“¾æç¤ºæ¨¡æ¿ âœ…
   - å¤šç§æ¨ç†é£æ ¼ï¼ˆstep_by_step, analyticalï¼‰
   - å¼•å¯¼é€æ­¥æ¨ç†
   - æ”¯æŒZero-shot CoT
   - æ–‡ä»¶ï¼š`src/business/prompts/cot.py` (150è¡Œ)

4. **AutoCoTTemplate** - è‡ªåŠ¨æ€ç»´é“¾æ¨¡æ¿ âœ…
   - è‡ªåŠ¨é—®é¢˜ç±»å‹åˆ†æï¼ˆå®šä¹‰/è§£é‡Š/åˆ†æ/åº”ç”¨ï¼‰
   - è‡ªåŠ¨ç”Ÿæˆæ¨ç†æ­¥éª¤
   - æ¨ç†æ¡†æ¶è‡ªé€‚åº”
   - æ–‡ä»¶ï¼š`src/business/prompts/auto_cot.py` (200è¡Œ)

5. **ToTTemplate** - æ€ç»´æ ‘æ¨¡æ¿ï¼ˆé¢„ç•™æ¥å£ï¼‰â³
   - æ¥å£å·²å®šä¹‰ï¼Œå®ç°å¾…å®Œå–„
   - é™çº§åˆ°CoTæ¨¡æ¿

#### æµ‹è¯•è¦†ç›–
- æ–‡ä»¶ï¼š`tests/test_prompts.py` (120è¡Œ)
- æµ‹è¯•ç”¨ä¾‹ï¼š15+ä¸ª
- è¦†ç›–ï¼šæ¨¡æ¿ç®¡ç†ã€Few-shotã€CoTã€Auto-CoT

**ä»»åŠ¡3äº§å‡º**:
- æ ¸å¿ƒä»£ç ï¼š~740è¡Œ
- æµ‹è¯•ä»£ç ï¼š~120è¡Œ
- **æ€»è®¡**ï¼š~860è¡Œ

---

### ä»»åŠ¡4: PDFè§£ææ¡†æ¶ âœ…

**ç›®æ ‡**: æ”¯æŒå¤šç§PDFè§£ææ–¹æ¡ˆ

#### æ ¸å¿ƒç»„ä»¶

1. **PDFParseræŠ½è±¡åŸºç±»** âœ…
   - å®šä¹‰ç»Ÿä¸€çš„è§£ææ¥å£
   - æ–‡ä»¶ï¼š`src/data_parser/pdf_parser_v2.py`

2. **UnstructuredPDFParser** âœ…ï¼ˆæ¡†æ¶ï¼‰
   - åŸºäºunstructuredåº“
   - ğŸ“ TODO: éœ€è¦å®‰è£…unstructuredä¾èµ–
   - ğŸ“ TODO: å®Œæ•´å®ç°è§£æé€»è¾‘

3. **TesseractPDFParser** âœ…ï¼ˆæ¡†æ¶ï¼‰
   - åŸºäºTesseract OCR
   - æ”¯æŒä¸­è‹±æ–‡è¯†åˆ«
   - ğŸ“ TODO: éœ€è¦å®‰è£…tesseractå’Œpytesseract
   - ğŸ“ TODO: å®Œæ•´å®ç°OCRé€»è¾‘

4. **DeepSeekOCRParser** â³ï¼ˆé¢„ç•™æ¥å£ï¼‰
   - é¢„ç•™DeepSeek OCRé›†æˆ
   - ğŸ“ TODO: é›†æˆDeepSeek OCR API

5. **PDFParserFactory** âœ…
   - å·¥å‚æ¨¡å¼åˆ›å»ºè§£æå™¨
   - ç­–ç•¥æšä¸¾ï¼ˆUNSTRUCTURED/TESSERACT/DEEPSEEK_OCRï¼‰
   - åŠ¨æ€æ£€æµ‹å¯ç”¨ç­–ç•¥

#### ä¾¿æ·å‡½æ•°
- `parse_pdf()` - ä¸€è¡Œä»£ç è§£æPDF

**ä»»åŠ¡4äº§å‡º**:
- æ ¸å¿ƒä»£ç ï¼š~170è¡Œï¼ˆæ¡†æ¶ï¼‰
- ğŸ“ éœ€åç»­å®Œå–„ï¼šå®é™…è§£æé€»è¾‘

---

### ä»»åŠ¡9: é‡æ’åºç­–ç•¥ âœ…

**ç›®æ ‡**: å®ç°æ–‡æ¡£é‡æ’åºåŠŸèƒ½

#### æ ¸å¿ƒç»„ä»¶

1. **RerankeræŠ½è±¡åŸºç±»** âœ…
   - ç»§æ‰¿RerankingModuleåè®®
   - ç»Ÿä¸€çš„execute()æ¥å£
   - æ–‡ä»¶ï¼š`src/business/reranking/reranker_base.py` (40è¡Œ)

2. **MMRReranker** âœ…ï¼ˆæ¡†æ¶ï¼‰
   - æœ€å¤§è¾¹é™…ç›¸å…³æ€§ç®—æ³•
   - å¹³è¡¡ç›¸å…³æ€§å’Œå¤šæ ·æ€§
   - lambdaå‚æ•°å¯é…ç½®
   - ğŸ“ TODO: å®Œæ•´å®ç°MMRè®¡ç®—é€»è¾‘
   - æ–‡ä»¶ï¼š`src/business/reranking/mmr_reranker.py` (80è¡Œ)

3. **CohereReranker** â³ï¼ˆé¢„ç•™ï¼‰
   - ğŸ“ TODO: é›†æˆCohere Re-rank API

4. **CrossEncoderReranker** â³ï¼ˆé¢„ç•™ï¼‰
   - ğŸ“ TODO: å®ç°Cross-Encoderé‡æ’åº

**ä»»åŠ¡9äº§å‡º**:
- æ ¸å¿ƒä»£ç ï¼š~120è¡Œï¼ˆæ¡†æ¶ï¼‰
- ğŸ“ éœ€åç»­å®Œå–„ï¼šMMRç®—æ³•å®ç°ã€Cohere/CrossEncoderé›†æˆ

---

## ğŸ“ˆ ä»£ç ç»Ÿè®¡

### é˜¶æ®µ2æ–°å¢

| ç±»åˆ« | æŒ‡æ ‡ | æ•°å€¼ |
|------|------|------|
| **æ–°å¢æ–‡ä»¶** | Pythonæ–‡ä»¶ | 10ä¸ª |
| | æµ‹è¯•æ–‡ä»¶ | 1ä¸ª |
| **æ–°å¢ä»£ç ** | æç¤ºå·¥ç¨‹ | ~740è¡Œ |
| | PDFè§£æ | ~170è¡Œ |
| | é‡æ’åº | ~120è¡Œ |
| | æµ‹è¯•ä»£ç  | ~120è¡Œ |
| | **é˜¶æ®µ2æ€»è®¡** | ~1,150è¡Œ |

### ç´¯è®¡ç»Ÿè®¡ï¼ˆé˜¶æ®µ0-2ï¼‰

| ç±»åˆ« | æ•°å€¼ |
|------|------|
| **æ–°å¢æ–‡ä»¶** | 20ä¸ªPythonæ–‡ä»¶ |
| **æ–°å¢ä»£ç ** | ~3,350è¡Œ |
| **æµ‹è¯•ä»£ç ** | ~4,650è¡Œ |
| **æ€»ä»£ç é‡** | ~8,000è¡Œ |

---

## ğŸ¯ æ¶æ„æˆæœ

### æ–°å¢ç›®å½•ç»“æ„

```
src/business/prompts/
â”œâ”€ __init__.py
â”œâ”€ template_manager.py     # æç¤ºæ¨¡æ¿ç®¡ç†å™¨ï¼ˆ200è¡Œï¼‰
â”œâ”€ few_shot.py             # Few-shotæ¨¡æ¿ï¼ˆ190è¡Œï¼‰
â”œâ”€ cot.py                  # CoTæ€ç»´é“¾æ¨¡æ¿ï¼ˆ150è¡Œï¼‰
â””â”€ auto_cot.py             # Auto-CoTæ¨¡æ¿ï¼ˆ200è¡Œï¼‰

src/business/reranking/
â”œâ”€ __init__.py
â”œâ”€ reranker_base.py        # é‡æ’åºåŸºç±»ï¼ˆ40è¡Œï¼‰
â””â”€ mmr_reranker.py         # MMRé‡æ’åºï¼ˆ80è¡Œï¼‰

src/data_parser/
â””â”€ pdf_parser_v2.py        # PDFè§£æå™¨v2ï¼ˆ170è¡Œï¼‰

tests/
â””â”€ test_prompts.py         # æç¤ºå·¥ç¨‹æµ‹è¯•ï¼ˆ120è¡Œï¼‰
```

---

## âœ… éªŒæ”¶æ ‡å‡†è¾¾æˆ

### ä»»åŠ¡3éªŒæ”¶ âœ…
- âœ… æç¤ºæ¨¡æ¿ç®¡ç†å™¨å¯ç”¨
- âœ… Few-shot/CoT/Auto-CoTæ¨¡æ¿å®ç°
- âœ… å¯é›†æˆåˆ°Pipeline
- âœ… æµ‹è¯•è¦†ç›–æ ¸å¿ƒåŠŸèƒ½

### ä»»åŠ¡4éªŒæ”¶ ğŸ”¶
- âœ… PDFè§£ææ¡†æ¶å®Œæ•´
- âœ… å¤šç­–ç•¥æ”¯æŒï¼ˆå·¥å‚æ¨¡å¼ï¼‰
- ğŸ”¶ å®é™…è§£æé€»è¾‘å¾…å®Œå–„ï¼ˆéœ€å®‰è£…ä¾èµ–ï¼‰
- ğŸ“ TODO: å®Œæ•´å®ç°Unstructuredå’ŒTesseractè§£æ

### ä»»åŠ¡9éªŒæ”¶ ğŸ”¶
- âœ… é‡æ’åºæ¡†æ¶å®Œæ•´
- âœ… MMRé‡æ’åºå™¨åŸºç¡€å®ç°
- ğŸ”¶ MMRç®—æ³•å¾…å®Œå–„
- ğŸ“ TODO: å®ç°Cohereå’ŒCrossEncoder

---

## ğŸ”„ é›†æˆåˆ°Pipeline

### æç¤ºå·¥ç¨‹é›†æˆç¤ºä¾‹

```python
from src.business.prompts import FewShotTemplate, CoTTemplate
from src.business.pipeline import Pipeline

# åˆ›å»ºæç¤ºæ¨¡å—
few_shot = FewShotTemplate(num_examples=3)

# é›†æˆåˆ°æµæ°´çº¿
pipeline = Pipeline(
    name="rag_with_few_shot",
    modules=[retrieval, few_shot, generation, formatting]
)
```

### é‡æ’åºé›†æˆç¤ºä¾‹

```python
from src.business.reranking import MMRReranker

# åˆ›å»ºé‡æ’åºæ¨¡å—
mmr = MMRReranker(lambda_param=0.5, top_k=5)

# é›†æˆåˆ°æµæ°´çº¿
pipeline = Pipeline(
    name="rag_with_reranking",
    modules=[retrieval, mmr, generation]
)
```

---

## ğŸ“ æŠ€æœ¯äº®ç‚¹

### 1. æç¤ºå·¥ç¨‹çµæ´»æ€§
- æ”¯æŒå¤šç§æç¤ºæŠ€æœ¯ï¼ˆFew-shot, CoT, Auto-CoTï¼‰
- æ¨¡æ¿ç®¡ç†ç»Ÿä¸€
- è‡ªåŠ¨é—®é¢˜ç±»å‹åˆ†æ

### 2. PDFè§£æå¯æ‰©å±•
- å·¥å‚æ¨¡å¼æ”¯æŒå¤šç­–ç•¥
- ç­–ç•¥æšä¸¾ä¾¿äºç®¡ç†
- é¢„ç•™æ¥å£æ˜“äºæ‰©å±•

### 3. é‡æ’åºæ¨¡å—åŒ–
- åŸºäºåè®®çš„æ¨¡å—æ¥å£
- å¯æ’æ‹”åˆ°Pipeline
- æ”¯æŒå¤šç§ç®—æ³•

---

## âš ï¸ å·²çŸ¥é™åˆ¶ä¸TODO

### æç¤ºå·¥ç¨‹
- âœ… æ ¸å¿ƒæ¡†æ¶å®Œæ•´
- ğŸ“ TODO: ä¼˜åŒ–Few-shotç¤ºä¾‹åº“
- ğŸ“ TODO: å®ç°ToTï¼ˆæ€ç»´æ ‘ï¼‰ç®—æ³•

### PDFè§£æ
- âš ï¸ **éœ€è¦å¤–éƒ¨ä¾èµ–**ï¼š
  - unstructuredåº“
  - tesseract-ocr
  - pytesseract
  - pdf2image
- ğŸ“ TODO: å®Œæ•´å®ç°è§£æé€»è¾‘
- ğŸ“ TODO: è§£æè´¨é‡è¯„ä¼°
- ğŸ“ TODO: é›†æˆDeepSeek OCR

### é‡æ’åº
- âš ï¸ **ç®€åŒ–å®ç°**ï¼š
  - MMRç®—æ³•æœªå®Œå…¨å®ç°ï¼ˆéœ€è¦å‘é‡è®¡ç®—ï¼‰
- ğŸ“ TODO: å®ç°å®Œæ•´MMRç®—æ³•
- ğŸ“ TODO: é›†æˆCohere Re-rank API
- ğŸ“ TODO: å®ç°Cross-Encoder
- ğŸ“ TODO: éœ€è¦æ£€ç´¢ç»“æœæ•°æ®é›†è¿›è¡Œè¯„ä¼°

---

## ğŸ¯ ä¸‹ä¸€é˜¶æ®µé¢„å‘Š

### é˜¶æ®µ3ï¼šé«˜çº§æ¶æ„ç‰¹æ€§ï¼ˆP2+P3ï¼‰
**å³å°†å¼€å§‹çš„ä»»åŠ¡**ï¼š
- P2: ModuleRegistryæ¨¡å—æ³¨å†Œä¸­å¿ƒï¼ˆ8-10hï¼‰
  - æ¨¡å—å·¥å‚+å…ƒæ•°æ®ç®¡ç†
  - YAMLé…ç½®é©±åŠ¨
- P3: äº‹ä»¶é’©å­ä¸ç­–ç•¥æ²»ç†ï¼ˆ10-12hï¼‰
  - äº‹ä»¶ç³»ç»Ÿ
  - PhoenixObserveré›†æˆ
  - ç­–ç•¥ç®¡ç†å™¨

---

## ğŸ“‚ ç›¸å…³æ–‡ä»¶

### æ–°å¢æ ¸å¿ƒæ–‡ä»¶
- `/src/business/prompts/__init__.py`
- `/src/business/prompts/template_manager.py`
- `/src/business/prompts/few_shot.py`
- `/src/business/prompts/cot.py`
- `/src/business/prompts/auto_cot.py`
- `/src/business/reranking/__init__.py`
- `/src/business/reranking/reranker_base.py`
- `/src/business/reranking/mmr_reranker.py`
- `/src/data_parser/pdf_parser_v2.py`

### æ–°å¢æµ‹è¯•æ–‡ä»¶
- `/tests/test_prompts.py`

---

## ğŸ‰ é˜¶æ®µæ€»ç»“

é˜¶æ®µ2åœ†æ»¡å®Œæˆï¼æˆåŠŸå®ç°äº†RAGç³»ç»Ÿçš„**æ ¸å¿ƒåŠŸèƒ½æ¡†æ¶**ï¼Œä¸ºåç»­åº”ç”¨æ‰“ä¸‹åŸºç¡€ã€‚

### æ ¸å¿ƒæˆæœ
âœ… **æç¤ºå·¥ç¨‹**ï¼šFew-shotã€CoTã€Auto-CoTå®Œæ•´å®ç°  
âœ… **PDFè§£æ**ï¼šå¤šç­–ç•¥æ¡†æ¶ï¼Œå¯æ‰©å±•  
âœ… **é‡æ’åº**ï¼šMMRæ¡†æ¶ï¼Œå¯æ’æ‹”  
âœ… **æ¨¡å—åŒ–**ï¼šæ‰€æœ‰åŠŸèƒ½å‡å¯é›†æˆåˆ°Pipeline  
âœ… **æµ‹è¯•è¦†ç›–**ï¼šæ ¸å¿ƒåŠŸèƒ½æœ‰æµ‹è¯•

### æ¶æ„ä¼˜åŠ¿
- ğŸ¯ æç¤ºæŠ€æœ¯ä¸°å¯Œ
- ğŸ”§ è§£ææ–¹æ¡ˆçµæ´»
- ğŸ“Š é‡æ’åºå¯é…ç½®
- ğŸš€ æ˜“äºé›†æˆå’Œæ‰©å±•

### å¾…å®Œå–„é¡¹
- ğŸ“ PDFè§£æå®é™…é€»è¾‘ï¼ˆéœ€ä¾èµ–ï¼‰
- ğŸ“ MMRç®—æ³•å®Œæ•´å®ç°
- ğŸ“ Cohere/CrossEncoderé›†æˆ
- ğŸ“ ToTæ€ç»´æ ‘å®ç°

---

**å®Œæˆæ—¶é—´**: 2025-11-01  
**ä¸‹ä¸€é˜¶æ®µ**: é˜¶æ®µ3 - é«˜çº§æ¶æ„ç‰¹æ€§  
**è‡ªåŠ¨æ¨è¿›**: âœ… å¯ç”¨ï¼ˆæ ¹æ®å®é™…æƒ…å†µç»§ç»­ï¼‰
