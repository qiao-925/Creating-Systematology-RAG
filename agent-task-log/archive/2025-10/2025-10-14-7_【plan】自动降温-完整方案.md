# 2025-10-14 【plan】自动降温 - 开机自启完整方案

**【Task Type】**: plan
**日期**: 2025-10-14  
**方案**: 全自动，无需手动操作

---

## 🚀 一键安装

复制下面的命令执行即可：

```bash
# 创建监控脚本
cat > /tmp/自动降温.sh << 'EOF'
#!/bin/bash
while true; do
    temp=$(sensors | grep -E "Tctl|edge" | grep -oP '\+\K[0-9]+' | sort -rn | head -1)
    
    if [ -n "$temp" ] && [ "$temp" -gt 75 ]; then
        echo "powersave" | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor > /dev/null 2>&1
        echo "$(date): 温度 ${temp}°C，已自动降温" >> /tmp/降温日志.txt
    elif [ -n "$temp" ] && [ "$temp" -lt 60 ]; then
        echo "schedutil" | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor > /dev/null 2>&1
    fi
    
    sleep 10
done
EOF

chmod +x /tmp/自动降温.sh

# 创建系统服务
sudo tee /etc/systemd/system/auto-thermal.service > /dev/null << 'EOF'
[Unit]
Description=自动温度监控和降温
After=multi-user.target

[Service]
Type=simple
ExecStart=/tmp/自动降温.sh
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# 启用并启动服务
sudo systemctl daemon-reload
sudo systemctl enable auto-thermal.service
sudo systemctl start auto-thermal.service

# 检查状态
echo ""
echo "✅ 安装完成！"
systemctl status auto-thermal.service --no-pager -l
```

---

## 📊 工作原理

```
每10秒检查一次温度
├─ 温度 > 75°C → 自动切换省电模式
├─ 温度 < 60°C → 自动恢复正常性能
└─ 记录日志到 /tmp/降温日志.txt
```

---

## 🔍 查看状态

```bash
# 查看服务状态
systemctl status auto-thermal.service

# 查看降温日志
tail -f /tmp/降温日志.txt

# 查看当前温度
sensors
```

---

## 🛠️ 管理命令

```bash
# 停止服务
sudo systemctl stop auto-thermal.service

# 重启服务
sudo systemctl restart auto-thermal.service

# 禁用开机自启
sudo systemctl disable auto-thermal.service

# 卸载服务
sudo systemctl stop auto-thermal.service
sudo systemctl disable auto-thermal.service
sudo rm /etc/systemd/system/auto-thermal.service
sudo rm /tmp/自动降温.sh
sudo systemctl daemon-reload
```

---

## ✨ 特点

- 🔥 **全自动**: 无需手动操作
- 🚀 **开机自启**: 永久生效
- 💡 **智能调节**: 自动降温+自动恢复
- 📝 **有日志**: 可追溯历史
- 🛡️ **崩溃重启**: 服务异常会自动重启

---

最后更新: 2025-10-14

