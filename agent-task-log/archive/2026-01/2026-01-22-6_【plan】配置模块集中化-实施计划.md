# 2026-01-22 ã€planã€‘é…ç½®æ¨¡å—é›†ä¸­åŒ–-å®æ–½è®¡åˆ’

> å°†åˆ†æ•£çš„é…ç½®é¡¹æ•´åˆä¸ºç»Ÿä¸€çš„ AppConfig æ•°æ®æ¨¡å‹ï¼Œæä¾›è¯­ä¹‰åŒ–çš„ LLM é¢„è®¾å’Œåˆ†å±‚çš„ RAG å‚æ•°æ§åˆ¶ï¼Œå®ç° UI åˆ†å±‚ï¼ˆä¾§è¾¹æ å¸¸ç”¨ + å¼¹çª—é«˜çº§ï¼‰ã€‚

---

## Checkpoint çŠ¶æ€

| CP | å†…å®¹ | çŠ¶æ€ |
|----|------|------|
| CP1 | åˆ›å»º config_panel/models.pyï¼ˆAppConfig + LLM_PRESETSï¼‰ | âœ… å®Œæˆ |
| CP2 | åˆ›å»º config_panel/rag_params.pyï¼ˆRAG å‚æ•°é¢æ¿ï¼‰ | âœ… å®Œæˆ |
| CP3 | åˆ›å»º config_panel/llm_presets.pyï¼ˆLLM é¢„è®¾é¢æ¿ï¼‰ | âœ… å®Œæˆ |
| CP4 | åˆ›å»º config_panel/panel.pyï¼ˆä¸»é…ç½®é¢æ¿ï¼‰ | âœ… å®Œæˆ |
| CP5 | ä¿®æ”¹ sidebar.py é›†æˆé…ç½®é¢æ¿ | âœ… å®Œæˆ |
| CP6 | æŠ½å– rebuild_services() åˆ° state.py | âœ… å®Œæˆ |
| CP7 | ä¿®æ”¹ settings_dialog.py æ·»åŠ é«˜çº§é…ç½® Tab | âœ… å®Œæˆ |
| CP8 | ä¿®æ”¹ manager.py æ¥æ”¶ temperature å‚æ•° | âœ… å®Œæˆ |
| CP9 | æµ‹è¯•éªŒæ”¶ | âœ… å®Œæˆ |

---

## 1. æ ¸å¿ƒè®¾è®¡å†³ç­–

**AppConfig å®šä½**ï¼šçº¯æ•°æ®ç±»ï¼Œä½œä¸º session_state çš„è¯»å†™æ¡¥æ¢

- æä¾› `from_session_state()` å’Œ `save_to_session_state()` æ–¹æ³•
- ä¸åœ¨ session_state ä¸­å­˜å‚¨ AppConfig å®ä¾‹æœ¬èº«ï¼Œä»ä½¿ç”¨æ‰å¹³å­—æ®µ

**æœåŠ¡é‡å»ºé€»è¾‘**ï¼šæŠ½å–é€šç”¨å‡½æ•°ï¼Œé¿å…é‡å¤ä»£ç 

- ä» `chat_input_with_mode.py` çš„ `_on_agentic_toggle()` ä¸­æŠ½å–
- æ‰€æœ‰é…ç½®å˜æ›´ç»Ÿä¸€è°ƒç”¨

---

## 2. å…³é”®æ–‡ä»¶ä¸ä»£ç 

### 2.1 ç›®å½•ç»“æ„

```
frontend/components/config_panel/
â”œâ”€â”€ __init__.py           # å¯¼å‡ºä¸»å…¥å£
â”œâ”€â”€ models.py             # AppConfig + LLM_PRESETSï¼ˆåˆå¹¶ï¼‰
â”œâ”€â”€ rag_params.py         # RAG å‚æ•°é¢æ¿
â”œâ”€â”€ llm_presets.py        # LLM é¢„è®¾é¢æ¿
â””â”€â”€ panel.py              # ä¸»é…ç½®é¢æ¿
```

### 2.2 AppConfig è®¾è®¡ï¼ˆ`models.py`ï¼‰

```python
@dataclass
class AppConfig:
    selected_model: str = "deepseek-chat"
    llm_preset: str = "balanced"
    retrieval_strategy: str = "vector"
    use_agentic_rag: bool = False
    similarity_top_k: int = 3
    similarity_threshold: float = 0.4
    enable_rerank: bool = False
    show_reasoning: bool = True
    
    @classmethod
    def from_session_state(cls) -> "AppConfig":
        """ä» session_state è¯»å–é…ç½®"""
        ...
    
    def save_to_session_state(self) -> None:
        """å†™å…¥ session_state"""
        ...

LLM_PRESETS = {
    "precise": {"name": "ğŸ¯ ç²¾ç¡®æ¨¡å¼", "temperature": 0.3, ...},
    "balanced": {"name": "âš–ï¸ å¹³è¡¡æ¨¡å¼", "temperature": 0.7, ...},
    "creative": {"name": "ğŸ’¡ åˆ›æ„æ¨¡å¼", "temperature": 1.3, ...},
}
```

### 2.3 æœåŠ¡é‡å»ºå‡½æ•°ï¼ˆ`state.py` æ–°å¢ï¼‰

```python
def rebuild_services() -> bool:
    """é‡å»º RAGService å’Œ ChatManager"""
    # ä» AppConfig è¯»å–é…ç½®ï¼Œé‡å»ºæœåŠ¡å®ä¾‹
    ...
```

### 2.4 å‚æ•°ä¼ é€’é“¾è·¯

`ChatManager.__init__()` æ–°å¢ `temperature`/`max_tokens` å‚æ•°ï¼š

```python
if model_id:
    self.llm = create_llm(
        model_id=model_id,
        temperature=temperature,
        max_tokens=max_tokens,
    )
```

---

## 3. æ–‡ä»¶æ”¹åŠ¨æ¸…å•

| æ–‡ä»¶ | æ“ä½œ |
|------|------|
| `frontend/components/config_panel/models.py` | æ–°å»ºï¼ˆAppConfig + LLM_PRESETSï¼‰ |
| `frontend/components/config_panel/rag_params.py` | æ–°å»º |
| `frontend/components/config_panel/llm_presets.py` | æ–°å»º |
| `frontend/components/config_panel/panel.py` | æ–°å»º |
| `frontend/components/sidebar.py` | ä¿®æ”¹ï¼ˆé›†æˆé…ç½®é¢æ¿ï¼‰ |
| `frontend/components/settings_dialog.py` | ä¿®æ”¹ï¼ˆæ·»åŠ é«˜çº§é…ç½® Tabï¼‰ |
| `frontend/components/chat_input_with_mode.py` | ä¿®æ”¹ï¼ˆä½¿ç”¨æŠ½å–çš„ rebuild_servicesï¼‰ |
| `frontend/utils/state.py` | ä¿®æ”¹ï¼ˆæ–°å¢ rebuild_services å‡½æ•°ï¼‰ |
| `backend/business/chat/manager.py` | ä¿®æ”¹ï¼ˆæ¥æ”¶ temperature å‚æ•°ï¼‰ |

---

## 4. é£é™©ä¸é—ç•™é¡¹

- **é—ç•™**ï¼š`manager.py` è¶… 300 è¡Œï¼Œä½œä¸ºåç»­ä¼˜åŒ–é¡¹
- **æ³¨æ„**ï¼šæ¨ç†æ¨¡å‹ï¼ˆdeepseek-reasonerï¼‰ä¸æ”¯æŒ temperatureï¼ŒUI éœ€æ£€æµ‹å¹¶ç¦ç”¨/æç¤º
- **æ³¨æ„**ï¼šé…ç½®å˜æ›´åéœ€è°ƒç”¨ `rebuild_services()`ï¼Œç»Ÿä¸€å¤„ç†

---

## 5. ç‰ˆæœ¬ä¿¡æ¯

- **åˆ›å»ºæ—¥æœŸ**ï¼š2026-01-22
- **å®Œæˆæ—¥æœŸ**ï¼š2026-01-22
- **å…³è”æ€»ç»“**ï¼š`2026-01-22-6_ã€implementationã€‘é…ç½®æ¨¡å—é›†ä¸­åŒ–-å®Œæˆæ€»ç»“.md`
