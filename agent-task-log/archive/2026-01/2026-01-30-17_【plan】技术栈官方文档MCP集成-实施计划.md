# 2026-01-30 【plan】技术栈官方文档 MCP 集成 - 实施计划

> 扫描当前项目使用的所有技术栈，并将官方文档通过 MCP（如 Context7、Firecrawl）集成进来，规避 AI 发明不存在的 API 的问题。

---

## Checkpoint 状态

| CP | 阶段 | 状态 | 完成时间 |
|----|------|------|----------|
| CP1 | 技术栈清单固化与官方文档 URL 映射 | ⬜ 待开始 | - |
| CP2 | Context7 MCP 修复/验证与 API Key 配置 | ⬜ 待开始 | - |
| CP3 | 备用方案：Firecrawl 拉取关键文档 | ⬜ 待开始 | - |
| CP4 | Agent 使用规范与 Cursor 规则 | ⬜ 待开始 | - |

**当前进度**: CP0 - 计划制定完成

---

## 1. 背景与目标

### 1.1 现状问题

- AI 易根据训练数据「发明」第三方库中不存在的函数/API，导致运行时报错、排查耗时。
- 项目依赖较多（LlamaIndex、Streamlit、FastAPI、Chroma 等），需以官方文档为准。
- Context7 MCP 可拉取版本化官方文档；当前环境 STATUS 显示 MCP 报错，需修复或改用 Firecrawl 等备用手段。

### 1.2 目标

1. 扫描并固化项目技术栈清单（含版本与官方文档 URL）。
2. 确保至少一种 MCP 可用：优先 Context7，备用 Firecrawl 抓取关键文档页。
3. 在 Cursor/Agent 侧约定：涉及第三方 API 时优先「查官方文档」（use context7 或 Firecrawl scrape），再写代码。

---

## 2. 技术栈清单（来自 pyproject.toml）

| 类别 | 包名 | 版本约束 | 官方文档 URL（待 CP1 补全） |
|------|------|----------|-----------------------------|
| RAG 核心 | llama-index | >=0.14.3 | https://docs.llamaindex.ai/ |
| | llama-index-llms-openai | >=0.2.0 | 同上 |
| | llama-index-llms-deepseek | >=0.2.0 | 同上 |
| | llama-index-llms-litellm | >=0.6.0 | 同上 |
| | llama-index-embeddings-huggingface | >=0.3.0 | 同上 |
| | llama-index-vector-stores-chroma | >=0.2.0 | 同上 |
| | llama-index-readers-file | >=0.2.0 | 同上 |
| | llama-index-readers-web | >=0.2.0 | 同上 |
| 前端 | streamlit | >=1.50.0 | https://docs.streamlit.io/ |
| | streamlit-iframe-event | >=0.0.9 | PyPI / GitHub |
| 向量库 | chromadb | >=0.5.0 | https://docs.trychroma.com/ |
| API | fastapi | >=0.115.0 | https://fastapi.tiangolo.com/ |
| | uvicorn | >=0.30.0 | https://www.uvicorn.org/ |
| LLM/嵌入 | openai | >=1.12.0 | https://platform.openai.com/docs |
| 工具 | python-dotenv | >=1.0.0 | PyPI |
| | pyyaml | >=6.0.0 | https://pyyaml.org/ |
| | tqdm | >=4.66.0 | https://tqdm.github.io/ |
| 认证 | python-jose[cryptography] | >=3.3.0 | PyPI / GitHub |
| | python-multipart | >=0.0.9 | PyPI |
| | passlib[bcrypt] | >=1.7.4 | https://passlib.readthedocs.io/ |
| 其他 | huggingface-hub | >=0.20.0 | https://huggingface.co/docs/hub |
| | pydantic-settings | >=2.0.0 | https://docs.pydantic.dev/ |
| | structlog | >=24.1.0 | https://www.structlog.org/ |
| | requests | >=2.31.0 | https://requests.readthedocs.io/ |
| 测试 | pytest / pytest-cov / pytest-mock 等 | 见 pyproject | https://docs.pytest.org/ |

---

## 3. 技术方案

### 3.1 MCP 分工

- **Context7**：在 Cursor 中在提问里加 `use context7`，由 MCP 拉取库的版本化文档与示例，直接注入上下文。
- **Firecrawl**：对 Context7 未覆盖或不可用时的 URL，用 `firecrawl_scrape` 拉取单页（如 docs.llamaindex.ai、docs.streamlit.io 等）作补充。

### 3.2 产出物（通过 Skill 集成）

- **技术栈与官方文档 URL 映射表及说明**：通过 **Skill** 集成到当前项目（`.cursor/skills/`），与现有 Cursor 体系统一；不单独维护 `docs/` 下映射文档。
- 具体方式：扩展现有 `doc-driven-development` Skill，在其 `references/` 下新增映射表（如 `tech-stack-docs.md`），并在 SKILL.md 中补充「use context7 / Firecrawl」用法及对该表的引用，供 Agent 自动加载。
- Cursor 规则或 README：仅需引用上述 Skill（如「见 doc-driven-development」），无需重复写查文档流程。

---

## 4. 实施步骤

### CP1: 技术栈清单固化与官方文档 URL 映射

**目标**：将上表补全为带稳定文档 URL 的清单，并落盘为单文件。

**文件**：

| 文件 | 职责 | 行数预算 |
|------|------|----------|
| `.cursor/skills/doc-driven-development/references/tech-stack-docs.md` | 技术栈名称、版本约束、官方文档 URL、备注（作为 Skill 引用） | ≤200 |

**内容**：

1. 对上表逐项核对并补全「官方文档 URL」。
2. 区分「Context7 已支持」与「需 Firecrawl 抓取」的库（可查 context7.com 或文档）。
3. 写入上述 Skill 的 `references/tech-stack-docs.md`，格式简洁（表格或列表）；并在 `doc-driven-development/SKILL.md` 中引用该表及补充 Context7/Firecrawl 用法。

**验收标准**：

- [ ] 所有 pyproject.toml 主要依赖均有对应文档 URL。
- [ ] 映射表已写入 Skill 引用文件并提交；SKILL.md 已引用该表及 Context7/Firecrawl 用法。

---

### CP2: Context7 MCP 修复/验证与 API Key 配置

**目标**：使 Context7 MCP 在 Cursor 中可用；若不可用，在计划书中记录原因与替代方案。

**文件**：无代码文件，仅配置与文档。

**内容**：

1. 在 Cursor 设置中检查 Context7 MCP 状态（当前 STATUS 为 errored，需用户侧排查）。
2. 若需 API Key：按 [Context7 API Keys](https://context7.com/docs/howto/api-keys) 配置 `CONTEXT7_API_KEY` 或等效。
3. 在 Cursor 中做一次「use context7」的简单提问，验证能否拉取到文档片段。
4. 在计划书或 doc-driven-development Skill 的 `references/tech-stack-docs.md` 中记录：Context7 是否可用、若不可用则以 Firecrawl 为主。

**验收标准**：

- [ ] Context7 状态已确认并记录。
- [ ] 若可用，至少一次成功拉取文档的验证记录。

---

### CP3: 备用方案 — Firecrawl 拉取关键文档

**目标**：对核心依赖（LlamaIndex、Streamlit、FastAPI、Chroma）的文档首页或关键页，用 Firecrawl 抓取并保存为本地参考（可选），或仅约定「写代码前用 Firecrawl 抓该 URL」。

**文件**：

| 文件 | 职责 | 行数预算 |
|------|------|----------|
| `.cursor/skills/doc-driven-development/references/tech-stack-docs.md` | 补充「推荐 Firecrawl 抓取的 URL」列表 | +≤50 |

**内容**：

1. 在上述 Skill 的 `tech-stack-docs.md` 中增加「推荐用 Firecrawl 抓取的 URL」列表（如 LlamaIndex 入门、Streamlit API、FastAPI 依赖注入等）。
2. 可选：编写一次性脚本或文档说明，用 MCP `firecrawl_scrape` 对上述 URL 抓取 markdown 存到 `docs/cache/`（若项目允许缓存文档）；不做也可，仅约定「按需抓取」。

**验收标准**：

- [ ] 关键库的 Firecrawl URL 列表已写入文档。
- [ ] 若做了缓存，说明存放位置与更新策略。

---

### CP4: Agent 使用规范与 Cursor 规则

**目标**：让 Agent 在写涉及第三方库的代码时，优先查官方文档（Context7 或 Firecrawl），避免发明 API。

**文件**：

| 文件 | 职责 | 行数预算 |
|------|------|----------|
| `.cursor/rules/` 下规则或 README 片段 | 约定「第三方 API 优先查文档」，引用 doc-driven-development Skill（内含映射表与 use context7 / Firecrawl 用法） | ≤80 |

**内容**：

1. 在 Cursor 规则或 README 中写明：凡涉及本项目技术栈的 API/用法，优先查官方文档（见 **doc-driven-development** Skill：其 `references/tech-stack-docs.md` 为映射表；在提问中加 `use context7` 或使用 Firecrawl 抓取对应 URL，再生成代码）。
2. 规则/README 仅需引用该 Skill，无需重复写查文档流程；与 Cursor 体系统一。

**验收标准**：

- [ ] 规则或 README 已更新，且包含「use context7」与 Firecrawl 的简要说明。
- [ ] 新开发者/Agent 能据此知道「先查文档再写码」。

---

## 5. 风险与注意事项

### 5.1 风险点

- **Context7 持续不可用**：依赖 Firecrawl + 人工查阅文档；计划书中明确标注，避免误以为 Context7 已可用。
- **文档 URL 变更**：Skill 内 `references/tech-stack-docs.md` 需偶尔维护；可在版本升级时一并检查。

### 5.2 注意事项

- Context7 需 API Key 与网络；国内用户若遇限速，可优先用 Firecrawl 抓关键页。
- 不引入大而全的「全量文档爬取」：只做清单 + 按需拉取，符合项目聚焦原则。

---

## 6. 文件改动清单

| 文件 | 操作 | 说明 |
|------|------|------|
| `.cursor/skills/doc-driven-development/references/tech-stack-docs.md` | 新建 | 技术栈与官方文档 URL 映射，含 Firecrawl 推荐 URL（通过 Skill 集成） |
| `.cursor/skills/doc-driven-development/SKILL.md` | 修改 | 引用映射表并补充 use context7 / Firecrawl 用法 |
| `.cursor/rules/` 下规则或 `README.md` | 修改或新增 | 约定第三方 API 优先查文档，引用 doc-driven-development Skill |

---

## 7. 版本信息

- **创建日期**：2026-01-30
- **版本**：v1.0
