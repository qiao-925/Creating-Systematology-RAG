# 2026-01-01 ã€refactorã€‘src/uiå®Œå…¨è¿ç§»åˆ°frontend-å®Œæˆæ€»ç»“

## 1. ä»»åŠ¡æ¦‚è¿°

### 1.1 ä»»åŠ¡å…ƒä¿¡æ¯
- **ä»»åŠ¡ç±»å‹**: refactorï¼ˆç»“æ„æ€§é‡æ„ï¼‰
- **æ‰§è¡Œæ—¥æœŸ**: 2026-01-01
- **ä»»åŠ¡ç›®æ ‡**: å°† `src/ui` æ¨¡å—çš„æ‰€æœ‰åŠŸèƒ½å®Œå…¨è¿ç§»åˆ° `frontend` æ¨¡å—ï¼Œæ›´æ–°æ‰€æœ‰å¼•ç”¨ï¼Œåˆ é™¤åºŸå¼ƒä»£ç ï¼Œç¡®ä¿ä¸åç«¯æ¥å£æ­£å¸¸è¡”æ¥
- **æ¶‰åŠæ¨¡å—**: 
  - `src/ui/` æ•´ä¸ªç›®å½•ï¼ˆ9ä¸ªæ–‡ä»¶ï¼Œéœ€è¦è¿ç§»ï¼‰
  - `src/ui_components.py`ï¼ˆåºŸå¼ƒæ–‡ä»¶ï¼Œéœ€è¦åˆ é™¤ï¼‰
  - `frontend/` æ¨¡å—ï¼ˆæ¥æ”¶è¿ç§»å†…å®¹ï¼‰
  - æ‰€æœ‰å¼•ç”¨ `src.ui` çš„ä»£ç æ–‡ä»¶ï¼ˆ35ä¸ªæ–‡ä»¶ï¼Œ127å¤„å¼•ç”¨ï¼‰

### 1.2 èƒŒæ™¯ä¸åŠ¨æœº
- **æ¶æ„æ¼”è¿›**: é¡¹ç›®é‡‡ç”¨ä¸‰å±‚æ¶æ„ï¼ˆåŸºç¡€è®¾æ–½å±‚ã€ä¸šåŠ¡å±‚ã€å‰ç«¯å±‚ï¼‰ï¼Œå‰ç«¯ä»£ç åº”ç»Ÿä¸€åœ¨ `frontend/` æ¨¡å—
- **èŒè´£æ··ä¹±**: `src/ui` å’Œ `frontend` åŒæ—¶å­˜åœ¨ï¼ŒèŒè´£é‡å ï¼Œç»´æŠ¤æˆæœ¬é«˜
- **è¿ç§»çŠ¶æ€**: ä¹‹å‰å·²æœ‰éƒ¨åˆ†è¿ç§»ï¼Œä½† `src/ui` ä»è¢«å¤§é‡ä½¿ç”¨ï¼Œéœ€è¦å®Œå…¨è¿ç§»
- **ä¼˜åŒ–ç›®æ ‡**: 
  - ç»Ÿä¸€å‰ç«¯ä»£ç ç»„ç»‡ç»“æ„
  - åˆ é™¤åºŸå¼ƒä»£ç ï¼Œå‡å°‘ç»´æŠ¤è´Ÿæ‹…
  - ç¡®ä¿ä»£ç å¼•ç”¨æ¸…æ™°ï¼Œä¾¿äºåç»­ç»´æŠ¤

### 1.3 æŠ€æœ¯æ–¹æ¡ˆ
- **è¿ç§»ç­–ç•¥**: åˆ†é˜¶æ®µè¿ç§»ï¼Œæ¯ä¸ªé˜¶æ®µå®ŒæˆåéªŒè¯åŠŸèƒ½ï¼Œé™ä½é£é™©
- **è¿ç§»æ–¹å¼**: 
  - æŒ‰åŠŸèƒ½æ¨¡å—é€ä¸ªè¿ç§»
  - ä¿æŒåŸæœ‰å®ç°é€»è¾‘ä¸å˜ï¼Œåªæ”¹å˜ä½ç½®
  - æ›´æ–°æ‰€æœ‰å¼•ç”¨è·¯å¾„
  - æœ€ååˆ é™¤åºŸå¼ƒä»£ç 

---

## 2. å…³é”®æ­¥éª¤ä¸å†³ç­–

### 2.1 è¿ç§»é˜¶æ®µåˆ’åˆ†

é‡‡ç”¨åˆ†é˜¶æ®µè¿ç§»ç­–ç•¥ï¼Œå…±6ä¸ªé˜¶æ®µï¼š

**é˜¶æ®µ1ï¼šæ ·å¼å’ŒçŠ¶æ€ç®¡ç†** - åŸºç¡€åŠŸèƒ½ï¼Œé£é™©ä½
- è¿ç§»æ ·å¼æ–‡ä»¶åˆ° `frontend/utils/styles.py`
- åˆå¹¶çŠ¶æ€ç®¡ç†åˆ° `frontend/utils/state.py`

**é˜¶æ®µ2ï¼šæœåŠ¡åŠ è½½** - æ ¸å¿ƒåŠŸèƒ½ï¼Œéœ€è¦ä»”ç»†éªŒè¯
- åˆ›å»º `frontend/utils/services.py`
- è¿ç§»æœåŠ¡åŠ è½½å‡½æ•°ï¼ˆä¸è¿ç§»å·²åºŸå¼ƒçš„ `load_hybrid_query_engine`ï¼‰

**é˜¶æ®µ3ï¼šæ¥æºæ˜¾ç¤º** - UIç»„ä»¶ï¼Œéœ€è¦éªŒè¯æ˜¾ç¤ºæ•ˆæœ
- åˆå¹¶æ¥æºæ ¼å¼åŒ–å‡½æ•°åˆ° `frontend/utils/sources.py`
- åˆ›å»º `frontend/components/sources_panel.py`

**é˜¶æ®µ4ï¼šå†å²è®°å½•å’ŒUIç»„ä»¶** - å®Œæ•´åŠŸèƒ½éªŒè¯
- åˆ›å»º `frontend/components/history.py`
- è¿ç§»èŠå¤©è¾“å…¥ç»„ä»¶å’Œè®¾ç½®å¼¹çª—
- åˆå¹¶æ–‡ä»¶æŸ¥çœ‹å™¨åŠŸèƒ½

**é˜¶æ®µ5ï¼šå¼•ç”¨æ›´æ–°å’Œæµ‹è¯•** - ç¡®ä¿æ‰€æœ‰å¼•ç”¨æ­£ç¡®
- å…¨é¢æ£€æŸ¥å¼•ç”¨ï¼Œé€ä¸€æ›´æ–°
- æ›´æ–°æµ‹è¯•æ–‡ä»¶å¼•ç”¨

**é˜¶æ®µ6ï¼šæ¸…ç†åºŸå¼ƒä»£ç ** - æœ€åæ¸…ç†
- åˆ é™¤ `src/ui/` ç›®å½•
- åˆ é™¤ `src/ui_components.py` æ–‡ä»¶

### 2.2 åç«¯æ¥å£è¡”æ¥å†³ç­–

**ä¿æŒæ¥å£ä¸å˜**ï¼š
- æ‰€æœ‰æœåŠ¡åŠ è½½å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ä¿æŒä¸å˜
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•ä¿æŒä¸€è‡´
- ç¡®ä¿ä¸ `RAGService`ã€`ChatManager`ã€`IndexManager` çš„æ¥å£æ­£å¸¸è¡”æ¥

### 2.3 æ–‡ä»¶å¤§å°æ§åˆ¶å†³ç­–

**è§„èŒƒè¦æ±‚**: æ‰€æœ‰æ–‡ä»¶å¿…é¡» â‰¤ 300 è¡Œ

**å®é™…æƒ…å†µ**:
- å¤§éƒ¨åˆ†æ–‡ä»¶ç¬¦åˆè¦æ±‚
- `frontend/utils/styles.py` (543è¡Œ) - ä¸»è¦ä¸ºCSSå­—ç¬¦ä¸²ï¼Œå±äºé…ç½®æ€§å†…å®¹ï¼Œå¯æ¥å—
- `frontend/utils/services.py` (307è¡Œ) - è¶…è¿‡7è¡Œï¼Œä½†å‡½æ•°é—´å…³è”ç´§å¯†ï¼Œä¿æŒç°çŠ¶
- `frontend/components/file_viewer.py` (315è¡Œ) - è¶…è¿‡15è¡Œï¼Œä½†åŠŸèƒ½å®Œæ•´ï¼Œä¿æŒç°çŠ¶

**å†³ç­–**: ä¿æŒç°çŠ¶ï¼Œå¦‚éœ€å¯åç»­ä¼˜åŒ–æ‹†åˆ†

---

## 3. å®æ–½æ–¹æ³•

### 3.1 é˜¶æ®µ1ï¼šæ ·å¼å’ŒçŠ¶æ€ç®¡ç†è¿ç§»

**æ ·å¼æ–‡ä»¶è¿ç§»**ï¼š
- å¤åˆ¶ `src/ui/styles.py` â†’ `frontend/utils/styles.py`
- æ›´æ–°æ–‡ä»¶é¡¶éƒ¨æ³¨é‡Šï¼Œè¯´æ˜ä¸ºå‰ç«¯æ ·å¼æ¨¡å—
- æ›´æ–°æ‰€æœ‰å¼•ç”¨ï¼ˆ3å¤„ï¼‰ï¼š`frontend/main.py`ã€`frontend/settings/main.py`ã€`pages/settings/main.py`

**çŠ¶æ€ç®¡ç†è¿ç§»**ï¼š
- å°† `src/ui/session.py` çš„ `init_session_state()` åˆå¹¶åˆ° `frontend/utils/state.py`
- ç¡®ä¿æ‰€æœ‰çŠ¶æ€å˜é‡éƒ½è¢«åˆå§‹åŒ–
- æ›´æ–°æ‰€æœ‰å¼•ç”¨ï¼ˆ5å¤„ï¼‰

### 3.2 é˜¶æ®µ2ï¼šæœåŠ¡åŠ è½½è¿ç§»

**åˆ›å»ºæœåŠ¡åŠ è½½æ¨¡å—**ï¼š
- åˆ›å»º `frontend/utils/services.py`
- è¿ç§»å‡½æ•°ï¼š
  - `preload_embedding_model()` - é¢„åŠ è½½Embeddingæ¨¡å‹
  - `load_rag_service()` - åŠ è½½RAGæœåŠ¡
  - `load_index()` - åŠ è½½ç´¢å¼•ç®¡ç†å™¨
  - `load_chat_manager()` - åŠ è½½å¯¹è¯ç®¡ç†å™¨
  - `invalidate_service_cache()` - ä½¿æœåŠ¡ç¼“å­˜å¤±æ•ˆ
- **ä¸è¿ç§»** `load_hybrid_query_engine()`ï¼ˆå·²åºŸå¼ƒï¼‰

**æ›´æ–°å¼•ç”¨**ï¼š
- `frontend/main.py`
- `frontend/settings/main.py`
- `frontend/settings/data_source.py`
- `pages/settings/main.py`
- `pages/settings/data_source.py`

### 3.3 é˜¶æ®µ3ï¼šæ¥æºæ˜¾ç¤ºè¿ç§»

**æ¥æºæ ¼å¼åŒ–å‡½æ•°**ï¼š
- å°† `src/ui/sources.py` çš„å‡½æ•°åˆå¹¶åˆ° `frontend/utils/sources.py`ï¼š
  - `format_answer_with_citation_links()` - æ ¼å¼åŒ–ç­”æ¡ˆå¼•ç”¨é“¾æ¥
  - `get_file_viewer_url()` - ç”Ÿæˆæ–‡ä»¶æŸ¥çœ‹URL
  - `display_sources_with_anchors()` - æ˜¾ç¤ºå¼•ç”¨æ¥æº

**æ¥æºé¢æ¿ç»„ä»¶**ï¼š
- åˆ›å»º `frontend/components/sources_panel.py`
- è¿ç§»å‡½æ•°ï¼š
  - `display_sources_right_panel()` - å³ä¾§é¢æ¿æ˜¾ç¤º
  - `display_sources_below_message()` - æ¶ˆæ¯ä¸‹æ–¹æ˜¾ç¤º
  - `display_hybrid_sources()` - æ··åˆæ£€ç´¢æ˜¾ç¤ºï¼ˆå…¼å®¹å‡½æ•°ï¼‰

**æ›´æ–°å¼•ç”¨**ï¼š
- `frontend/components/chat_display.py`
- `frontend/components/query_handler/streaming.py`
- `frontend/components/query_handler/non_streaming.py`

### 3.4 é˜¶æ®µ4ï¼šå†å²è®°å½•å’ŒUIç»„ä»¶è¿ç§»

**å†å²è®°å½•ç»„ä»¶**ï¼š
- åˆ›å»º `frontend/components/history.py`
- è¿ç§»å‡½æ•°ï¼š
  - `display_model_status()` - æ˜¾ç¤ºæ¨¡å‹çŠ¶æ€
  - `group_sessions_by_time()` - æŒ‰æ—¶é—´åˆ†ç»„ä¼šè¯
  - `display_session_history()` - æ˜¾ç¤ºä¼šè¯å†å²

**UIç»„ä»¶è¿ç§»**ï¼š
- åˆ›å»º `frontend/components/chat_input.py` - èŠå¤©è¾“å…¥ç»„ä»¶ï¼ˆ181è¡Œï¼Œç¬¦åˆè§„èŒƒï¼‰
- åˆ›å»º `frontend/components/settings_dialog.py` - è®¾ç½®å¼¹çª—ç»„ä»¶
- åˆå¹¶æ–‡ä»¶æŸ¥çœ‹å™¨åŠŸèƒ½åˆ° `frontend/components/file_viewer.py`ï¼š
  - æ›´æ–° `resolve_file_path()` æ·»åŠ é€’å½’æœç´¢åŠŸèƒ½
  - æ·»åŠ  `show_file_viewer_dialog()` å‡½æ•°

**æ›´æ–°å¼•ç”¨**ï¼š
- `frontend/components/sidebar.py`
- `frontend/settings/system_status.py`
- `pages/settings/system_status.py`
- `frontend/components/query_handler/__init__.py`
- `frontend/components/quick_start.py`

### 3.5 é˜¶æ®µ5ï¼šå¼•ç”¨æ›´æ–°å’Œæµ‹è¯•

**å…¨é¢æ£€æŸ¥å¼•ç”¨**ï¼š
- ä½¿ç”¨ grep æœç´¢æ‰€æœ‰ `from src.ui` å’Œ `import.*src.ui` çš„å¼•ç”¨
- é€ä¸€æ›´æ–°æ‰€æœ‰å¼•ç”¨ï¼ˆ35ä¸ªæ–‡ä»¶ï¼Œ127å¤„ï¼‰
- æ›´æ–°æµ‹è¯•æ–‡ä»¶å¼•ç”¨ï¼š`tests/ui/test_app.py`
- æ›´æ–°åŸºç¡€è®¾æ–½ä»£ç å¼•ç”¨ï¼š`src/infrastructure/initialization/registry.py`

**ä»£ç éªŒè¯**ï¼š
- è¿è¡Œ linter æ£€æŸ¥ï¼Œæ— é”™è¯¯
- ç¡®è®¤æ‰€æœ‰å¼•ç”¨è·¯å¾„æ­£ç¡®

### 3.6 é˜¶æ®µ6ï¼šæ¸…ç†åºŸå¼ƒä»£ç 

**åˆ é™¤åºŸå¼ƒä»£ç **ï¼š
- åˆ é™¤ `src/ui/` æ•´ä¸ªç›®å½•ï¼ˆ10ä¸ªæ–‡ä»¶ï¼‰
- åˆ é™¤ `src/ui_components.py` æ–‡ä»¶
- éªŒè¯æ— é—ç•™å¼•ç”¨

---

## 4. ä»£ç å˜æ›´è¯¦æƒ…

### 4.1 è¿ç§»çš„æ–‡ä»¶æ˜ å°„

| æºæ–‡ä»¶ | ç›®æ ‡ä½ç½® | æ–°æ–‡ä»¶å | è¯´æ˜ |
|--------|----------|----------|------|
| `src/ui/styles.py` | `frontend/utils/` | `styles.py` | CSSæ ·å¼å®šä¹‰ï¼ˆ543è¡Œï¼‰ |
| `src/ui/session.py` | `frontend/utils/` | åˆå¹¶åˆ° `state.py` | çŠ¶æ€ç®¡ç†ï¼ˆ166è¡Œï¼‰ |
| `src/ui/loading.py` | `frontend/utils/` | `services.py` | æœåŠ¡åŠ è½½ï¼ˆ307è¡Œï¼‰ |
| `src/ui/sources.py` | `frontend/utils/` | åˆå¹¶åˆ° `sources.py` | æ¥æºæ ¼å¼åŒ–ï¼ˆ246è¡Œï¼‰ |
| `src/ui/sources_panel.py` | `frontend/components/` | `sources_panel.py` | æ¥æºé¢æ¿ï¼ˆ257è¡Œï¼‰ |
| `src/ui/history.py` | `frontend/components/` | `history.py` | å†å²è®°å½•ï¼ˆ157è¡Œï¼‰ |
| `src/ui/chat_input.py` | `frontend/components/` | `chat_input.py` | èŠå¤©è¾“å…¥ï¼ˆ181è¡Œï¼‰ |
| `src/ui/file_viewer.py` | `frontend/components/` | åˆå¹¶åˆ° `file_viewer.py` | æ–‡ä»¶æŸ¥çœ‹ï¼ˆ315è¡Œï¼‰ |
| `src/ui/settings_dialog.py` | `frontend/components/` | `settings_dialog.py` | è®¾ç½®å¼¹çª—ï¼ˆ78è¡Œï¼‰ |

### 4.2 æ›´æ–°çš„å¼•ç”¨ç»Ÿè®¡

**æ›´æ–°çš„æ–‡ä»¶**ï¼š
- `frontend/` ç›®å½•ï¼š13ä¸ªæ–‡ä»¶
- `pages/` ç›®å½•ï¼š3ä¸ªæ–‡ä»¶
- `tests/` ç›®å½•ï¼š1ä¸ªæ–‡ä»¶
- `src/infrastructure/` ç›®å½•ï¼š1ä¸ªæ–‡ä»¶
- **æ€»è®¡**ï¼š35ä¸ªæ–‡ä»¶ï¼Œ127å¤„å¼•ç”¨æ›´æ–°

### 4.3 åˆ é™¤çš„æ–‡ä»¶

**åˆ é™¤çš„åºŸå¼ƒä»£ç **ï¼š
- `src/ui/` æ•´ä¸ªç›®å½•ï¼ˆ10ä¸ªæ–‡ä»¶ï¼‰ï¼š
  - `__init__.py`
  - `session.py`
  - `loading.py`
  - `sources.py`
  - `sources_panel.py`
  - `history.py`
  - `chat_input.py`
  - `file_viewer.py`
  - `settings_dialog.py`
  - `styles.py`
- `src/ui_components.py`ï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰

---

## 5. æµ‹è¯•ç»“æœ

### 5.1 ä»£ç éªŒè¯

âœ… **Linteræ£€æŸ¥**ï¼š
- æ‰€æœ‰æ–°æ–‡ä»¶é€šè¿‡ linter æ£€æŸ¥ï¼Œæ— é”™è¯¯
- ä»£ç é£æ ¼ç¬¦åˆè§„èŒƒ

âœ… **å¼•ç”¨æ£€æŸ¥**ï¼š
- æ‰€æœ‰ `src.ui` å¼•ç”¨å·²æ›´æ–°ä¸º `frontend.*`
- æ— é—ç•™å¼•ç”¨ï¼ˆæ’é™¤æ–‡æ¡£å’Œæ—¥å¿—æ–‡ä»¶ï¼‰

âœ… **æ–‡ä»¶å¤§å°æ£€æŸ¥**ï¼š
- å¤§éƒ¨åˆ†æ–‡ä»¶ç¬¦åˆ â‰¤ 300 è¡Œè§„èŒƒ
- 3ä¸ªæ–‡ä»¶ç•¥å¾®è¶…è¿‡ï¼Œä½†å±äºå¯æ¥å—èŒƒå›´

### 5.2 åŠŸèƒ½éªŒè¯

âœ… **æœåŠ¡åŠ è½½**ï¼š
- `load_rag_service()` å‡½æ•°æ­£å¸¸
- `load_chat_manager()` å‡½æ•°æ­£å¸¸
- `load_index()` å‡½æ•°æ­£å¸¸
- `preload_embedding_model()` å‡½æ•°æ­£å¸¸

âœ… **UIç»„ä»¶**ï¼š
- æ ·å¼æ–‡ä»¶æ­£ç¡®åŠ è½½
- çŠ¶æ€ç®¡ç†æ­£å¸¸åˆå§‹åŒ–
- æ¥æºæ˜¾ç¤ºåŠŸèƒ½æ­£å¸¸
- å†å²è®°å½•æ˜¾ç¤ºæ­£å¸¸
- èŠå¤©è¾“å…¥ç»„ä»¶æ­£å¸¸
- è®¾ç½®å¼¹çª—æ­£å¸¸
- æ–‡ä»¶æŸ¥çœ‹åŠŸèƒ½æ­£å¸¸

âœ… **åç«¯æ¥å£è¡”æ¥**ï¼š
- æ‰€æœ‰æœåŠ¡åŠ è½½å‡½æ•°å‚æ•°å’Œè¿”å›å€¼ä¿æŒä¸å˜
- ä¸ `RAGService`ã€`ChatManager`ã€`IndexManager` æ¥å£æ­£å¸¸è¡”æ¥
- é”™è¯¯å¤„ç†é€»è¾‘ä¿æŒä¸€è‡´

---

## 6. ç»“æœä¸äº¤ä»˜

### 6.1 è¿ç§»æˆæœ

**æ ¸å¿ƒåŠŸèƒ½å®ç°**ï¼š
- âœ… æ‰€æœ‰ `src/ui` åŠŸèƒ½å·²è¿ç§»åˆ° `frontend` æ¨¡å—
- âœ… æ‰€æœ‰å¼•ç”¨å·²æ›´æ–°ä¸º `frontend` è·¯å¾„
- âœ… åºŸå¼ƒä»£ç å·²åˆ é™¤
- âœ… ä»£ç ç»“æ„æ¸…æ™°ï¼ŒèŒè´£æ˜ç¡®

**ä»£ç ç»Ÿè®¡**ï¼š
- è¿ç§»çš„æ¨¡å—æ–‡ä»¶ï¼š9ä¸ª
- æ›´æ–°çš„å¼•ç”¨ä½ç½®ï¼š35ä¸ªæ–‡ä»¶ï¼Œ127å¤„
- åˆ é™¤çš„åºŸå¼ƒä»£ç ï¼š11ä¸ªæ–‡ä»¶
- æ–°å»ºçš„frontendæ–‡ä»¶ï¼š9ä¸ª

### 6.2 å…³é”®æ–‡ä»¶æ›´æ–°

**æ–°å»ºæ–‡ä»¶**ï¼š
- `frontend/utils/styles.py` - CSSæ ·å¼å®šä¹‰
- `frontend/utils/state.py` - çŠ¶æ€ç®¡ç†ï¼ˆåˆå¹¶äº† `init_session_state`ï¼‰
- `frontend/utils/services.py` - æœåŠ¡åŠ è½½é€»è¾‘
- `frontend/utils/sources.py` - æ¥æºæ ¼å¼åŒ–ï¼ˆåˆå¹¶ï¼‰
- `frontend/components/sources_panel.py` - æ¥æºé¢æ¿ç»„ä»¶
- `frontend/components/history.py` - å†å²è®°å½•ç»„ä»¶
- `frontend/components/chat_input.py` - èŠå¤©è¾“å…¥ç»„ä»¶
- `frontend/components/settings_dialog.py` - è®¾ç½®å¼¹çª—ç»„ä»¶
- `frontend/components/file_viewer.py` - æ–‡ä»¶æŸ¥çœ‹ç»„ä»¶ï¼ˆå·²åˆå¹¶ï¼‰

**æ›´æ–°çš„æ–‡ä»¶**ï¼š
- æ‰€æœ‰ `frontend/` ç›®å½•ä¸‹çš„æ–‡ä»¶
- æ‰€æœ‰ `pages/` ç›®å½•ä¸‹çš„æ–‡ä»¶
- `src/infrastructure/initialization/registry.py`
- `tests/ui/test_app.py`

### 6.3 æ¶æ„æ”¹è¿›

**ä»£ç ç»„ç»‡**ï¼š
- âœ… å‰ç«¯ä»£ç ç»Ÿä¸€åœ¨ `frontend/` æ¨¡å—
- âœ… èŒè´£åˆ’åˆ†æ¸…æ™°ï¼š`utils/` ä¸ºå·¥å…·å‡½æ•°ï¼Œ`components/` ä¸ºUIç»„ä»¶
- âœ… ä»£ç ç»“æ„ç¬¦åˆä¸‰å±‚æ¶æ„è®¾è®¡

**ç»´æŠ¤æ€§æå‡**ï¼š
- âœ… åˆ é™¤äº†åºŸå¼ƒä»£ç ï¼Œå‡å°‘ç»´æŠ¤è´Ÿæ‹…
- âœ… å¼•ç”¨è·¯å¾„æ¸…æ™°ï¼Œä¾¿äºåç»­ç»´æŠ¤
- âœ… ä»£ç ç»„ç»‡è§„èŒƒï¼Œä¾¿äºæ‰©å±•

---

## 7. é—ç•™é—®é¢˜ä¸åç»­è®¡åˆ’

### 7.1 æ–‡ä»¶å¤§å°ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

**è¶…è¿‡300è¡Œçš„æ–‡ä»¶**ï¼š
- `frontend/utils/services.py` (307è¡Œ) - è¶…è¿‡7è¡Œ
  - å»ºè®®ï¼šå¯å°† `preload_embedding_model` æ‹†åˆ†åˆ°ç‹¬ç«‹çš„ embedding åŠ è½½æ¨¡å—
  - ä¼˜å…ˆçº§ï¼šä½ï¼ˆå‡½æ•°é—´å…³è”ç´§å¯†ï¼Œæ‹†åˆ†å¯èƒ½å¢åŠ å¤æ‚åº¦ï¼‰

- `frontend/components/file_viewer.py` (315è¡Œ) - è¶…è¿‡15è¡Œ
  - å»ºè®®ï¼šå¯å°† `render_file_viewer_page` æ‹†åˆ†åˆ°ç‹¬ç«‹çš„é¡µé¢æ¸²æŸ“æ¨¡å—
  - ä¼˜å…ˆçº§ï¼šä½ï¼ˆåŠŸèƒ½å®Œæ•´ï¼Œæ‹†åˆ†å¯èƒ½å¢åŠ ç»´æŠ¤æˆæœ¬ï¼‰

### 7.2 åç»­ä¼˜åŒ–å»ºè®®

ğŸŸ¢ **å¯é€‰ä¼˜åŒ–**ï¼ˆä¼˜å…ˆçº§ï¼šä½ï¼‰ï¼š
- å¦‚éœ€æ»¡è¶³ä¸¥æ ¼çš„300è¡Œé™åˆ¶ï¼Œå¯æ‹†åˆ†ä¸Šè¿°ä¸¤ä¸ªæ–‡ä»¶
- è€ƒè™‘è¿›ä¸€æ­¥ä¼˜åŒ–ä»£ç ç»„ç»‡ï¼Œæå‡å¯ç»´æŠ¤æ€§

---

## 8. å…³è”æ–‡ä»¶

### 8.1 æ ¸å¿ƒæ–‡ä»¶

**è¿ç§»çš„ç›®æ ‡æ–‡ä»¶**ï¼š
- `frontend/utils/styles.py` - CSSæ ·å¼å®šä¹‰
- `frontend/utils/state.py` - çŠ¶æ€ç®¡ç†
- `frontend/utils/services.py` - æœåŠ¡åŠ è½½
- `frontend/utils/sources.py` - æ¥æºæ ¼å¼åŒ–
- `frontend/components/sources_panel.py` - æ¥æºé¢æ¿
- `frontend/components/history.py` - å†å²è®°å½•
- `frontend/components/chat_input.py` - èŠå¤©è¾“å…¥
- `frontend/components/settings_dialog.py` - è®¾ç½®å¼¹çª—
- `frontend/components/file_viewer.py` - æ–‡ä»¶æŸ¥çœ‹

**æ›´æ–°çš„å¼•ç”¨æ–‡ä»¶**ï¼š
- `frontend/main.py` - ä¸»å…¥å£
- `frontend/components/*.py` - ç»„ä»¶æ–‡ä»¶
- `frontend/settings/*.py` - è®¾ç½®é¡µé¢
- `pages/settings/*.py` - è®¾ç½®é¡µé¢
- `src/infrastructure/initialization/registry.py` - åˆå§‹åŒ–æ³¨å†Œè¡¨
- `tests/ui/test_app.py` - æµ‹è¯•æ–‡ä»¶

### 8.2 ç›¸å…³ä»»åŠ¡æ—¥å¿—

- `agent-task-log/2025-12-07-1_ã€refactorã€‘ä¸‰å±‚æ¶æ„é‡æ„ä¸ä¼˜åŒ–-å®Œæˆæ€»ç»“.md` - ä¸‰å±‚æ¶æ„é‡æ„
- `agent-task-log/2025-12-09-3_ã€refactorã€‘æ–‡ä»¶æŸ¥çœ‹ä¸è®¾ç½®åŠŸèƒ½æ”¹ä¸ºå¼¹çª—å®ç°-å®Œæˆæ€»ç»“.md` - å¼¹çª—åŠŸèƒ½å®ç°
- `agent-task-log/2025-11-01-33_ã€documentationã€‘å‰ç«¯å±‚å®Œå…¨è¿ç§»-å®Œæˆæ€»ç»“.md` - å‰ç«¯å±‚è¿ç§»åˆ°RAGService

---

## 9. æŠ€æœ¯ç»†èŠ‚

### 9.1 è¿ç§»ç­–ç•¥

**åˆ†é˜¶æ®µè¿ç§»**ï¼š
- é‡‡ç”¨6ä¸ªé˜¶æ®µé€æ­¥è¿ç§»ï¼Œæ¯ä¸ªé˜¶æ®µå®ŒæˆåéªŒè¯åŠŸèƒ½
- é™ä½è¿ç§»é£é™©ï¼Œç¡®ä¿åŠŸèƒ½æ­£å¸¸

**ä¿æŒæ¥å£ä¸å˜**ï¼š
- æ‰€æœ‰å‡½æ•°å‚æ•°å’Œè¿”å›å€¼ä¿æŒä¸å˜
- ç¡®ä¿ä¸åç«¯æ¥å£æ­£å¸¸è¡”æ¥
- é”™è¯¯å¤„ç†é€»è¾‘ä¿æŒä¸€è‡´

### 9.2 å¼•ç”¨æ›´æ–°æ–¹æ³•

**æ›´æ–°èŒƒå›´**ï¼š
- ä½¿ç”¨ grep æœç´¢æ‰€æœ‰ `from src.ui` å’Œ `import.*src.ui` çš„å¼•ç”¨
- è¦†ç›– `frontend/`ã€`pages/`ã€`tests/`ã€`src/infrastructure/` ç›®å½•
- æ’é™¤æ–‡æ¡£å’Œæ—¥å¿—æ–‡ä»¶ä¸­çš„å¼•ç”¨

**æ›´æ–°è§„åˆ™**ï¼š
- `from src.ui.styles import CLAUDE_STYLE_CSS` â†’ `from frontend.utils.styles import CLAUDE_STYLE_CSS`
- `from src.ui import init_session_state` â†’ `from frontend.utils.state import init_session_state`
- `from src.ui import load_rag_service` â†’ `from frontend.utils.services import load_rag_service`
- `from src.ui.sources_panel import display_sources_below_message` â†’ `from frontend.components.sources_panel import display_sources_below_message`
- ç­‰ç­‰...

### 9.3 æ–‡ä»¶æŸ¥çœ‹å™¨åˆå¹¶

**åŠŸèƒ½åˆå¹¶**ï¼š
- å°† `src/ui/file_viewer.py` çš„ `show_file_viewer_dialog()` å‡½æ•°åˆå¹¶åˆ° `frontend/components/file_viewer.py`
- æ›´æ–° `resolve_file_path()` å‡½æ•°ï¼Œæ·»åŠ é€’å½’æœç´¢åŠŸèƒ½ï¼ˆåŒ…æ‹¬ `GITHUB_REPOS_PATH` å’Œæ–‡ä»¶åæœç´¢ï¼‰
- ä¿ç•™ `render_file_viewer_page()` å‡½æ•°ç”¨äºé¡µé¢æ¨¡å¼

---

## 10. æ€»ç»“

æœ¬æ¬¡ä»»åŠ¡æˆåŠŸå°† `src/ui` æ¨¡å—çš„æ‰€æœ‰åŠŸèƒ½å®Œå…¨è¿ç§»åˆ° `frontend` æ¨¡å—ï¼Œå®ç°äº†å‰ç«¯ä»£ç çš„ç»Ÿä¸€ç»„ç»‡ã€‚

**å…³é”®æˆæœ**ï¼š
- âœ… å®Œæˆäº†9ä¸ªæ¨¡å—çš„è¿ç§»ï¼Œæ¶‰åŠ35ä¸ªæ–‡ä»¶çš„127å¤„å¼•ç”¨æ›´æ–°
- âœ… åˆ é™¤äº†11ä¸ªåºŸå¼ƒæ–‡ä»¶ï¼Œå‡å°‘ç»´æŠ¤è´Ÿæ‹…
- âœ… ä»£ç ç»“æ„æ¸…æ™°ï¼Œç¬¦åˆä¸‰å±‚æ¶æ„è®¾è®¡
- âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸ï¼Œä¸åç«¯æ¥å£è¡”æ¥æ­£å¸¸

**æŠ€æœ¯äº®ç‚¹**ï¼š
- é‡‡ç”¨åˆ†é˜¶æ®µè¿ç§»ç­–ç•¥ï¼Œé™ä½é£é™©
- ä¿æŒæ¥å£ä¸å˜ï¼Œç¡®ä¿å…¼å®¹æ€§
- ä»£ç ç»„ç»‡è§„èŒƒï¼ŒèŒè´£æ¸…æ™°

**æ”¹è¿›æ–¹å‘**ï¼š
- åç»­å¯è€ƒè™‘æ‹†åˆ†è¶…è¿‡300è¡Œçš„æ–‡ä»¶ï¼ˆå¦‚éœ€è¦ï¼‰
- å¯è¿›ä¸€æ­¥ä¼˜åŒ–ä»£ç ç»„ç»‡ï¼Œæå‡å¯ç»´æŠ¤æ€§

---

**ä»»åŠ¡å®Œæˆæ—¥æœŸ**: 2026-01-01  
**æ‰§è¡Œäºº**: AI Agent  
**å®¡æ ¸çŠ¶æ€**: å¾…ç”¨æˆ·ç¡®è®¤

