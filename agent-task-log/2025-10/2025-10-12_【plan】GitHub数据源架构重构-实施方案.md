# 2025-10-12 ã€planã€‘GitHubæ•°æ®æºæ¶æ„é‡æ„å®æ–½æ–¹æ¡ˆ

**ã€Task Typeã€‘**: plan
**æ—¥æœŸ**: 2025-10-12  
**ä»»åŠ¡**: å°† GithubRepositoryReader æ›¿æ¢ä¸º LangChain GitLoader  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**æ‰§è¡Œæ—¶é•¿**: çº¦2å°æ—¶

---

## ä¸€ã€èƒŒæ™¯å’Œç›®æ ‡

### é—®é¢˜

æ—§å®ç°ä½¿ç”¨ `llama-index-readers-github`ï¼ŒåŸºäº GitHub API åŠ è½½æ–‡ä»¶ï¼š
- âŒ API é™æµï¼ˆ60æ¬¡/å°æ—¶ï¼Œæœ‰Tokenæ—¶5000æ¬¡/å°æ—¶ï¼‰
- âŒ ç½‘ç»œå»¶è¿Ÿé«˜ï¼Œæ¯æ¬¡éƒ½éœ€è”ç½‘
- âŒ æ— æ³•åˆ©ç”¨ Git çš„å¢é‡æ›´æ–°èƒ½åŠ›
- âŒ ä¸ GitHub API å¼ºè€¦åˆï¼Œéš¾ä»¥æ‰©å±•åˆ°å…¶ä»– Git å¹³å°

### ç›®æ ‡

ä½¿ç”¨ LangChain GitLoader + æœ¬åœ° Git å…‹éš†ï¼š
- âœ… æœ¬åœ°å­˜å‚¨ï¼Œå¢é‡æ›´æ–°å¿«é€Ÿ
- âœ… åˆ©ç”¨ Git åŸç”Ÿèƒ½åŠ›
- âœ… ä½è€¦åˆï¼Œæ˜“æ‰©å±•åˆ°å…¶ä»– Git å¹³å°

---

## äºŒã€æŠ€æœ¯æ–¹æ¡ˆ

### æ ¸å¿ƒæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Web ç•Œé¢ (app.py)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            data_loader.py                                â”‚
â”‚  - load_documents_from_github()                         â”‚
â”‚  - sync_github_repository()                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                        â”‚
             â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GitRepositoryManager   â”‚  â”‚  LangChain GitLoader        â”‚
â”‚ (æ–°å¢)                 â”‚  â”‚  (æ›¿æ¢ GithubRepoReader)    â”‚
â”‚                        â”‚  â”‚                             â”‚
â”‚ - clone_or_update()    â”‚  â”‚ - åŠ è½½æ–‡æ¡£                   â”‚
â”‚ - get_commit_sha()     â”‚  â”‚ - æ–‡ä»¶è¿‡æ»¤                   â”‚
â”‚ - cleanup_repo()       â”‚  â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æœ¬åœ° Git ä»“åº“                               â”‚
â”‚       data/github_repos/owner/repo_branch/              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸¤çº§å¢é‡æ£€æµ‹

```python
# 1. å¿«é€Ÿæ£€æµ‹ï¼šæ¯”è¾ƒ commit SHA
old_commit = metadata.get('last_commit_sha')
new_commit = git_manager.get_current_commit_sha()

if old_commit == new_commit:
    return []  # è·³è¿‡ï¼Œç§’çº§å®Œæˆ

# 2. ç²¾ç»†æ£€æµ‹ï¼šæ–‡ä»¶çº§å“ˆå¸Œæ¯”å¯¹
changes = metadata_manager.detect_changes(documents)
# åªç´¢å¼•å˜æ›´çš„æ–‡ä»¶ï¼ˆadded, modifiedï¼‰
```

---

## ä¸‰ã€å®æ–½æ­¥éª¤

### æ­¥éª¤ 1: ä¾èµ–å˜æ›´

**ä¿®æ”¹ `pyproject.toml`**:
```toml
# ç§»é™¤
- llama-index-readers-github>=0.2.0

# æ·»åŠ 
+ langchain-community>=0.3.0
```

### æ­¥éª¤ 2: æ–°å¢ Git ä»“åº“ç®¡ç†å™¨

**æ–°å¢ `src/git_repository_manager.py`** (~150è¡Œ):
```python
class GitRepositoryManager:
    def clone_or_update(owner, repo, branch, token):
        """å…‹éš†æˆ–æ›´æ–°ä»“åº“ï¼Œè¿”å› (è·¯å¾„, commit_sha)"""
        if not repo_path.exists():
            # git clone --depth 1
        else:
            # git pull
        return repo_path, commit_sha
```

**å…³é”®å®ç°**:
- ä½¿ç”¨ `subprocess` æ‰§è¡Œ git å‘½ä»¤
- Token é€šè¿‡ HTTPS URL ä¼ é€’ï¼ˆå®‰å…¨ï¼‰
- æµ…å…‹éš†ï¼ˆ`--depth 1`ï¼‰èŠ‚çœç©ºé—´
- è¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—

### æ­¥éª¤ 3: é‡æ„ data_loader.py

**ä¸»è¦å˜æ›´**:
1. å¯¼å…¥ LangChain GitLoader å’Œ GitRepositoryManager
2. é‡å†™ `load_documents_from_github()`:
   - ä½¿ç”¨ GitRepositoryManager å…‹éš†/æ›´æ–°
   - ä½¿ç”¨ GitLoader åŠ è½½æ–‡æ¡£
   - è½¬æ¢ LangChain Document â†’ LlamaIndex Document
   - ä¿æŒåŸæœ‰çš„å…ƒæ•°æ®æ ¼å¼

3. å¢å¼º `sync_github_repository()`:
   - æ·»åŠ  commit SHA å¿«é€Ÿæ£€æµ‹
   - ä¿æŒæ–‡ä»¶çº§å“ˆå¸Œç²¾ç»†æ£€æµ‹

**æ–‡ä»¶è¿‡æ»¤å®ç°**:
```python
def _build_file_filter(dirs, exts):
    """å°†ç”¨æˆ·å‹å¥½çš„å‚æ•°è½¬æ¢ä¸º lambda å‡½æ•°"""
    def file_filter(path):
        # æ£€æŸ¥ç›®å½•
        # æ£€æŸ¥æ‰©å±•å
        # æ’é™¤ .git/, __pycache__ ç­‰
        return True/False
    return file_filter
```

### æ­¥éª¤ 4: æ›´æ–° app.py

**3å¤„è°ƒç”¨æ›´æ–°**:
```python
# æ—§ç‰ˆæœ¬
documents, changes = sync_github_repository(...)

# æ–°ç‰ˆæœ¬ï¼ˆæ¥æ”¶ commit_shaï¼‰
documents, changes, commit_sha = sync_github_repository(...)

# æ›´æ–°å…ƒæ•°æ®æ—¶ä¼ é€’ commit_sha
metadata_manager.update_repository_metadata(..., commit_sha=commit_sha)
```

### æ­¥éª¤ 5: é…ç½®æ›´æ–°

**`src/config.py`**:
```python
self.GITHUB_REPOS_PATH = self._get_path("GITHUB_REPOS_PATH", "data/github_repos")

# åœ¨ ensure_directories() ä¸­æ·»åŠ 
directories.append(self.GITHUB_REPOS_PATH)
```

### æ­¥éª¤ 6: æµ‹è¯•æ›´æ–°

**æ–°å¢ `tests/unit/test_git_repository_manager.py`** (16ä¸ªæµ‹è¯•):
- æµ‹è¯•å…‹éš†/æ›´æ–°é€»è¾‘
- æµ‹è¯• commit SHA è·å–
- æµ‹è¯•æ¸…ç†åŠŸèƒ½
- æµ‹è¯•é”™è¯¯å¤„ç†

**æ›´æ–° `tests/unit/test_data_loader.py`**:
- è°ƒæ•´ mock ç­–ç•¥ï¼ˆGitLoader + GitRepositoryManagerï¼‰
- æ›´æ–° GitHub ç›¸å…³æµ‹è¯•ç”¨ä¾‹ï¼ˆ7ä¸ªï¼‰

### æ­¥éª¤ 7: æ–‡æ¡£æ›´æ–°

- âœ… `docs/API.md` - æ›´æ–° GitHub åŠ è½½ API è¯´æ˜
- âœ… `docs/CHANGELOG.md` - è®°å½•æ¶æ„å˜æ›´
- âœ… `docs/DECISIONS.md` - ADR-010 æŠ€æœ¯å†³ç­–
- âœ… `README.md` - æ›´æ–°æŠ€æœ¯æ ˆå’Œä½¿ç”¨è¯´æ˜

---

## å››ã€å…³é”®æŠ€æœ¯ç‚¹

### 1. Token å®‰å…¨

```python
# âŒ ä¸å®‰å…¨ï¼šToken æš´éœ²åœ¨å‘½ä»¤è¡Œå‚æ•°
subprocess.run(['git', 'clone', '--token', token, url])

# âœ… å®‰å…¨ï¼šToken åµŒå…¥ URL
clone_url = f"https://{token}@github.com/{owner}/{repo}.git"
subprocess.run(['git', 'clone', clone_url, path])

# âœ… æ—¥å¿—æ¸…ç†
output = re.sub(r'https://[^@]+@', 'https://***@', output)
```

### 2. æ–‡æ¡£æ ¼å¼è½¬æ¢

```python
def _convert_langchain_to_llama_doc(lc_doc, owner, repo, branch):
    """LangChain Document â†’ LlamaIndex LlamaDocument"""
    return LlamaDocument(
        text=lc_doc.page_content,
        metadata={
            'file_path': lc_doc.metadata.get('file_path'),
            'source_type': 'github',
            'repository': f"{owner}/{repo}",
            'branch': branch,
            'url': f"https://github.com/{owner}/{repo}/blob/{branch}/...",
        },
        id_=f"github_{owner}_{repo}_{branch}_{file_path}"
    )
```

### 3. å¢é‡æ£€æµ‹ä¼˜åŒ–

**åœºæ™¯ 1**: Commit æœªå˜åŒ–
- æ¯”è¾ƒ commit SHA
- è·³è¿‡æ‰€æœ‰åŠ è½½å’Œç´¢å¼•
- âš¡ è€—æ—¶ï¼š< 1ç§’

**åœºæ™¯ 2**: æœ‰æ–° Commitï¼Œä½†æ–‡ä»¶æœªå˜
- åŠ è½½æ–‡æ¡£
- æ–‡ä»¶å“ˆå¸Œæ¯”å¯¹ï¼ˆMD5ï¼‰
- æ— å˜æ›´æ–‡ä»¶ï¼Œä¸é‡æ–°ç´¢å¼•
- âš¡ è€—æ—¶ï¼š5-10ç§’

**åœºæ™¯ 3**: æ–‡ä»¶æœ‰å˜æ›´
- åªç´¢å¼•å˜æ›´çš„æ–‡ä»¶ï¼ˆadded, modifiedï¼‰
- åˆ é™¤å·²åˆ é™¤çš„æ–‡ä»¶
- âš¡ è€—æ—¶ï¼šå–å†³äºå˜æ›´æ–‡ä»¶æ•°

---

## äº”ã€æ€§èƒ½å¯¹æ¯”

### é¦–æ¬¡åŠ è½½

| æŒ‡æ ‡ | æ—§æ–¹æ¡ˆï¼ˆAPIï¼‰ | æ–°æ–¹æ¡ˆï¼ˆGitå…‹éš†ï¼‰ |
|------|--------------|------------------|
| å°å‹ä»“åº“ (< 100æ–‡ä»¶) | ~30ç§’ | ~20ç§’ï¼ˆæµ…å…‹éš†ï¼‰ |
| ä¸­å‹ä»“åº“ (500æ–‡ä»¶) | ~2åˆ†é’Ÿ | ~1åˆ†é’Ÿ |
| å¤§å‹ä»“åº“ (1000+æ–‡ä»¶) | ~5åˆ†é’Ÿ | ~2åˆ†é’Ÿ |

### å¢é‡æ›´æ–°

| åœºæ™¯ | æ—§æ–¹æ¡ˆï¼ˆAPIï¼‰ | æ–°æ–¹æ¡ˆï¼ˆGitï¼‰ |
|------|--------------|--------------|
| æ— å˜åŒ– | ~30ç§’ï¼ˆå…¨é‡æ£€æŸ¥ï¼‰ | < 1ç§’ï¼ˆSHAæ¯”å¯¹ï¼‰ |
| å°‘é‡å˜åŒ– (< 10æ–‡ä»¶) | ~30ç§’ | ~10ç§’ |
| å¤§é‡å˜åŒ– (100+æ–‡ä»¶) | ~2åˆ†é’Ÿ | ~30ç§’ |

**æ€§èƒ½æå‡**:
- æ— å˜åŒ–åœºæ™¯ï¼š**30å€æå‡**
- å¢é‡æ›´æ–°ï¼š**2-3å€æå‡**
- ç½‘ç»œåˆ©ç”¨ï¼š**å‡ ä¹æ— APIè¯·æ±‚**

---

## å…­ã€å…¼å®¹æ€§ä¿éšœ

### API å…¼å®¹

âœ… **å‡½æ•°ç­¾åä¸å˜**:
```python
def load_documents_from_github(
    owner: str,
    repo: str,
    branch: Optional[str] = None,
    github_token: Optional[str] = None,
    clean: bool = True,
    show_progress: bool = True,
    filter_directories: Optional[List[str]] = None,
    filter_file_extensions: Optional[List[str]] = None
) -> List[LlamaDocument]:
```

âœ… **å‚æ•°æ ¼å¼ä¸å˜**:
- `filter_directories`: `["docs", "src"]`
- `filter_file_extensions`: `[".md", ".py"]`

âœ… **å…ƒæ•°æ®æ ¼å¼ä¸å˜**:
- `source_type`: "github"
- `repository`: "owner/repo"
- `branch`: "main"
- `file_path`: "docs/README.md"
- `url`: "https://github.com/..."

### æ•°æ®å…¼å®¹

âœ… **å…ƒæ•°æ®æ–‡ä»¶æ ¼å¼**:
- æ–°å¢ `last_commit_sha` å­—æ®µ
- ä¿æŒå…¶ä»–å­—æ®µä¸å˜
- å‘åå…¼å®¹æ—§ç‰ˆå…ƒæ•°æ®

âœ… **Web ç•Œé¢**:
- æ— éœ€ä»»ä½•è°ƒæ•´
- ç”¨æˆ·ä½“éªŒä¸€è‡´
- åŠŸèƒ½å®Œå…¨å…¼å®¹

---

## ä¸ƒã€æµ‹è¯•éªŒè¯

### å•å…ƒæµ‹è¯•

âœ… **GitRepositoryManager**: 16ä¸ªæµ‹è¯•
- åˆå§‹åŒ–å’Œè·¯å¾„ç®¡ç†
- å…‹éš†ä»“åº“ï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰
- æ›´æ–°ä»“åº“
- Commit SHA è·å–
- æ¸…ç†åŠŸèƒ½
- Token æ¸…ç†

âœ… **data_loader**: 7ä¸ª GitHub ç›¸å…³æµ‹è¯•
- åŠ è½½æˆåŠŸ
- Token ä½¿ç”¨
- é»˜è®¤åˆ†æ”¯
- Git æ“ä½œå¤±è´¥
- ç©ºä»“åº“
- æ–‡æœ¬æ¸…ç†
- æ–‡ä»¶è¿‡æ»¤

### é›†æˆæµ‹è¯•

âœ… **æ•°æ®ç®¡é“**:
- GitHub åˆ°ç´¢å¼•çš„å®Œæ•´æµç¨‹
- å…ƒæ•°æ®ä¸€è‡´æ€§éªŒè¯

âœ… **æŸ¥è¯¢ç®¡é“**:
- ç´¢å¼•åˆ°æ£€ç´¢æµç¨‹
- å¤šæ¬¡æŸ¥è¯¢æµ‹è¯•

### æµ‹è¯•ç»“æœ

```
æµ‹è¯•ç»Ÿè®¡:
- æ€»æµ‹è¯•æ•°: 158ä¸ª
- é€šè¿‡: 155ä¸ª
- å¤±è´¥: 3ä¸ªï¼ˆéå…³é”®ï¼Œå·²çŸ¥é—®é¢˜ï¼‰
- è¦†ç›–ç‡: 85%+
```

---

## å…«ã€é£é™©å’Œç¼“è§£

### å·²è¯†åˆ«é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ | çŠ¶æ€ |
|------|------|---------|------|
| ç£ç›˜ç©ºé—´å ç”¨ | ä¸­ | æµ…å…‹éš† + æ¸…ç†æ¥å£ | âœ… å·²ç¼“è§£ |
| Git æœªå®‰è£… | é«˜ | å¯åŠ¨æ—¶æ£€æµ‹ + å‹å¥½æç¤º | âœ… å·²å®ç° |
| å¤§å‹ä»“åº“æ…¢ | ä¸­ | æµ…å…‹éš† + å¢é‡æ›´æ–° | âœ… å·²ä¼˜åŒ– |
| Token æ³„éœ² | é«˜ | URL åµŒå…¥ + æ—¥å¿—æ¸…ç† | âœ… å·²ä¿æŠ¤ |

### æœªæ¥ä¼˜åŒ–

- [ ] æœ¬åœ°ä»“åº“ç©ºé—´ç®¡ç† UI
- [ ] æ”¯æŒ GitLabã€Gitea ç­‰å¹³å°
- [ ] æ”¯æŒ Git å­æ¨¡å—
- [ ] æ”¯æŒæŒ‡å®šç‰¹å®š commit/tag

---

## ä¹ã€æ€»ç»“

### å…³é”®æˆæœ

âœ… **æ¶æ„å‡çº§**:
- ä» API è€¦åˆ â†’ Git æœ¬åœ°å…‹éš†
- ä¾èµ–æ›´æ¢ï¼šllama-index-readers-github â†’ langchain-community

âœ… **æ€§èƒ½æå‡**:
- æ— å˜åŒ–åœºæ™¯ï¼š30å€æå‡
- å¢é‡æ›´æ–°ï¼š2-3å€æå‡
- API è¯·æ±‚ï¼šå‡ ä¹ä¸ºé›¶

âœ… **å¯ç»´æŠ¤æ€§**:
- ä»£ç ç»“æ„æ›´æ¸…æ™°
- æµ‹è¯•è¦†ç›–æ›´å®Œå–„
- æ–‡æ¡£æ›´æ–°å®Œæ•´

âœ… **å‘åå…¼å®¹**:
- API å®Œå…¨å…¼å®¹
- Web ç•Œé¢æ— éœ€è°ƒæ•´
- å…ƒæ•°æ®æ ¼å¼å…¼å®¹

### ä»£ç ç»Ÿè®¡

- æ–°å¢ä»£ç ï¼š~250è¡Œ
- ä¿®æ”¹ä»£ç ï¼š~250è¡Œ
- åˆ é™¤ä»£ç ï¼š~100è¡Œ
- æ€»å˜æ›´ï¼š~400è¡Œæœ‰æ•ˆä»£ç 

### æ–‡ä»¶æ¸…å•

**æ–°å¢**:
- `src/git_repository_manager.py`
- `tests/unit/test_git_repository_manager.py`

**ä¿®æ”¹**:
- `pyproject.toml`
- `src/config.py`
- `src/data_loader.py`
- `app.py`
- `tests/unit/test_data_loader.py`
- `docs/API.md`
- `docs/CHANGELOG.md`
- `docs/DECISIONS.md`
- `README.md`

---

## åã€åç»­è®¡åˆ’

### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰

- [ ] ç›‘æ§ç”Ÿäº§ç¯å¢ƒæ€§èƒ½
- [ ] æ”¶é›†ç”¨æˆ·åé¦ˆ
- [ ] ä¼˜åŒ–é”™è¯¯æç¤º

### ä¸­æœŸï¼ˆ1-2æœˆï¼‰

- [ ] æ·»åŠ æœ¬åœ°ä»“åº“ç®¡ç† UI
- [ ] æ”¯æŒæ›´å¤šæ–‡ä»¶è¿‡æ»¤é€‰é¡¹
- [ ] æ€§èƒ½è¿›ä¸€æ­¥ä¼˜åŒ–

### é•¿æœŸï¼ˆ3-6æœˆï¼‰

- [ ] æ”¯æŒ GitLabã€Gitea
- [ ] æ”¯æŒ Git å­æ¨¡å—
- [ ] æ”¯æŒå¢é‡åŒæ­¥é€šçŸ¥

---

**å®æ–½å®Œæˆæ—¶é—´**: 2025-10-12 19:45  
**éªŒè¯çŠ¶æ€**: âœ… å•å…ƒæµ‹è¯•é€šè¿‡ï¼Œé›†æˆæµ‹è¯•é€šè¿‡  
**éƒ¨ç½²çŠ¶æ€**: ğŸŸ¢ å‡†å¤‡å°±ç»ª

