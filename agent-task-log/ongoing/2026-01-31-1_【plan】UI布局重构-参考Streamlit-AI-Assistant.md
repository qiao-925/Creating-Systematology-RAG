# UI布局重构 - 参考 Streamlit AI Assistant

> 参考目标：https://demo-ai-assistant.streamlit.app/  
> 源码：https://github.com/streamlit/demo-ai-assistant/blob/main/streamlit_app.py

---

## Checkpoint 状态表

| CP | 名称 | 状态 | 完成日期 |
|----|------|------|----------|
| CP1 | 移除侧边栏，建立单列居中布局 | ⬜ 待开始 | - |
| CP2 | 重构标题区域与 Restart 按钮 | ⬜ 待开始 | - |
| CP3 | 重构初始界面（建议问题 pills + 输入框） | ⬜ 待开始 | - |
| CP4 | 重构对话界面（气泡 + 底部输入） | ⬜ 待开始 | - |
| CP5 | 设置入口迁移与收尾测试 | ⬜ 待开始 | - |

---

## 背景与目标

### 背景

当前项目采用左右双栏布局（侧边栏 + 主内容区），参考 Streamlit 官方 AI Assistant Demo 后，发现其单列居中布局更加简洁清晰，交互逻辑一目了然。

### 目标

1. **抛弃侧边栏设计** → 采用单列居中布局
2. **标题居中** → 类似目标页面的风格
3. **设置按钮另找位置** → 放在标题行右侧
4. **"开启新对话"改为 Restart** → 功能相同，位置改到标题行

### 非目标（明确排除）

- 不改动后端逻辑
- 不改动 RAG 查询流程
- 不改动对话历史持久化逻辑
- 暂不实现历史会话列表（后续可考虑弹窗或独立页面）

---

## 技术方案

### 决策点：历史会话功能处理

**背景**：当前历史会话列表在侧边栏，移除侧边栏后需要决定如何处理。

**选项**：
1. **完全移除**：简化 MVP，后续再考虑
2. **迁移到弹窗/dialog**：保留功能，入口改为按钮触发弹窗
3. **迁移到独立页面**：使用 `st.Page` 多页面结构

**决策**：选择 **选项 1 - 完全移除**

**理由**：
- 参考目标页面也没有历史会话列表
- 简化首次重构范围，聚焦核心布局
- 后续可根据需要再添加

**日期**：2026-01-31

---

## 实施步骤

### CP1：移除侧边栏，建立单列居中布局

**目标**：将 `layout="wide"` 改为居中布局，移除侧边栏渲染调用。

**验收标准**：
- [ ] 页面无侧边栏
- [ ] 主内容区居中显示
- [ ] 应用可正常启动

**预计文件改动**：

| 文件 | 职责 | 行数预算 |
|------|------|----------|
| `frontend/config.py` | 修改 `set_page_config` 参数 | ≤120 |
| `frontend/main.py` | 移除 `render_sidebar` 调用，调整 CSS | ≤300 |

---

### CP2：重构标题区域与 Restart 按钮

**目标**：标题居中，右侧放置 Restart 和设置按钮。

**验收标准**：
- [ ] 标题居中显示
- [ ] Restart 按钮可用，点击后清空对话
- [ ] 设置按钮可用，点击后弹出设置弹窗

**预计文件改动**：

| 文件 | 职责 | 行数预算 |
|------|------|----------|
| `frontend/main.py` | 新增标题行渲染逻辑 | ≤300 |
| `frontend/components/chat_display.py` | 移除原标题显示 | ≤160 |

---

### CP3：重构初始界面（建议问题 pills + 输入框）

**目标**：无对话时显示建议问题（使用 `st.pills`）和输入框。

**验收标准**：
- [ ] 初始界面显示建议问题 pills
- [ ] 点击 pills 可触发对应问题
- [ ] 输入框正常工作

**预计文件改动**：

| 文件 | 职责 | 行数预算 |
|------|------|----------|
| `frontend/components/quick_start.py` | 重构为 pills 风格 | ≤80 |
| `frontend/config.py` | 调整建议问题配置 | ≤120 |

---

### CP4：重构对话界面（气泡 + 底部输入）

**目标**：有对话时显示对话气泡，输入框在底部。

**验收标准**：
- [ ] 对话气泡正常显示
- [ ] 输入框固定在底部
- [ ] 发送消息后正常追加到对话

**预计文件改动**：

| 文件 | 职责 | 行数预算 |
|------|------|----------|
| `frontend/components/chat_display.py` | 调整对话渲染逻辑 | ≤160 |
| `frontend/components/chat_input_with_mode.py` | 简化输入组件 | ≤150 |

---

### CP5：设置入口迁移与收尾测试

**目标**：确保设置弹窗可正常打开，整体功能可用。

**验收标准**：
- [ ] 设置弹窗可正常打开和关闭
- [ ] 完整对话流程可正常运行
- [ ] 无控制台错误

**预计文件改动**：

| 文件 | 职责 | 行数预算 |
|------|------|----------|
| `frontend/main.py` | 集成设置弹窗触发逻辑 | ≤300 |
| `frontend/components/settings_dialog.py` | 无需改动（复用） | - |

---

## 风险与注意事项

1. **历史会话功能暂时丢失**：用户无法查看历史对话，需在后续迭代中考虑解决方案
2. **CSS 调整可能影响其他样式**：需仔细测试暗色主题下的显示效果
3. **热重载兼容性**：确保 `_services_cached` 逻辑在新布局下仍正常工作

---

## 参考资料

- 目标页面：https://demo-ai-assistant.streamlit.app/
- 源码：https://github.com/streamlit/demo-ai-assistant/blob/main/streamlit_app.py
