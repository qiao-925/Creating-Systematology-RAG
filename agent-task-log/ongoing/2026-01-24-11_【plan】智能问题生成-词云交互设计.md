# 2026-01-24 【plan】智能问题生成 - 词云交互设计

**任务类型**: feature  
**日期**: 2026-01-24  
**任务编号**: #11  
**Agent**: Claude Opus 4.5

---

## Checkpoint 状态表

| CP | 阶段 | 状态 | 完成日期 |
|----|------|------|----------|
| CP1 | 关键词提取 | ⬜ 待开始 | - |
| CP2 | 词云 UI 组件 | ⬜ 待开始 | - |
| CP3 | LLM 问题生成 | ⬜ 待开始 | - |
| CP4 | 集成与测试 | ⬜ 待开始 | - |

---

## 背景与目标

### 背景

当前快速开始界面使用预设问题按钮，交互性不足，无法引导用户探索知识库内容。

### 设计思路

1. 从知识库提取关键词，展示为词云
2. 用户选择感兴趣的关键词（可多选）
3. 根据选中关键词，LLM 生成深度问题
4. 用户选择问题或直接提问

### 目标

- 提升用户探索知识库的兴趣
- 引导用户提出高质量问题
- 增强交互体验

---

## 讨论结论（2026-01）

### 交互定稿

1. **大框**：一个大框内漂浮当前主题相关词，用户可点击选词。
2. **选择框**：独立于输入框的「已选词」区域，最多选 10 个词。
3. **生成问题**：点击后调用 LLM，根据已选关键词 + 当前系统上下文生成 **2 个** 待选问题；第三项固定为「重新生成」。
4. **使用问题**：用户点击某条问题 → 将该问题填入**输入框** → **自动点击发送**（不经过选择框）。

### 交互流程示意

```
┌─────────────────────────────────────────────────────────┐
│                    💡 探索知识库（大框）                   │
├─────────────────────────────────────────────────────────┤
│  词云区（漂浮词，点击多选，最多 10 个）                     │
│  [系统学] [复杂巨系统] [综合集成] [钱学森] [方法论] …      │
├─────────────────────────────────────────────────────────┤
│  选择框（已选词，非输入框）  已选: 系统学, 综合集成         │
│  [✨ 生成问题]                                            │
├─────────────────────────────────────────────────────────┤
│  生成结果：                                               │
│  💬 问题1：…        ← 点击 → 填入输入框并自动发送          │
│  💬 问题2：…        ← 点击 → 填入输入框并自动发送          │
│  💬 重新生成        ← 固定第三项，再次生成 2 个问题         │
└─────────────────────────────────────────────────────────┘
```

### 静态优先（2026-01 补充）

- **先做静态**：词云数据不依赖当前 RAG 索引的实时分析，避免运行时负载过大。
- **数据来源**：直接对**本地文件夹**做离线分析，产出静态词表/词频数据，前端只读该数据展示词云。
- **分析目录**：`/home/q/Desktop/START/repos/AI-Practice (皮卡丘)/Creating-Systematology`（与 RAG 知识库对应或独立主题库均可）。
- **产出物**：脚本对上述目录跑关键词提取（标题 + TF-IDF 等），输出如 `data/keyword_cloud.json`（或放 frontend 静态资源），词云 UI 只加载该 JSON。
- **后续**：若需要「随知识库变化」再考虑按需/定时重算或接入索引。

---

## 设计方案

### 交互流程（与上「讨论结论」一致）

### 技术方案

| 模块 | 方案 | 说明 |
|------|------|------|
| 关键词提取 | **离线脚本**：对本地目录分析 | 分析目录：`.../Creating-Systematology`，TF-IDF + 标题提取，输出静态 JSON（如 `data/keyword_cloud.json`） |
| 词云 UI | Streamlit + CSS | 只读静态 JSON 展示词云，用按钮模拟词云效果，支持点击选中 |
| 问题生成 | LLM + Prompt | 根据关键词 + 知识库上下文生成问题 |

---

## 实施步骤

### CP1: 关键词提取（静态）

**目标**：对本地文件夹做离线分析，产出静态词表供词云使用

**任务**：
1. 实现**离线脚本**（或 keyword_extractor 的 CLI 入口）
   - 输入：本地目录路径（默认 `.../Creating-Systematology`）
   - 从文件/文档标题提取 + 内容 TF-IDF 提取
   - 去重、过滤停用词，输出词频或带权关键词列表
2. 产出静态数据：如 `data/keyword_cloud.json`，格式便于前端直接消费（如 `[{ "word": "系统学", "weight": 12 }, ...]`）
3. 前端/词云组件只读该 JSON，不做任何实时分析

**预计文件改动**：
- 新增：`backend/business/rag_engine/processing/keyword_extractor.py`（可被脚本调用）
- 新增：脚本入口（如 `scripts/build_keyword_cloud.py` 或 Makefile target）输出到 `data/keyword_cloud.json`

---

### CP2: 词云 UI 组件

**目标**：实现可交互的词云展示

**任务**：
1. 大框内词云区：漂浮词，不同大小表示词频，点击选中/取消，最多选 10 个
2. **选择框**：独立区域展示已选词（非输入框）
3. 「生成问题」按钮

**预计文件改动**：
- 新增：`frontend/components/keyword_cloud.py`
- 修改：`frontend/components/quick_start.py`

---

### CP3: LLM 问题生成

**目标**：根据关键词 + 当前系统上下文生成 2 个待选问题

**任务**：
1. 设计 Prompt：输入 = 已选关键词列表 + 当前系统/知识库上下文，输出 = 2 个深度问题
2. 实现问题生成接口
3. 展示 2 个问题 + 固定第三项「重新生成」；用户点击某问题 → 填入输入框并自动发送

**预计文件改动**：
- 新增：`prompts/question/generate.txt`
- 新增：`backend/business/rag_engine/processing/question_generator.py`

---

### CP4: 集成与测试

**目标**：集成到快速开始界面

**任务**：
1. 替换原有快速开始组件
2. 测试完整流程
3. 优化交互体验

**预计文件改动**：
- 修改：`frontend/components/quick_start.py`
- 修改：`frontend/main.py`（如需要）

---

## 文件改动清单

| 操作 | 文件 | 说明 |
|------|------|------|
| 新增 | `backend/business/rag_engine/processing/keyword_extractor.py` | 关键词提取（供离线脚本调用） |
| 新增 | 脚本（如 `scripts/build_keyword_cloud.py`） | 分析本地目录，输出 `data/keyword_cloud.json` |
| 新增 | `data/keyword_cloud.json` | 静态词表（由脚本生成，不提交或按需提交） |
| 新增 | `frontend/components/keyword_cloud.py` | 词云 UI 组件（只读静态 JSON） |
| 新增 | `prompts/question/generate.txt` | 问题生成 Prompt |
| 新增 | `backend/business/rag_engine/processing/question_generator.py` | 问题生成器 |
| 修改 | `frontend/components/quick_start.py` | 集成词云组件 |

---

## 待决策

| 决策点 | 选项 | 当前状态 |
|--------|------|----------|
| 词云数据 | 静态（本地目录离线分析）/ 实时从 RAG 索引 | ✅ 先做静态，分析目录 `.../Creating-Systematology` |
| 关键词来源 | 文档标题 / TF-IDF / 两者结合 | 待定 |
| 词云样式 | 纯按钮 / 自定义 HTML | 待定 |
| 已选词上限 | 最多 10 个 | ✅ 已定 |
| 生成问题数量 | 2 个待选 + 1 个「重新生成」 | ✅ 已定 |

---

## 下一步

本计划暂时挂起，优先完成 UI 优化任务。完成后再启动此功能开发。
