# 2026-01-23 【plan】AI-Agent全局架构认知建设-实施计划

> 解决AI Agent对软件系统全局架构认知不足的问题，建立系统级视角，避免局部优化导致全局问题

---

## Checkpoint 状态

| CP | 阶段 | 状态 | 完成时间 |
|----|------|------|----------|
| CP1 | 全局架构认知规则创建 | ✅ 已完成 | 2026-01-23 |
| CP2 | README架构认知增强 | ✅ 已完成 | 2026-01-23 |

**当前进度**: CP2 - README架构认知增强已完成，所有Checkpoint已完成

---

## 1. 背景与目标

### 1.1 现状问题

根据参考文档《智能化时代开发者机遇》，AI在软件开发流程中面临以下挑战：

**全局架构认知不足**：
- AI对系统整体逻辑、模块依赖和设计约束理解有限
- 生成方案可能局部最优但全局欠佳
- 难以理解跨模块调用或复杂逻辑交互

**项目上下文理解有限**：
- AI可能不了解整个项目的编码规范、依赖关系或已有模块功能
- 生成代码可能与实际需求不完全匹配
- 缺乏对项目历史决策和设计理念的理解

**复杂模块交互处理困难**：
- 跨模块调用时容易出现潜在错误
- 难以理解模块间的依赖关系和调用链
- 缺乏对系统整体数据流向的认知

### 1.2 目标

1. **建立全局架构认知规则**：创建 `global_architecture_cognition.mdc`，帮助AI Agent理解系统三层架构、核心组件地图、数据流向
2. **增强README架构认知内容**：在 README.md 中整合项目上下文、模块交互关系、架构决策等关键信息，让AI能够快速理解项目全貌

---

## 2. 技术方案

### 2.1 解决方案架构

```
┌─────────────────────────────────────────────────────────────┐
│  全局架构认知体系                                            │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────────────┐  ┌──────────────────┐                │
│  │ 架构认知规则      │  │ 项目上下文索引    │                │
│  │ (规则文件)        │  │ (代码库分析)      │                │
│  └──────────────────┘  └──────────────────┘                │
│  ┌──────────────────┐  ┌──────────────────┐                │
│  │ 模块交互文档      │  │ 架构决策记录      │                │
│  │ (依赖关系图)      │  │ (决策历史)        │                │
│  └──────────────────┘  └──────────────────┘                │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 核心组件

1. **全局架构认知规则**（`.cursor/rules/global_architecture_cognition.mdc`）
   - 系统概览、三层架构视图、核心组件地图
   - 数据流向、关键决策点、AI Agent行为要求
   - 常见架构陷阱、快速参考

2. **README架构认知增强**（`README.md`）
   - 在现有架构设计章节基础上，增强以下内容：
     - 项目上下文理解：代码库结构、关键文件索引、依赖关系
     - 模块交互关系：模块依赖图、接口契约、数据流向
     - 架构决策记录：关键决策、设计理念、技术选型理由

---

## 3. 实施步骤

### CP1: 全局架构认知规则创建

**目标**：创建全局架构认知规则文件，帮助AI Agent建立系统全局视角

**文件**：
- `.cursor/rules/global_architecture_cognition.mdc`（新建）

**内容**：
1. 系统概览：系统定位、核心价值、三层架构全局视图
2. 核心组件地图：查询流程组件、索引构建组件、基础设施组件
3. 数据流向全局视图：查询流程数据流、索引构建流程数据流
4. 关键决策点：查询引擎选择、检索策略选择、配置管理
5. AI Agent行为要求：修改代码前检查清单、创建新组件时检查清单
6. 常见架构陷阱：违反分层约束、局部优化导致全局问题、忽略数据流向
7. 快速参考：核心文件路径、关键配置项、设计模式

**验收标准**：
- [ ] 规则文件创建完成，包含系统概览、组件地图、数据流向
- [ ] 设置 `alwaysApply: true`，确保AI Agent始终加载
- [ ] 包含AI Agent行为要求和检查清单
- [ ] 包含常见架构陷阱和正确示例
- [ ] 规则文件符合 `.mdc` 格式规范

---

### CP2: README架构认知增强

**目标**：在 README.md 中增强架构认知相关内容，整合项目上下文、模块交互、架构决策等关键信息

**文件**：
- `README.md`（修改）

**内容**：
在现有"4. 📐 架构设计"章节基础上，增强以下内容：

1. **项目上下文理解**（新增子章节）：
   - 代码库结构说明：目录结构树、各目录职责、关键文件索引
   - 依赖关系说明：模块依赖关系（前端→业务→基础设施）、外部依赖、内部依赖
   - 编码规范与设计模式：编码规范、设计模式使用、代码风格约定

2. **模块交互关系**（增强现有内容）：
   - 模块依赖图：三层架构依赖关系、业务层内部依赖、基础设施层依赖
   - 接口契约：核心接口定义（RAGService.query、ModularQueryEngine.query等）
   - 数据流向：查询流程数据流、索引构建流程数据流、配置传递路径
   - 跨模块协作模式：工厂模式、依赖注入、延迟加载

3. **架构决策记录**（新增子章节）：
   - 关键架构决策：三层架构设计、可插拔设计、延迟加载、配置管理
   - 设计理念：模块化优先、可插拔设计、配置驱动等
   - 技术选型理由：LlamaIndex、Chroma Cloud、DeepSeek API、Streamlit

**验收标准**：
- [ ] README.md 中新增"项目上下文理解"章节
- [ ] 增强"模块交互关系"内容，包含依赖图和接口契约
- [ ] 新增"架构决策记录"章节，记录关键决策和设计理念
- [ ] 内容结构清晰，便于AI Agent理解
- [ ] 保持README整体结构合理，不超过500行

---

## 4. 风险与注意事项

### 4.1 风险点

- **风险1：规则文件过于复杂，AI Agent难以理解**
  - **应对策略**：保持规则文件简洁，使用清晰的表格和图表，避免过度详细

- **风险2：README内容过多，影响可读性**
  - **应对策略**：保持内容精简，控制在合理篇幅内，使用折叠章节或链接到详细文档

- **风险3：AI Agent仍然无法完全理解全局架构**
  - **应对策略**：通过验证场景不断优化规则和文档，收集反馈并持续改进

### 4.2 注意事项

- 规则文件应遵循 `.mdc` 格式规范，设置合适的 `alwaysApply` 和 `priority`
- README 增强内容应保持简洁，避免过度详细，控制在合理篇幅内
- 使用图表和ASCII图清晰展示架构关系，避免纯文字描述
- 在架构变更时同步更新 README，确保内容与代码库同步
- 遵循"简洁优于复杂"原则，避免创建过多文档文件

---

## 5. 文件改动清单

| 文件 | 操作 | 说明 |
|------|------|------|
| `.cursor/rules/global_architecture_cognition.mdc` | 新建 | 全局架构认知规则文件 |
| `README.md` | 修改 | 增强架构认知相关内容（项目上下文、模块交互、架构决策） |

---

## 6. 参考资源

### 6.1 参考文档

- 《智能化时代开发者机遇》- 2.3.3 智能能力嵌入开发流程的挑战
- 项目 README.md - 架构设计章节
- `.cursor/rules/architecture_design_guidelines.mdc` - 架构设计规范

### 6.2 相关规则

- `global_architecture_cognition.mdc` - 全局架构认知规则（待创建）
- `architecture_design_guidelines.mdc` - 架构设计规范
- `single-responsibility-principle.mdc` - 单一职责原则
- `workflow_requirements_and_decisions.mdc` - 需求与方案决策规范

---

## 7. 版本信息

- **创建日期**：2026-01-23
- **版本**：v1.0
- **状态**：计划制定完成，待用户确认后开始执行
